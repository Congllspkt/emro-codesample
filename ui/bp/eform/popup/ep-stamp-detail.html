<dom-module id="ep-stamp-detail">
    <style>
        :host {
            @apply(--vbox-layout);
        }
        
        .Template-Hide {
            display: none;
        }
            
		.Sign-Popup {
		    z-index: 999;
		    position: fixed;
		    left: 0;
		    top: 0;
		    width: 100%;
		    height: 100%;
		    text-align: center;
		}
		
		.Sign-Popup::before {
		    content: '';
		    display: inline-block;
		    width: 0;
		    height: 100%;
		    margin-left: -2px;
		    vertical-align: middle;
		}
		
		.Popup-Bg-Wrap {
		    z-index: 998;
		    position: fixed;
		    left: 0;
		    top: 0;
		    right: 0;
		    bottom: 0;
		    display: block;
		    width: 100%;
		    height: 100%;
		    background: rgba(0,0,0,0.5);
		}
		
		.Sign-Layerpop {
		    z-index: 999;
		    position: relative;
		    display: -webkit-inline-box;
		    display: -ms-inline-flexbox;
		    display: -webkit-inline-flex;
		    display: inline-flex;
		    -webkit-flex-direction: column;
		    -ms-flex-direction: column;
		    flex-direction: column;
		    line-height: 1.5;
		    background: #fff;
		    vertical-align: middle;
		    -webkit-border-radius: 6px;
		    -moz-border-radius: 6px;
		    -ms-border-radius: 6px;
		    -o-border-radius: 6px;
		    border-radius: 6px;
		    width: 562px;
		    height: 630px;
		}
		
		.Sign-Layerpop .Popup-Head {
		    padding: 32px 0px 20px;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		.Popup-Head .Title {
		    padding: 0px;
		    margin: 0;
		    line-height: 18px;
		    font-size: 20px;
		    font-weight: bold;
		    text-align: center;
		    color: #111111;
		}
		
		.Popup-Body {
		    position: relative;
		    max-height: 543px;
		    padding: 0;
		    color: #323232;
		    font-size: 14px;
		    text-align: left;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		    height: calc(100% - 70px - 85px);
		}
		
		.Popup-Foot {
		    margin: 0 auto;
		    padding: 20px 0px 31px 0px;
		    text-align: center;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		
		.Popup-Foot .btn_common { 
		    width: auto;
		    min-width: auto !important;
		    height: 33px;
		    line-height: 33px;
		    margin: 0 0 0 3px;
		    padding: 0 14px;
		    color: #fff;
		    font-size: 14px;
		    font-weight: bold;
		    text-transform: none;
		    background-color: #00aada;
		    -webkit-border-radius: 2px;
		    -moz-border-radius: 2px;
		    -ms-border-radius: 2px;
		    -o-border-radius: 2px;
		    border-radius: 2px;
		    border: none;
		}
		
		.Popup-Foot .btn_common.btn_cancel {
		    background-color: #474747;    
		}
		
		.Popup-Foot .btn_common.btn_reset { 
		    color: #00aada;
		    background-color: #ffffff;
		    border: solid 1px #00aada;
		}
		
		.Sign-Tab-Container {
		    position: relative;
		    height: 100%;
		    width: 562px;
		}
		
		.Popup-Tab-Main {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-box-pack: start;
		    -webkit-justify-content: start;
		    -ms-flex-pack: start;
		    -ms-flex-align-self: start;
		    justify-content: start;
		    overflow-x: auto;
		    overflow-y: hidden;
		    width: 100%;
		    height: 32px;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		    
		    list-style: none;
		    text-align: center ;
		    padding: 0 31px;
		    margin: 0;
		}
		
		.Popup-Tab-Main li {
		    cursor: pointer;
		    position: relative;
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		    width: 126px;
		    height: 30px;
		    border: solid 1px #d1d1d1;
		    background-color: #e5e5e5;
		}
		
		.Popup-Tab-Main li a, 
		.Popup-Tab-Main li span {
		    font-size: 14px;
		    font-weight: bold;
		    color: #333333;
		    white-space: nowrap;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		    width: 100%;
		}
		
		.Popup-Tab-Main li.on {
		    width: 125px;
		    background-color: #002c5f;
		    border: none;   
		}
		
		.Popup-Tab-Main li.on a, 
		.Popup-Tab-Main li.on span {
		    color: #ffffff; 
		}
		
		.Sign-Layerpop .Tab-Contents {
		    position: relative;
		    width: 562px;
		    height: 355px;
		    padding: 20px 31px 0 31px;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area.Draw-Area {
		    width: 100%;
		    height: 100%;
		    background: #fff;
		    color: #666;
		    font-size: 16px;
		    font-weight: 400;
		    text-align: center;
		    border: solid 1px #d1d1d1;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area.Draw-Area .innerbox {
		    position: relative;
		    width: 100%;
		    height: 100%;
		    
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area.Draw-Area .signMsg {
		    display: block;
		    width: 100%;
		    height: 100%;
		    line-height: 265px;
		    background: #fff;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area {
		    width: 100%;
		    height: 100%;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Head {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    margin: 0;
		    padding: 20px 24px;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Head select, 
		.Sign-Layerpop .Tab-Contents .Sign-Head input[type="text"] {
		    margin-right: 4px;
		}
		
		.Sign-Head select {
		    width: 153px;
		    height: 34px !important;
		    padding: 0 0 0 10px;
		    background: url(./../css/images/ic_pulldown.png) no-repeat calc(100% - 8px) 50% #fff;
		    font-family: inherit;
		    color: #000;
		    font-size: 14px;
		    border: 1px solid #d2d2d2;
		    border-radius: 0;
		    -webkit-appearance: none;
		    -moz-appearance: none;
		    appearance: none;
		    outline: none;
		    white-space: nowrap;
		    word-break: break-all;
		    text-overflow: ellipsis;
		    overflow: hidden;
		}
		
		.Sign-Head .btn_common.line_blue{
		    display: inline-block;
		    width: auto;
		    min-width: 130px;
		    height: 34px;
		    line-height: 32px;
		    margin: 0;
		    padding: 0 14px;
		    background: #fff;
		    font-size: 13px !important;
		    font-weight: 500;
		    text-overflow: ellipsis;
		    white-space: nowrap;
		    text-align: center;
		    overflow: hidden;
		    cursor: pointer;
		    box-sizing: border-box;
		}
		
		.Sign-Head .btn_common.line_blue {
		    color: #0e73c3 !important;
		    border: 1px solid #0e73c3;
		}
		
		.Sign-Layerpop .Tab-Contents .signTxtWrap {
		    padding: 0 14px 0 24px;
		    height: calc(100% - 74px);
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area .signTxtWrap ul {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-flex-wrap: wrap;
		    -ms-flex-wrap: wrap;
		    flex-wrap: wrap;
		    margin: 0;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area .signTxtWrap ul li {
		    cursor: pointer;
		    -webkit-flex-basis: 33.33%;
		    -ms-flex-basis: 33.33%;
		    flex-basis: 33.33%;
		    margin: 10px 0 0;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area .signTxtWrap ul li .canvas_wrap {
		    display: block;
		    width: calc(100% - 10px);
		    height: 100%;
		    color: #000;
		    font-size: 40px;
		    text-align: center;
		    border: 1px solid #d2d2d2;
		    background: #fff;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area .signTxtWrap ul li canvas {
		    width: 100%;
		    height: 100%;
		}
		
		
		.Sign-Layerpop .Tab-Contents .Sign-Area > .innerbox {
		    height: 100%;
		}
		
		.Sign-Layerpop .Tab-Contents .Sign-Area  .img_upload_area {
		    z-index: 2;
		    position: relative;
		    height: 100%;
		}
		
		.corner_point_area {
		    position: relative;
		    width: 100%;
		    height: 100%;
		    border: 1px solid #666;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		.corner_point_area .innerbox {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-box-pack: center;
		    -webkit-justify-content: center;
		    -ms-flex-pack: center;
		    -ms-flex-align-self: center;
		    justify-content: center;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    width: calc(100% + 2px);
		    height: calc(100% + 2px);
		    margin: -1px;
		    padding: 0;
		    
		    -webkit-border-radius: 20px;
		    -moz-border-radius: 20px;
		    -ms-border-radius: 20px;
		    -o-border-radius: 20px;
		    border-radius: 20px;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		.corner_point_area .innerbox .bg_area {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-box-pack: center;
		    -webkit-justify-content: center;
		    -ms-flex-pack: center;
		    -ms-flex-align-self: center;
		    justify-content: center;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    cursor: pointer;
		    width: 100%;
		    height: 100%;
		    padding: 10px;
		    background: url(/img/bg_upload.png) repeat 0 0;
		    border: 1px solid #fff;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		.corner_point_area .innerbox .img {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-box-pack: center;
		    -webkit-justify-content: center;
		    -ms-flex-pack: center;
		    -ms-flex-align-self: center;
		    justify-content: center;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    max-width: 100%;
		    width: 100%;
		    height: 100%;
		    text-align: center;
		}
		.corner_point_area .innerbox .img img {
		    max-width: 478px;
		    max-height: 226px;
		}
		
		.corner_point_area .txt_guide {
		    display: none;
		}
		.corner_point_area:hover .txt_guide {
		    position: absolute;
		    left: 0;
		    top: 0;
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-box-pack: center;
		    -webkit-justify-content: center;
		    -ms-flex-pack: center;
		    -ms-flex-align-self: center;
		    justify-content: center;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    width: 100%;
		    height: 100%;
		    color: #fff;
		    font-size: 20px;
		    font-weight: 700;
		    text-align: center;
		    vertical-align: middle;
		    background: rgba(128,128,128,0.8);
		}
		.img_upload_area .upload_note {
		    margin: 10px 0 0;
		    padding: 10px 0 0;
		    color: #323232;
		    font-size: 14px;
		    font-weight: 400;
		    border-top: 1px solid #d2d2d2;
		}
		.img_upload_area .upload_note p {
		    margin: 0 !important;
		    line-height: 1.5;
		}
		
		.Popup-Body .signList {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-flex-wrap: wrap;
		    -ms-flex-wrap: wrap;
		    flex-wrap: wrap;
		    -webkit-box-pack: space-between;
		    -webkit-justify-content: space-between;
		    -ms-flex-pack: space-between;
		    -ms-flex-align-self: space-between;
		    justify-content: space-between;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    width: auto;
		    height: auto;
		    margin-top: 0;
		    padding: 0;
		    border: 0 none;
		}
		.Popup-Body .signList .sign_item {
		    width: 240px;
		    height: auto;
		    margin: 0 0 20px;
		    padding: 0;
		    border: 0 none;
		}
		
		.signList .sign_item {
		    position: relative;
		    width: 341px;
		    height: 254px;
		    margin: 20px 0 0;
		    padding: 15px;
		    background: #fff;
		    border: 1px solid #d2d2d2;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		.signList .sign_item .sign_cont_area {
		    width: 100%;
		    height: 100%;
		}
		.Popup-Body .signList .sign_tit {
		    margin: 0 0 4px;
		    color: #6a7276;
		    font-size: 12px;
		    font-weight: 700;
		}
		.signList .sign_item .sign_tit {
		    position: relative;
		    margin: 0 0 20px;
		    padding: 0;
		    color: #323232;
		    font-size: 18px;
		    font-weight: 500;
		}
		.signList .sign_item .sign_cont {
		    cursor: pointer;
		    position: relative;
		    width: 100%;
		    height: calc(100% - 44px);
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-box-pack: center;
		    -webkit-justify-content: center;
		    -ms-flex-pack: center;
		    -ms-flex-align-self: center;
		    justify-content: center;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    text-align: center;
		    background: #eceff1;
		    border: 1px solid #d2d2d2;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		.Popup-Body .signList .sign_cont {
		    display: -webkit-box;
		    display: -ms-flexbox;
		    display: -webkit-flex;
		    display: flex;
		    -webkit-flex-direction: column;
		    -ms-flex-direction: column;
		    flex-direction: column;
		    -webkit-box-pack: center;
		    -webkit-justify-content: center;
		    -ms-flex-pack: center;
		    -ms-flex-align-self: center;
		    justify-content: center;
		    -webkit-align-items: center;
		    -ms-flex-align: center;
		    align-items: center;
		    width: 100%;
		    height: 130px;
		    border: 1px solid #d2d2d2;
		    background: none;
		    -webkit-box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    -o-box-sizing: border-box;
		    box-sizing: border-box;
		}
		
		.signList .sign_item .sign_cont canvas {
		    display: none;
		    width: 100%;
		    height: 100%;
		}
		.signList .sign_item .sign_cont .img_stamp {
		    width: auto;
		    max-width: 90%;
		    max-height: 90%;
		}    
		    
    </style>
 
    <template>
        <!-- 그리드 : 첨부서식 현황 조회--> 
        <sc-ajax id="saveCompStamp"
                url="saveSeal.do"
                body="{{formData.param}}"
                on-response="completeSaveCompStamp"></sc-ajax>        
        <sc-ajax id="updateCompStamp"
                url="updateSeal.do"
                body="{{formData.param}}"
                on-response="completeSaveCompStamp"></sc-ajax>
        <sc-ajax id="deleteCompStamp"
                url="deleteSeal.do"
                body="{{formData.param}}"
                on-response="completeSaveCompStamp"></sc-ajax>                
        <sc-ajax id="findStamp"
                url="findSeal.do"
                body="{{formData.param}}"
                on-response="completeFindStamp"></sc-ajax>

        <cc-auth-checker check-list="auth-r, auth-s"></cc-auth-checker>

		<cc-page-title-bar></cc-page-title-bar>
        <div class="Sign-Popup" id="signElement">
            <span class="Popup-Bg-Wrap"></span>
            <div class="Sign-Layerpop">
                <div class="Popup-Head">
                    <h3 class="Popup-Head Title">인장등록</h3>
                </div>
                <div class="Popup-Body">
                    <div class="Sign-Tab-Container">
                        <div class="Tab-Contents tab_stamp" id="stampSignArea" data-tab-name="stampSignTab">
							<table class="tb-form">
								<colgroup>
				                    <col style="width:100px">
				                    <col>
				                    <col style="width:120px">
				                    <col>
				                </colgroup>
				                <tr>
				                    <th><sc-label text="인장 명"></sc-label></th>
				                    <td colspan="3">
				                         <sc-text-field value="{{formData.param.seal_nm}}" required="true" max-length="50"></sc-text-field>
				                    </td>
				                </tr>
				                <tr>
				                    <th><sc-label text="사용 부서"></sc-label></th>
				                    <td>
					                    <cc-dept-search value="{{formData.param.dept_nm}}" result-value="{{formData.param.dept_cd}}" result-field="dept_cd"
					                                    id="deptSearch" readonly="[[formula('isEditable')]]" disabled="[[formula('isEditable')]]">
					                    </cc-dept-search>
				                    </td>                
				                    <th><sc-label text="전사 사용 여부"></sc-label></th>
				                    <td>
				                         <sc-checkbox-field input-value="{{formData.param.seal_cowd_comm_use_yn}}" checked-value="Y" un-checked-value="N" on-checkchange="onYnCheckChange"></sc-checkbox-field>
				                    </td>
				                </tr>
							</table>
                        
                            <div class="Sign-Area">
                                <div class="innerbox">
                                    <div class="img_upload_area" id="imageUploadArea">
                                        <div class="corner_point_area">
                                            <div class="innerbox">
                                                <div class="bg_area" id="stampImageSpan">
                                                    <i class="img">
                                                        <img id="stampImageTag" src="" alt="">
                                                    </i>
                                                    <span class="txt_guide"><span>파일 선택</span></span>
                                                </div>
												<input type="file" id="stampFileInput" class="hidden" style="display:none"
													   accept="image/jpeg, image/png, image/tiff, image/bmp, image/gif">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                    </div>
                </div>
                <div class="Popup-Foot">
                    <button type="button" class="btn_common btn_left btn_reset" id="drawTypeInitButton" on-click="onReset">초기화</button>
                    <button type="button" class="btn_common btn_cancel" id="cancelButton" on-click="onReset">취소</button>
                    <button type="button" class="btn_common" id="drawRegistButton">저장</button>
                    <button type="button" class="btn_common" id="deleteButton">삭제</button>
                </div>
            </div>
        </div>		
    </template>
    <script src="/bower_components/template-designer/js/pdf_form/fabric.js"></script>
    <script>
        Polymer({
            is: "ep-stamp-detail",

            properties: {
                // 공통코드
                codes: {
                    type: Object,
                    value: function() {
                        return {
                        };
                    }
                },
                // list 조회
                formData: {
                    type: Object,
                    value: function () {
                        return {
                            param: {
                            	dgtlsgn_seal_uuid:"",
                            	seal_nm:"",
                            	dept_cd:"",
                            	dept_nm:"",
                            	co_seal_yn:"Y",
                            	seal_cowd_comm_use_yn:"",
                            	seal_img_enc_dat:""
                            },
                            result: {}
                        }
                    }
                },
                signCanvas: {
                    type: Object
                },
            },
            
            formulas: {
            	isEditable : function (){
            		var me = this;
					var sts = me.formData.param.seal_cowd_comm_use_yn;
                    return (sts === "Y");
				},
            	isDeletable : function (){
            		var me = this;
					var sts = me.formData.param.dgtlsgn_seal_uuid;
                    return (sts != null && sts != "");
				}
            },

            // 화면 생성 완료
            initialized: function () {
                var me = this;
                me.signCanvas = null;
            },
            
            load : function(data){
            	var me = this;

            	me.set("formData.param.dgtlsgn_seal_uuid", data);
            	if(me.formData.param.dgtlsgn_seal_uuid != null && me.formData.param.dgtlsgn_seal_uuid != ""){
            		UT.request(me.$.findStamp);
            	}else{
    				me.set("formData.param", {
    					dgtlsgn_seal_uuid:"",
    					seal_nm:"",
                    	dept_cd:"",
                    	dept_nm:"",
                    	co_seal_yn:"Y",
                    	seal_cowd_comm_use_yn:"",
                    	seal_img_enc_dat:""
                    });
            	}
            	me.init();

            	if(me.formData.param.dgtlsgn_seal_uuid === ""){
            		me.querySelector('#deleteButton').style.display = 'none';
            		me.querySelector('#deleteButton').style.visibility = 'hidden';
            	}else{
            		me.querySelector('#deleteButton').style.display = '';
            		me.querySelector('#deleteButton').style.visibility = 'visible';
            	}

            },
            // 첨부서식 저장 후 callBack
            completeSaveCompStamp: function (e, res) {
                var me = this;
                me.onClose();
            },
            
            completeFindStamp: function (e, res) {
                var me = this;
                me.deptNm = UT.copy(res.response.dept_nm);
                me.deptCd = UT.copy(res.response.dept_cd);
                me.set("formData.param", res.response);
            	me.init();
            	
                let imageEl = me.querySelector("#stampImageTag");
            	imageEl.src = me.formData.param.seal_img_enc_dat;

                me.applyFormula();
                
                setTimeout(function() {
                	if(UT.isNotEmpty(me.deptNm) || UT.isNotEmpty(me.deptCd)) {
		                me.set("formData.param.dept_nm", me.deptNm);
// 		                me.$.deptSearch.searchResultChanged({dept_cd : me.deptCd}, {});
                	}
                }, 500);
            },            
            
            init: function() {
                var me = this;
                if (me.signCanvas === null) {
                	me.signCanvas = new fabric.Canvas('drawComponent', { isDrawingMode: true });
                	me.signCanvas.isDrawingMode = true;
                } else {
                	me.signCanvas.clear();
                }
                me.signPopupInitEvt(null, me);
                me.querySelector("#drawTypeInitButton").addEventListener("click", me.signRevert);
                me.querySelector("#cancelButton").addEventListener("click", me.closePopup);
                me.querySelector("#drawRegistButton").addEventListener("click", me.saveSignPopupData);
                me.querySelector("#deleteButton").addEventListener("click", me.deleteSignPopupData);
                //me.querySelector("#signElement").addEventListener("change", me.signPopupInitEvt);

                me.querySelector("#stampFileInput").addEventListener("change", me.stampImageSelected);
                me.querySelector(".corner_point_area .txt_guide").addEventListener("click", me.stampFileSelect);

                let popupDiv = me.querySelector("#signElement");
                if (popupDiv.classList.contains("Template-Hide")) {
                    popupDiv.classList.toggle("Template-Hide");
                    popupDiv.dispatchEvent(new Event("change"));
                }
                let layerPop = popupDiv.querySelector(".Sign-Layerpop");
                layerPop.setAttribute("fieldId", "imgTag1");
                layerPop.setAttribute("signWidth", 300);
                layerPop.setAttribute("signHeight", 300);
            },

            signPopupInitEvt:function(evt, _me) {
            	console.log("signPopupInitEvt:function");
            	var me = _me;
            	if (evt !== null) {
            		me = evt.target.closest("ep-stamp-detail");
            	}                	
                //var me = this;
                const popupDiv = me.querySelector("#signElement");

                let imageEl = me.querySelector("#stampImageTag");
                imageEl.src = "";

                me.querySelector("#stampFileInput").select();
                me.querySelector("#stampFileInput").value = '';
            },

            signRevert:function(evt){
                var me = evt.target.closest("ep-stamp-detail");
                const popupDiv = me.querySelector("#signElement");

                let imageEl = me.querySelector("#stampImageTag");
                imageEl.src = "";
                me.querySelector("#stampFileInput").value = '';
            },

            closeSignPopup:function(evt) {
            	var me = evt.target.closest("ep-stamp-detail");
                let popupDiv = me.querySelector("#signElement");
                if (!popupDiv.classList.contains("Template-Hide")) {
                    popupDiv.classList.toggle("Template-Hide");
                }
                me.fire("close-save");
            },
            
            closePopup:function(evt) {
            	var me = evt.target.closest("ep-stamp-detail");
                let popupDiv = me.querySelector("#signElement");
                if (!popupDiv.classList.contains("Template-Hide")) {
                    popupDiv.classList.toggle("Template-Hide");
                }
                me.fire("close1");
            },            

            saveSignPopupData:function(evt) {
                var me = evt.target.closest("ep-stamp-detail");
                const popupDiv = me.querySelector("#signElement");
                const layerPop = popupDiv.querySelector(".Sign-Layerpop");
                const fieldId = layerPop.getAttribute("fieldId");
                const signWidth = layerPop.getAttribute("signWidth");
                const signHeight = layerPop.getAttribute("signHeight");


                let imgEle = me.querySelector("#" + fieldId);
                let imageEl = me.querySelector("#stampImageTag");
                //imgEle.src = imageEl.src; //iageEl.src 저장
				
                if(imageEl.getAttribute("src") === null || imageEl.getAttribute("src") === ""){
                	UT.alert("STD.EDO2027"); //이미지를 선택해야 합니다.
                	return;
                }
                if(me.formData.param.seal_nm === ""){
					UT.alert(me.translate("STD.E1001", null, me.translate("인장 명")),null,true); // '{0}'은(는) 필수 입력 항목입니다.
                	return;
                }
                if(me.formData.param.seal_cowd_comm_use_yn === "N" && me.formData.param.dept_cd === ""){
                	UT.alert("STD.EDO2029"); //사용부서를 선택해주세요."
                	return;
                }
                me.set("formData.param.co_seal_yn", 'Y');
                me.set("formData.param.seal_img_enc_dat", imageEl.src);
                me.set("formData.param.seal_img_typ", "IMG");
                if(me.formData.param.dgtlsgn_seal_uuid === ""){
                	UT.request(me.$.saveCompStamp);
                }else{
					UT.request(me.$.updateCompStamp);
                }
            },
            
            deleteSignPopupData:function(evt) {
                var me = evt.target.closest("ep-stamp-detail");
                
				UT.request(me.$.deleteCompStamp);
            },            

            stampFileSelect:function(evt) {
                var me = evt.target.closest("ep-stamp-detail");
                me.querySelector("#stampFileInput").click();
            },

            stampImageSelected:function(evt) {
                var me = evt.target.closest("ep-stamp-detail");
                const fileList = evt.target.files;
                const file = fileList[0];
                if (file === undefined || file === null) {
                    return;
                }
                if (!file.type.startsWith('image/')) {
                	UT.alert("STD.EDO2027"); //이미지를 선택해야 합니다.
                	return; 
               	}

                var reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function () {
                    //console.log(reader.result);
                    let imageEl = me.querySelector("#stampImageTag");
                    imageEl.src = reader.result;
                };
                reader.onerror = function (error) {
                    console.log('Error: ', error);
                };
            },
            onYnCheckChange : function() {
                var me = this;
                if(me.formData){
	                if(me.get("formData.param.seal_cowd_comm_use_yn") === "Y"){
// 	                	me.$.deptSearch.searchResultChanged({}, {dept_cd : me.get("formData.param.dept_nm")});
	                	me.set("formData.param.dept_cd", "");
	                	me.set("formData.param.dept_nm", "");
	                }
	                me.applyFormula();
                }
            },
            onReset:function() {
            	var me = this;
            	me.set("formData.param.seal_nm", "");
            	me.set("formData.param.dept_nm", "");
            	me.set("formData.param.dept_cd", "");
            	me.set("formData.param.seal_cowd_comm_use_yn", "N");
//             	me.$.deptSearch.searchResultChanged({}, {});
            },
            onClose:function() {
            	var me = this;
                let popupDiv = me.querySelector("#signElement");
                if (!popupDiv.classList.contains("Template-Hide")) {
                    popupDiv.classList.toggle("Template-Hide");
                }
            	me.onReset();
                me.fire("close-save");
            },
        });
    </script>
</dom-module>