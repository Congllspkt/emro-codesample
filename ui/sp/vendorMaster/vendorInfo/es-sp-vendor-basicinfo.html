<!--
	******************************************************************************************
	** @Program-name 	: (외부)자사정보 관리
	** @Author 			: sykim
	** @Create Date 	: 2023.06.08
	******************************************************************************************
-->

<sc-link rel="import" href="../../../bp/shared/ep-zipcode.html"></sc-link>
<sc-link rel="import" href="./ep-sp-gen-key.html"></sc-link>

<dom-module id="es-sp-vendor-basicinfo">
    <style>
        :host {
            @apply(--vbox-layout);
        }
    </style>
    <template>
		<!-- 기본 정보 조회 -->
		<sc-ajax
				id="findBasicVendorInfo"
				url="findBasicVendorInfo.do"
				on-response="completeFindBasicVendorInfo">
		</sc-ajax>
		
        <!-- 기본 정보 저장 -->
        <sc-ajax
            id="saveBasicVendorInfo"
            url="saveBasicVendorInfo.do"
            on-response="completeSaveBasicVendorInfo">
        </sc-ajax>
		
		<!-- 첨부파일 저장 -->
		<sc-ajax
				id="saveBasicAttachmentInfo"
				url="saveBasicAttachmentInfo.do">
		</sc-ajax>
		
		<!-- 계좌정보조회 -->
		<sc-ajax
				id="findVendorBankAccountInfo" url="findVendorBankAccountInfo.do" last-response="{{bnkAcctList}}">
		</sc-ajax>
		<!-- 재무정보조회 -->
        <sc-ajax
                id="findListFinanceInfo" url="findListFinanceInfo.do" last-response="{{financeInfoList}}" on-response="handlerFindFinanceInfo">
        </sc-ajax>
        <!-- 직원정보조회 -->
        <sc-ajax
                id="findListLaborInfo" url="findListLaborInfo.do" on-response="handlerFindlaborInfo">
        </sc-ajax>
        <!-- 인증정보조회 -->
        <sc-ajax
                id="findListCertInfo" url="findListCertInfo.do" last-response="{{certInfoList}}">
        </sc-ajax>
        
        <!-- 인증서정보조회 -->
        <sc-ajax
                id="findCertManagerInfo" url="findCertManagerInfo.do" last-response="{{certMgtInfo}}">
        </sc-ajax>
		
		<!-- 계좌정보 그리드 목록 저장 -->
		<sc-ajax
				id="saveVendorBankAccountInfo" url="saveVendorBankAccountInfo.do"   on-response="completeSaveBankAccountInfo">
		</sc-ajax>
		<!-- 계좌정보 그리드 목록 삭제 -->
		<sc-ajax
				id="deleteVendorBankAccountInfo" url="deleteVendorBankAccountInfo.do" on-response="completeDeleteBankAccountInfo">
		</sc-ajax>
        
        <!-- 재무정보 그리드 목록 저장 -->
        <sc-ajax
            id="saveListFinanceInfo" url="saveListFinanceInfo.do"   on-response="completeSaveListFinanceInfo">
        </sc-ajax>
        <!-- 재무정보 그리드 목록 삭제 -->
        <sc-ajax
            id="deleteListFinanceInfo" url="deleteListFinanceInfo.do" on-response="completeDeleteListFinanceInfo">
        </sc-ajax>
        
        <!-- 직원 그리드 목록 저장 -->
        <sc-ajax
            id="saveListLaborInfo" url="saveListLaborInfo.do"   on-response="completeSaveListLaborInfo">
        </sc-ajax>
        <!-- 직원 그리드 목록 삭제 -->
        <sc-ajax
            id="deleteListLaborInfo" url="deleteListLaborInfo.do" on-response="completeDeleteListLaborInfo">
        </sc-ajax>

        <!-- 인증정보 그리드 목록 저장 -->
        <sc-ajax
            id="saveListCertInfo" url="saveListCertInfo.do" on-response="completeSaveListCertInfo">
        </sc-ajax>
        <!-- 인증정보 그리드 목록 삭제 -->
        <sc-ajax
            id="deleteListCertInfo" url="deleteListCertInfo.do" on-response="completeDeleteListCertInfo">
        </sc-ajax>

        <!-- 공통코드 조회 -->
        <sc-code-group>
            <sc-code code="C001" value="{{codes.ctry_ccd}}"></sc-code><!-- 국가 -->
            <sc-code code="E024" value="{{codes.vd_size_ccd}}"></sc-code><!-- 협력사 규모  -->
            <sc-code code="E041" value="{{codes.stkmkt_typ_ccd}}"></sc-code><!-- 주식시장 유형 -->
            <sc-code code="E032" value="{{codes.vd_submddoc_typ_ccd}}"></sc-code><!-- 협력사 제출서류 유형 -->
			<sc-code code="E065" value="{{codes.bnkCcd}}" ></sc-code> <!-- 은행 공통코드-->
        	<sc-code code="E001" value="{{codes.empTypCcd}}"></sc-code><!-- 직원 유형 공통코드 -->
        	<sc-code code="E054" value="{{codes.certTypCcd}}"></sc-code> <!-- 인증서 유형 공통코드-->
        	<sc-code code="E040" value="{{codes.regrTypCcd}}" ></sc-code> <!-- 등록자 유형 공통코드 -->
			<sc-code code="E067" value="{{codes.fnAcctTypCcd}}" ></sc-code> <!-- 재무 계정 유형 공통코드-->
			<sc-code code="E065" value="{{codes.bnkCcd}}" ></sc-code><!-- 은행 공통코드-->
        </sc-code-group>
        
        <!-- 화면 -->
        <cc-page-title-bar>
            <sc-button text="인증서등록" on-click="onCertInfoReg" hidden$="[[!formula('certMgtUseYn')]]"></sc-button>
        	<sc-button text="온보딩평가 요청" on-click="onShowRegReq"></sc-button>
        	<sc-button text="저장" on-click="onSave"></sc-button>
        </cc-page-title-bar>

        <div class="flex page">
			<cc-form-panel form-cls="label-row" title-text="[[translate('기본 정보')]]" validation-group="basicInfo" i18n-disabled>
				<cc-fieldset>
					<sc-label text="협력사 코드/명"></sc-label>
					<sc-text-field class="w-100" value="{{basicInfo.erp_vd_cd}}" readonly="true" max-length="18"></sc-text-field>
					<sc-text-field value="{{basicInfo.vd_nm}}" max-length="50" readonly="[[!formula('editState')]]" required="true" style="margin-left:5px;"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset>
					<sc-label text="국가"></sc-label>
					<sc-combobox-field display-field="label" value-field="data"
									   items="{{codes.ctry_ccd}}" value="{{basicInfo.ctry_ccd}}" placeholder="전체" readonly="[[!formula('editState')]]">
					</sc-combobox-field>
				</cc-fieldset>
				<cc-fieldset>
					<sc-label text="협력사 명 영문"></sc-label>
					<sc-text-field value="{{basicInfo.vd_nm_en}}" readonly="[[!formula('editState')]]" max-length="50"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateKR')]]">
					<sc-label text="사업자등록번호"></sc-label>
					<sc-text-field value="{{basicInfo.bizregno}}" class="w-200" readonly="[[!formula('editState')]]" input-mask="999-99-99999" pattern="^[0-9-]{12}$"></sc-text-field>
					<sc-text-field value="{{basicInfo.taxnsubj_seqno}}" readonly="[[!formula('editState')]]" input-mask="9999" max-length="4" style="margin-left:5px; width: 100px;"></sc-text-field>
					<sc-checkbox-field label="사업자단위과세적용사업자 여부" class="w-150" input-value="{{basicInfo.taxnsubj_yn}}" checked-value="Y" un-checked-value="N" readonly="[[!formula('editState')]]" style="margin-left:5px;"></sc-checkbox-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateKR')]]">
					<sc-label text="본사 사업자등록번호"></sc-label>
					<sc-text-field value="{{basicInfo.hq_bizregno}}" readonly="[[!formula('editState')]]" input-mask="999-99-99999" pattern="^[0-9-]{12}$"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateKR')]]">
					<sc-label text="법인번호"></sc-label>
					<sc-text-field value="{{basicInfo.corpno}}" readonly="[[!formula('editState')]]" input-mask="999999-9999999" pattern="^[0-9-]{14}$"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateKR')]]">
					<sc-label text="[[translate('업종')]]/[[translate('업태')]]" i18n-disabled></sc-label>
					<sc-text-field value="{{basicInfo.ind}}" max-length="50" readonly="[[!formula('editState')]]" ></sc-text-field>
					<span style="margin:0 5px">&#47;</span>
					<sc-text-field value="{{basicInfo.biztyp}}" max-length="50" readonly="[[!formula('editState')]]" ></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateETC')]]">
					<sc-label text="Tax Id" i18n-disabled></sc-label>
					<sc-text-field value="{{basicInfo.tax_id}}" readonly="[[!formula('editState')]]" max-length="36"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateEU')]]">
					<sc-label text="EU VAT Id"  i18n-disabled></sc-label>
					<sc-text-field value="{{basicInfo.eu_vat_reg_id}}" readonly="[[!formula('editState')]]" max-length="36"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset>
					<sc-label text="설립 일자"></sc-label>
					<sc-date-field class="date" value="{{basicInfo.vd_estd_dt}}" max-length="8" max-date="{{toDate}}" string-date="true"></sc-date-field>
				</cc-fieldset>
				<cc-fieldset>
					<sc-label text="협력사 규모"></sc-label>
					<sc-combobox-field
							display-field="label" value-field="data" required="true"
							items="{{codes.vd_size_ccd}}" value="{{basicInfo.vd_size_ccd}}" placeholder="선택">
					</sc-combobox-field>
				</cc-fieldset>
<!--				<cc-fieldset>
					<sc-label text="사업 형태"></sc-label>
					<sc-combobox-field
							display-field="label" value-field="data"
							items="{{codes.vd_size_ccd}}" value="{{basicInfo.vd_size_ccd}}" placeholder="선택">
					</sc-combobox-field>
				</cc-fieldset>-->
				<cc-fieldset>
					<sc-label text="주식시장 유형"></sc-label>
					<sc-combobox-field
							display-field="label" value-field="data"
							items="{{codes.stkmkt_typ_ccd}}" value="{{basicInfo.stkmkt_typ_ccd}}" placeholder="선택">
					</sc-combobox-field>
				</cc-fieldset>
				<cc-fieldset>
					<sc-label text="홈페이지"></sc-label>
					<sc-text-field value="{{basicInfo.hmpg_url}}" max-length="200"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateKR')]]">
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateKR')]]">
					<sc-label text="회사 주소"></sc-label>
					<sc-text-field max-length="18" class="w-150"
								   trigger-cls="search" on-trigger-click="onPopupZipcode"
								   value="{{basicInfo.zipcd}}" readonly="[[!formula('editState')]]">
					</sc-text-field>
					<div class="hspace-5"></div>
					<sc-text-field value="{{basicInfo.dtl_addr_1}}" max-length="100" readonly="true" readonly="[[!formula('editState')]]"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset>
					<sc-label text="회사 주소 영문"></sc-label>
					<sc-text-field value="{{basicInfo.dtl_addr_en_1}}" max-length="200" readonly="[[!formula('editState')]]"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('natStateKR')]]">
					<sc-label text=""></sc-label>
					<sc-text-field value="{{basicInfo.dtl_addr_2}}" max-length="100" readonly="[[!formula('editState')]]"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[formula('natStateKR')]]"></cc-fieldset>
				<cc-fieldset>
					<sc-label text=""></sc-label>
					<sc-text-field value="{{basicInfo.dtl_addr_en_2}}" max-length="200" readonly="[[!formula('editState')]]"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset column-span="2">
					<sc-label text="주 생산 품목"></sc-label>
					<sc-text-field value="{{basicInfo.main_transn_poss_item}}" max-length="500"></sc-text-field>
				</cc-fieldset>
				
				<!-- 블록체인 미사용시 주석 -->
				<cc-fieldset column-span="2" hidden$="[[!formula('blockChainKeyGen')]]">
					<sc-label text="블록체인 Key생성 여부"></sc-label>
					<sc-label text="[[translate(keyValidMsg)]] [[keyPeriod]]" i18n-disabled></sc-label>
					<sc-button style="margin-left:5px" text="[[translate(genKeyMsg)]]"  on-click="onOpenGenKeyPopup"></sc-button>
				</cc-fieldset>
				<!-- 블록체인 미사용시 주석 -->
				
				<!-- 인증서 관리 주석  -->
				<cc-fieldset hidden$="[[!formula('certMgtUseYn')]]">
					<sc-label text="DN"></sc-label>
					<sc-text-field value="{{certMgtInfo.cert_dn}}" readonly="true"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('certMgtUseYn')]]">
					<sc-label text="시리얼번호"></sc-label>
					<sc-text-field value="{{certMgtInfo.cert_serial}}" readonly="true"></sc-text-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('certMgtUseYn')]]">
					<sc-label text="시작일"></sc-label>
					<sc-date-field value="{{certMgtInfo.cert_start_date}}" string-date="true" readonly="true"></sc-date-field>
				</cc-fieldset>
				<cc-fieldset hidden$="[[!formula('certMgtUseYn')]]">
					<sc-label text="만료일"></sc-label>
					<sc-date-field value="{{certMgtInfo.cert_end_date}}" string-date="true" readonly="true"></sc-date-field>
				</cc-fieldset>
				<!-- 인증서 관리 주석  -->
			</cc-form-panel>
            
            <div class="hbox">
                <div class="flex-5">
					<cc-form-panel title-text="[[translate('대표자 정보')]]" validation-group="basicInfo" form-cls="label-row" i18n-disabled>
						<cc-fieldset row-span="3">
							<cc-image-listbox
									grp-cd="{{basicInfo.ceo_img_ath_uuid}}"
									max-image-count="1"
									hide-image-name="true">
							</cc-image-listbox>
						</cc-fieldset>
						<cc-fieldset>
							<sc-label text="대표자 명"></sc-label>
							<sc-text-field value="{{basicInfo.ceo_nm}}" readonly="[[!formula('editState')]]" max-length="40" required="true"></sc-text-field>
						</cc-fieldset>
						<cc-fieldset>
							<sc-label text="대표자 명 영문"></sc-label>
							<sc-text-field value="{{basicInfo.ceo_nm_en}}" readonly="[[!formula('editState')]]" max-length="40"></sc-text-field>
						</cc-fieldset>
						<cc-fieldset>
							<sc-label text="주요 경력"></sc-label>
							<sc-textarea-field value="{{basicInfo.ceo_crr}}" readonly="[[!formula('editState')]]" style="height:85px;" max-length="500"></sc-textarea-field>
						</cc-fieldset>
					</cc-form-panel>
                </div>
                
                <div class="hspace-10"></div>

				<sc-grid id="gridPanel"
					 class="h-200"
					 editable="true"
					 use-selection="false"
					 use-dummy="true"
					 data-provider="{{athfList}}">
				<cc-grid-toolbar title-text="[[translate('첨부파일')]]" i18n-disabled></cc-grid-toolbar>
				<sc-grid-columns>
					<sc-combobox-column data-field="vd_submddoc_typ_ccd" header-text="첨부파일 구분" width="350" text-align="left"
										items="{{codes.vd_submddoc_typ_ccd}}" display-field="label" value-field="data"></sc-combobox-column>
					<sc-data-column data-field="mand_yn" header-text="필수 여부" width="80"></sc-data-column>
					<sc-data-column data-field="apvl_subj_yn" header-text="결재 대상 여부" width="80"></sc-data-column>
					<sc-attachment-column data-field="att_count" header-text="첨부파일" width="130" text-align="left" shared-group-field="athg_uuid" popup-call-fn="callAttach"
										  validator-function="gridAttValidatorFunction"></sc-attachment-column>
					<sc-data-column	data-field="rmk" header-text="비고" width="150" text-align="left" editable="true" max-length="128"></sc-data-column>
				</sc-grid-columns>
				<sc-grid-fields>
					<sc-grid-field data-field="vd_cd"></sc-grid-field>
					<sc-grid-field data-field="vd_athf_uuid"></sc-grid-field>
					<sc-grid-field data-field="athg_uuid"></sc-grid-field>
				</sc-grid-fields>
            </div>
			
			<sc-grid id="bnkAcctInfoPanel" class="h-200" editable="true" data-provider="{{bnkAcctList}}" use-selection="[[formula('editState')]]" use-state="[[formula('editState')]]">
				<cc-grid-toolbar title-text="[[translate('계좌 정보')]]" i18n-disabled>
					<sc-button text="추가" on-click="onAddRowBnkAcctInfo" hidden="[[!formula('editState')]]"></sc-button>
					<sc-button text="삭제" on-click="onDeleteBnkAcctInfo" hidden="[[!formula('editState')]]"></sc-button>
					<sc-button text="저장" on-click="onSaveBnkAcctInfo" hidden="[[!formula('editState')]]"></sc-button>
				</cc-grid-toolbar>
				<sc-grid-columns>
					<sc-combobox-column data-field="bnk_ccd" header-text="은행" width="180" text-align="left" required="[[formula('editState')]]"
										items="{{codes.bnkCcd}}" display-field="label" value-field="data" editable="[[formula('editState')]]"></sc-combobox-column>
					<sc-data-column	data-field="accthldr" header-text="예금주" width="180" text-align="left" max-length="60" required="[[formula('editState')]]" editable="[[formula('editState')]]"></sc-data-column>
					<sc-data-column	data-field="bnkacct_no" header-text="계좌 번호" width="200" text-align="left" max-length="60" editable="[[formula('editState')]]"></sc-data-column>
					<sc-data-column	data-field="iban_cd" header-text="IBAN 코드" width="120" max-length="60" editable="[[formula('editState')]]" editable="[[formula('editState')]]"></sc-data-column>
					<sc-data-column	data-field="swift_cd" header-text="SWIFT 코드" width="120" max-length="60" editable="[[formula('editState')]]" editable="[[formula('editState')]]"></sc-data-column>
					<sc-checkbox-column data-field="vtl_bnkacct_yn" header-text="가상 계좌 여부" width="110" editable="[[formula('editState')]]"></sc-checkbox-column>
					<sc-checkbox-column data-field="main_bnkacct_yn" header-text="메인 계좌 여부" width="110" editable="[[formula('editState')]]"></sc-checkbox-column>
					<sc-checkbox-column	data-field="use_yn" header-text="사용 여부" width="110" editable="[[formula('editState')]]"></sc-checkbox-column>
					<sc-date-column	data-field="efct_st_dt" header-text="유효 시작 일자" width="110" required="[[formula('editState')]]" editable="[[formula('editState')]]" validator-function="gridValidatorFunction"></sc-date-column>
					<sc-date-column	data-field="efct_ed_dt" header-text="유효 종료 일자" width="110" required="[[formula('editState')]]" editable="[[formula('editState')]]" validator-function="gridValidatorFunction"></sc-date-column>
					<sc-attachment-column data-field="att_count" shared-group-field="athg_uuid" header-text="첨부파일" width="90" popup-call-fn="callAttachBnk"></sc-attachment-column>
				</sc-grid-columns>
				<sc-grid-fields>
					<sc-grid-field data-field="athg_uuid"></sc-grid-field>
					<sc-grid-field data-field="vd_bnkacct_uuid"></sc-grid-field>
					<sc-grid-field data-field="vd_cd"></sc-grid-field>
				</sc-grid-fields>
			</sc-grid>
            
            <!-- 재무정보 -->
            <sc-grid id="financeInfoPanel" class="h-300" editable="true" data-provider="{{financeInfoList}}" row-editable-function="onFinanceGridRowEdit" on-item-edit-end="onItemEditEnd">
	            <cc-grid-toolbar title-text="[[translate('재무')]]" i18n-disabled>
	                <sc-button text="추가" on-click="onAddRowFinanceInfo"></sc-button>
	                <sc-button text="삭제" on-click="onDeleteFinanceInfo"></sc-button>
	                <sc-button text="저장" on-click="onSaveFinanceInfo"></sc-button>
	            </cc-grid-toolbar>
				<sc-grid-columns id="financeInfoGridColumns">
					<sc-data-column	data-field="regr_typ_ccd_nm"	header-text="등록자 유형"		width="100" required="true"></sc-data-column>
					<sc-data-column	data-field="crrat_grd"			header-text="신용평가 등급"	width="120"	max-length="15" editable="true" editable-regex-function="onRowRegex"></sc-data-column>
					<sc-data-column	data-field="cashfw_grd"			header-text="현금흐름 등급"	width="120"	editable="true" editable-regex-function="onRowRegex"></sc-data-column>
					<sc-data-column	data-field="wtch_grd"			header-text="WATCH 등급"		width="120"	editable="true" editable-regex-function="onRowRegex"></sc-data-column>
				</sc-grid-columns>
	            <sc-grid-fields>
	                <sc-grid-field	data-field="vd_cd"	></sc-grid-field>
	                <sc-grid-field	data-field="vd_fn_uuid"	></sc-grid-field>
	                <sc-grid-field	data-field="modr_id"	></sc-grid-field>
					<sc-grid-field	data-field="regr_typ_ccd"	></sc-grid-field>
	            </sc-grid-fields>
        	</sc-grid>

			<div class="hbox">
				<div class="flex-5">
					<!-- 직원 그리드 -->
					<sc-grid id="laborInfoPanel" class="h-300" editable="true" data-provider="{{laborInfoList}}" on-item-edit-end="onLaborGridItemEditEnd">
						<cc-grid-toolbar title-text="[[translate('직원')]]" i18n-disabled>
							<sc-button text="추가" on-click="onAddRowLaborInfo"></sc-button>
							<sc-button text="삭제" on-click="onDeleteLaborInfo"></sc-button>
							<sc-button text="저장" on-click="onSaveLaborInfo"></sc-button>
						</cc-grid-toolbar>
						<sc-grid-columns id="laborInfoGridColumns">
							<sc-data-column	data-field="total" header-text="전체"     width="70" data-type="number" format-type="integer" editable="false" text-align="right"></sc-data-column>
						</sc-grid-columns>
						<sc-grid-fields>
							<sc-grid-field	data-field="vd_cd"	></sc-grid-field>
							<sc-grid-field	data-field="vd_emp_cursitu_uuid"	></sc-grid-field>
						</sc-grid-fields>
					</sc-grid>
				</div>
	
				<div class="hspace-10"></div>
				
				<div class="flex-5">
					<sc-grid id="certInfoPanel" class="h-300" editable="true" data-provider="{{certInfoList}}">
						<cc-grid-toolbar title-text="[[translate('인증서')]]" i18n-disabled>
							<sc-button text="추가" on-click="onAddRowCertInfo"></sc-button>
							<sc-button text="삭제" on-click="onDeleteCertInfo"></sc-button>
							<sc-button text="저장" on-click="onSaveCertInfo"></sc-button>
						</cc-grid-toolbar>
						<sc-grid-columns>
							<sc-combobox-column data-field="cert_typ_ccd" required="true"   header-text="인증서"  width="120" items="{{codes.certTypCcd}}" display-field="label" value-field="data" editable="true"></sc-combobox-column>
								<sc-data-column	data-field="cert_no"	required="true" header-text="번호"	width="100"	text-align="left" editable="true" max-length="50"></sc-data-column>
								<sc-attachment-column data-field="att_count" header-text="첨부파일" editable="true"    width="80" text-align="left" shared-group-field="athg_uuid"></sc-attachment-column>
								<sc-date-column	data-field="cert_publ_dt"	required="true" header-text="발행 일자"	width="120" editable="true" string-date="true" validator-function="gridValidatorFnCert"></sc-date-column>
								<sc-data-column	data-field="cert_publ_instn_nm"	header-text="발행 기관 명"	width="130"	text-align="left" editable="true" max-length="200"></sc-data-column>
								<sc-date-column	data-field="cert_efct_st_dt"	header-text="유효 시작 일자"	width="140" editable="true" string-date="true" validator-function="gridValidatorFnCert"></sc-date-column>
								<sc-date-column	data-field="cert_efct_exp_dt"	header-text="유효 만료 일자"	width="140" editable="true" string-date="true" validator-function="gridValidatorFnCert"></sc-date-column>
						</sc-grid-columns>
						<sc-grid-fields>
							<sc-grid-field	data-field="vd_cd"	></sc-grid-field>
							<sc-grid-field	data-field="vd_cert_uuid"	></sc-grid-field>
						</sc-grid-fields>
					</sc-grid>
				</div>
			</div>
            <!-- 재무정보 end -->
        </div>
    </template>
	
    <!-- 스크립트 -->
    <script>
        Polymer({
            is: "es-sp-vendor-basicinfo",
            
            properties:{
            	toDate : {
					type : Object,
					value : function() {
						var nowDate = new Date();
						nowDate.setHours(0,0,0,0);
						return nowDate;
					}
				},
                codes: {
                    type: Object,
                    value : function(){
                        return {
                            ctry_ccd: [],
                            stkmkt_typ_ccd: [],
                            vd_size_ccd: [],
                            vd_submddoc_typ_ccd: [],
							empTypCcd: [],
							regrTypCcd : [],
							fnAcctTypCcd : [],
							certTypCcd: [],
							years : []
                        };
                    }
                },
                /*기본 정보 data binding 객체*/
                basicInfo: {
                    type: Object,
                    value : function(){
                        return {};
                    }
                },
                /*협력사 상태정보 data binding 객체*/
                modStsInfo: {
                    type: Object,
                    value : function(){
                        return {};
                    }
                },
                athfList:{
                    type:Array,
                    value:function(){
                    	return [];
                    }
                },
				/* 계좌 */
				bnkAcctList:{
					type:Array,
					value:function(){
						return [];
					}
				},
                /* 재무정보 */
                financeInfoList:{
                    type:Array,
                    value:function(){
                    	return [];
                    }
                },
                /* 직원 */
                laborInfoList:{
                    type:Array,
                    value:function(){
                    	return [];
                    }
                },
                /* 인증정보 */
                certInfoList:{
                    type:Array,
                    value:function(){
                    	return [];
                    }
                },
                /* 협력사 인증서 정보 */
                certMgtInfo : {
                    type: Object,
                    value : function() {
                        return {
                            cert_mgt : "N"
                        };
                    }
                },
				/* 대상 연도 */
				yearsParam : {
					type: Object,
					value : function() {
						return {
							currentYear : new Date().getFullYear(),
							max         : 0,
							min         : 5,
							sort        : "desc"
						};
					}
				},
				//completeAlert key 값(btn Name)
				completeAlertKey : {
					type : String,
					value : function(){
						return "";
					}
				}
            },

            formulas:{
                editState: function(){
                    return (!this.basicInfo || !this.basicInfo.erp_vd_cd);
                },
                natStateKR : function(){
                    return (this.basicInfo.valid_ctry_ccd == "KR");
                },
                natStateEU : function(){
                    return (this.basicInfo.valid_ctry_ccd == "EU");
                },
                natStateETC : function(){
                    return (this.basicInfo.valid_ctry_ccd == "ETC");
                },
                blockChainKeyGen : function(){ // 블록체인사용여부 Y, 해외업체
                    return (this.basicInfo.blockChainUseYn == "Y" && !this.formula("natStateKR"));
                },
                certMgtUseYn : function() {
                    return (this.certMgtInfo.cert_mgt === "Y");
                }
            },
			
			initialized: function(){
				var me = this;
				SCValidator.factory({
					type:'vdFinanceNumber',
					maxLength: 20,
					decimalprecision: 5,
					nospace: true,
					minValue: -999999999999999,
					maxValue: 999999999999999
				});
				
				me.initSubjYearCombo();
				me.initFinanceInfoGrid();
				me.initLaborInfoGrid();
				me.load();
			},
			
			// 대상 연도 콤보박스 설정
			initSubjYearCombo: function(){
				var me = this;
				var items = [];
				var minYear = me.yearsParam.currentYear - me.yearsParam.min,
					maxYear = me.yearsParam.currentYear + me.yearsParam.max;
				
				for (var i = 0; i <= me.yearsParam.min + me.yearsParam.max; i++) {
					items.push({
						value : me.yearsParam.sort === "desc" ? maxYear-- : minYear++
					});
				}
				
				me.set("codes.years", items);
			},
			
			// 재무정보 그리드 setting
			initFinanceInfoGrid: function(){
				var me = this;
				
				var columns = me.$.financeInfoGridColumns.getChildren();
				
				// 대상 연도 컬럼 세팅
				var subjYrCol = me.setSubjYear(columns);
				subjYrCol.required = true;
				subjYrCol.itemEditableFunction = "onFinanceSubjYearEdit";
				subjYrCol.validatorFunction = "gridValidator";
				
				columns.splice(0, 0, subjYrCol);
				
				var rows = me.codes.fnAcctTypCcd;
				
				for(var i=0; i<rows.length; i++) {
					var row = rows[i],
						field = row["data"];        // 필드명
					var col = document.createElement('sc-data-column');
					col.dataField = field.toLowerCase();
					col.headerText = row.label;
					col.maxLength = 15;
					col.width= 120;
					col.editable = true;
					col.editorRegexFunction="onRowRegex";
					
					if(!(["CRRAT_GRD", "CASHFW_GRD", "WTCH_GRD", "CRRAT_VD"].indexOf(field) > -1)){
						col.textAlign = "right";
						col.dataType = "number";
						
						if(["SLS_AMT", "ASST_AMT", "CURRASST_AMT", "CURRLIABLT_AMT", "CAPT_AMT", "LIABLT_AMT"].indexOf(field) > -1){
							col.formatType = "amt";
							col.validatorType="amt";
						} else if(["OPRTPRF_AMT", "NETINCM_AMT"].indexOf(field) > -1){
							col.formatType = "decimal";
						}else if(["LIABLT_RO", "OPRTPRF_RO"].indexOf(field) > -1){
							col.formatType = "percent";
							col.validatorType ="decimal";
						}
					}
					
					
					columns.push(col);
				}
				me.$.financeInfoPanel.setColumns(columns);
			},
			
			// 직원 그리드 setting
			initLaborInfoGrid: function(){
				var me = this;
				
				var columns = me.$.laborInfoGridColumns.getChildren();
				
				// 대상 연도 컬럼 세팅
				var subjYrCol = me.setSubjYear(columns);
				
				subjYrCol.required = true;
				subjYrCol.itemEditableFunction = "onYrEdit";
				
				columns.splice(0, 0, subjYrCol);
				
				var rows = me.codes.empTypCcd;
				
				for(var i=0; i<rows.length; i++) {
					var row = rows[i],
						field = "emp_typ_ccd_"+row["data"];        // 필드명
					var col = document.createElement('sc-data-column');
					col.dataField = field;
					col.headerText = row.label;
					col.dataType = "number";
					col.textAlign = "right";
					col.maxLength = 15;
					col.width= 70;
					col.editable = true
					columns.push(col);
				}
				
				me.$.laborInfoPanel.setColumns(columns);
			},
			
			setSubjYear: function(columns){
				var me = this;
				var gridColumns = columns;
				var col = document.createElement("sc-combobox-column");
				col.dataField = "subj_yr";
				col.headerText = "대상 연도";
				col.width = 120;
				col.items = me.codes.years;
				col.displayField = "value";
				col.valueField = "value";
				
				return col;
			},
			
			/* 조회 */
			load: function(){
				var me = this;
				
				// 조회
				UT.request(me.$.findBasicVendorInfo);
				
				// 재무정보 그리드 조회
				me.onShowFinanceInfoList();
				// 직원정보 그리드 조회
				me.onShowLaborInfoList();
				// 인증정보 그리드 조회
				me.onShowCertInfoList();
			},
			
			/* 조회 완료 후 callback */
			completeFindBasicVendorInfo: function(e, res){
				var me = this;
				var basicInfo = res.response.basicInfo;
				var modStsInfo = res.response.modStsInfo;
				var athfList = res.response.athfList;
				var bnkAcctList = res.response.bnkAcctList;
				// var certMgtInfo = res.response.certMgtInfo;
				
				/** 블록체인 관련 코드 **/
				if(res.response.result_status === "E"){
					// block chain key 조회 실패
					UT.alert("STD.E9999");
				}
				/** 블록체인 관련 코드 **/
				
				if(basicInfo){
					me.set("basicInfo", basicInfo);
					me.set("modStsInfo", modStsInfo);
					me.set("athfList", athfList);
					me.set("bnkAcctList", bnkAcctList);
					// me.set("certMgtInfo", certMgtInfo);
					
					console.log(me.get("basicInfo.blockChainUseYn"));
					/** 블록체인 관련 코드 **/
					/** blockChain 관련(해외) **/
					if("KR" != me.get("ctry_ccd") && "Y" == me.get("basicInfo.blockChainUseYn")){
						var certVerified = me.get("basicInfo").certVerified;
						if(!certVerified){
							// 유효하지 않음
							me.set("keyValidMsg", "Key가 유효하지않음");
							me.set("keyPeriod"  , "");
							me.set("genKeyMsg"  , "Key 생성");
						}else{
							// 유효함
							me.set("keyValidMsg", "Key가 유효함");
							me.set("keyPeriod"  , "(" + UT.formatDate(new Date(basicInfo.notBefore), "yyyy/MM/dd HH:mm:ss") + " ~ " + UT.formatDate(new Date(me.basicInfo.notAfter), "yyyy/MM/dd HH:mm:ss") + ")");
							me.set("genKeyMsg"  , "Key 재생성");
						}
					}
					/** 블록체인 관련 코드 **/
				}
				me.applyFormula();
			},
			
			/* 온보딩평가 요청 btn */
			onShowRegReq: function(){
				var me = this;
				MDIUT.createWindowByMenuId("SOBD00010");
			},
			
			/* 저장 */
			onSave: function(e){
				var me = this,
					provider = me.$.gridPanel.getDataProvider();
				var btnName = e.target.text;
				var athfList = provider.getItems();
				
				//기본정보 & 계좌정보 validation
				if(!me.validate("basicInfo") || !me.$.gridPanel.validate()) {
					UT.alert("STD.E0000");
					return;
				}
				
				// 저장 시 넘겨줄 파라미터 set
				me.$.saveBasicVendorInfo.body = {
					basicInfo : me.basicInfo,
					athfList : athfList
				};
				UT.confirm("STD.N1200", function() {
					me.set("completeAlertKey", btnName);
					UT.request(me.$.saveBasicVendorInfo);
				});
			},
			
			/* 저장 후 callback */
			completeSaveBasicVendorInfo: function(e, res){
				var me = this;
				
				UT.completeAlert(me.get("completeAlertKey"), function(){
					//재조회
					me.load();
				});
				
				me.set("completeAlertKey", "");
			},
			
			// 주소/우편번호 검색
			onPopupZipcode: function() {
				var me = this;
				
				var zipCodePopup = UT.popup("ep-zipcode", me, 650, 500, {
					'selected-items' : function(popup, e) {
						var selected = e.detail[0];
						me.set("basicInfo.zipcd", selected.pst_no);
						me.set("basicInfo.dtl_addr_1", selected.addr);
					}
				}, {titleText : "우편번호 검색"});
				zipCodePopup.show();
			},
   
			// 첨부파일 그리드 첨부
            callAttach : function(data, item, provider){
            	var me = this,
					athf_uuid = data.athg_uuid,
                	itemIndex = item.rowIndex,
                	provider = me.$.gridPanel.getDataProvider();

				UT.popupAttach(me, athf_uuid, function(result){
					var param = {
						athg_uuid : result.athg_uuid,
						att_count: result.file_count
					}
					if(!UT.isEmpty(data.vd_athf_uuid)) {
						param.vd_athf_uuid = data.vd_athf_uuid;
						me.$.saveBasicAttachmentInfo.body =  param;

						UT.request(me.$.saveBasicAttachmentInfo, function() {
							provider.setItemAt(itemIndex, param);
							provider.setItemState(itemIndex, "none");
						});
					} else {
						provider.setItemAt(itemIndex, param);
					}
				}, {
					required: data.mand_yn === 'Y',
					editable: (me.formula('editState') || data.apvl_subj_yn !== 'Y')
				});
            },

            // 첨부파일 Validtaion Check
            gridAttValidatorFunction: function(headerText, dataField, data){
				var me = this;
				//수정 가능 할 시
				if(me.formula("editState")) {
					//협력사 첨부파일 필수여부 check
					if(data.mand_yn === "Y" && parseInt(data.att_count) < 1) {
						return me.translate("STD.VS1024");
					}
				} else {
					//협력사 첨부파일 필수 & 결재대상이 아니면 check
					if(data.mand_yn === "Y" && data.apvl_subj_yn !== 'Y') {
						if(parseInt(data.att_count) < 1) {
							return me.translate("STD.VS1024");
						}
					}
				}
                
                return true;
            },
			
			gridValidatorFunction: function(headerText, dataField, data){
				var me = this;
				
				if(me.formula('editState') && (dataField === "efct_st_dt" || dataField === "efct_ed_dt")) {
					if(data.efct_st_dt >= data.efct_ed_dt) {
						// '{0}'은(는) '{1}'이후 날짜를 입력하세요.
						return me.translate("STD.E1013", null, me.translate("유효 종료 일자"), me.translate("유효 시작 일자"));
					}
				}
				
				return true;
			},
			
			// 계좌정보 그리드 첨부
			callAttachBnk : function(data, item, provider){
				var me = this,
					athf_uuid = data.athg_uuid,
					itemIndex = item.rowIndex,
					provider = me.$.bnkAcctInfoPanel.getDataProvider();
				
				UT.popupAttach(me, athf_uuid, function(result){
					provider.setItemAt(itemIndex, {
						athg_uuid : result.athg_uuid,
						att_count: result.file_count
					});
				}, { editable: me.formula('editState') });
			},
			
			/* 계좌 그리드 추가 */
			onAddRowBnkAcctInfo: function(){
				var me = this,
					bnkAcctProvider = me.$.bnkAcctInfoPanel.getDataProvider();
				
				if(!me.formula('editState')) return;
				
				bnkAcctProvider.addItem({
					vd_cd : me.get("vdInfo.vd_cd"),
					main_bnkacct_yn : "N",
					vtl_bnkacct_yn : "N",
					use_yn : "N"
				});
			},

            /* 재무정보 그리드 추가 */
            onAddRowFinanceInfo: function(){
                var me = this,
                    financeInfoProvider = me.$.financeInfoPanel.getDataProvider();

				var codeName = "", filtered = [];
				var regrTypCcd = me.codes.regrTypCcd;
				
				if(UT.isNotEmpty(regrTypCcd)){
					filtered = regrTypCcd.filter(function(item) {
						if (item["data"] === "VD") {
							return item;
						}
					});
				}
				
				if(UT.isNotEmpty(filtered)){
					codeName = filtered[0]["label"];
				}
	            financeInfoProvider.addItem({
					subj_yr : new Date().getFullYear() - 1, // 대상 연도 기본값 전년도
	                vd_cd : me.get("vdInfo.vd_cd"),
					regr_typ_ccd : "VD",
					regr_typ_ccd_nm: codeName
	            });
            },
            
            /* 직원 그리드 추가 */
            onAddRowLaborInfo: function(){
                var me = this,
                    laborInfoProvider = me.$.laborInfoPanel.getDataProvider();

                laborInfoProvider.addItem({
					subj_yr : new Date().getFullYear() - 1,	// 대상 연도 기본값 전년도
                    vd_cd : me.get("vdInfo.vd_cd")
                });
            },
            
            /* 인증정보 그리드 추가 */
            onAddRowCertInfo: function(){
                var me = this,
                    certInfoProvider = me.$.certInfoPanel.getDataProvider();

                certInfoProvider.addItem({
                    vd_cd : me.get("vdInfo.vd_cd")
                });
            },
			
			/* 계좌정보 그리드 조회 */
			onShowBankAccountList: function(){
				var me = this;
				UT.request(me.$.findVendorBankAccountInfo);
			},
            
            /* 재무정보 그리드 조회 */
            onShowFinanceInfoList: function(){
                var me = this;
                UT.request(me.$.findListFinanceInfo);
            },
			
            /* 직원 그리드 조회 */
            onShowLaborInfoList: function(){
                var me = this;
                UT.request(me.$.findListLaborInfo);
            },
			
			handlerFindFinanceInfo: function(e,res){
				var me = this;
				var list = res.response;
				var newList = [];
				var sum = 0;
				for(var i=0, len = list.length ; i < len ; i++){
					
					var result = list[i];
					
					var clss = result.cls;
					
					for(var j = 0, len2 = clss.length ; j < len2 ; j++){
						var cls = clss[j];
						var fnAcctTypCcd = cls["fn_acct_typ_ccd"];
						result[fnAcctTypCcd] = cls["fn_acct_typ_val"];
					}
					result["vd_cd"] = me.get("vdInfo.vd_cd");
					newList.push(result);
				}
				me.set("financeInfoList",newList);
			},
			
            handlerFindlaborInfo: function(e,res){
            	var me = this;
            	var list = res.response;
            	var newList = [];
            	
            	for(var i=0, len = list.length ; i < len ; i++){
            		var result = list[i];
            		var clss = result.cls;
					var sum = 0;
            		for(var j = 0, len2 = clss.length ; j < len2 ; j++){
            			var cls = clss[j];
            			var empClsCd = cls["emp_typ_ccd"];
            			result["emp_typ_ccd_"+empClsCd] = cls["emp_numc"];
            			sum += UT.toNumber(cls["emp_numc"]);
            		}
            		result["vd_cd"] = me.get("vdInfo.vd_cd");
            		result["total"] = sum;
            		newList.push(result);
            	}
            	me.set("laborInfoList",newList);
            },
			
            /* 인증정보 그리드 조회 */
            onShowCertInfoList: function(){
                var me = this;
                UT.request(me.$.findListCertInfo);
            },
			
			/* 계좌정보 저장 */
			onSaveBnkAcctInfo: function(){
				var me = this,
					bnkAcctInfoProvider = me.$.bnkAcctInfoPanel.getDataProvider();
				var insertList = bnkAcctInfoProvider.getNewItems(),
					updateList = bnkAcctInfoProvider.getUpdateItems();
				
				if(!me.formula('editState')) return;
				
				if(UT.isEmpty(insertList) && UT.isEmpty(updateList)){
					return UT.alert("STD.N1700");
				}
				if(!me.$.bnkAcctInfoPanel.validate()){
					UT.alert("STD.E0000");
					return;
				}
				UT.confirm("STD.N1200", function() {
					me.$.saveVendorBankAccountInfo.body = {
						insertList: insertList,
						updateList: updateList
					};
					UT.request(me.$.saveVendorBankAccountInfo);
				});
			},
			
			/* 계좌정보 저장 후 callback */
			completeSaveBankAccountInfo: function(e, res){
				var me = this;
				// 저장 후 조회
				me.onShowBankAccountList();
			},
			
			/* 계좌정보 삭제 */
			onDeleteBnkAcctInfo: function(){
				var me = this,
					message = "STD.N1300", // 삭제 하시겠습니까?
					provider = me.$.bnkAcctInfoPanel.getDataProvider();
				
				if(!me.formula('editState')) return;
				
				var checked = provider.selectionCheckedIndexes();
				if (checked && checked.length > 0) {
					UT.confirm(message, function() {
						var deleted = provider.removeItems(true);
						if(UT.isNotEmpty(deleted)){
							me.$.deleteVendorBankAccountInfo.set("body", {
								deletedBankAccountInfo: deleted
							});
							UT.request(me.$.deleteVendorBankAccountInfo);
						}else{
							me.$.bnkAcctInfoPanel.validate();
						}
					});
				}
				else{
					UT.alert("STD.N1600"); // 선택된 항목이 없습니다
				}
			},
			
			/* 계좌정보 삭제 완료 후 callback */
			completeDeleteBankAccountInfo: function(e, res){
				var me = this;
				me.onShowBankAccountList();
			},
			
            /* 재무정보 저장 */
            onSaveFinanceInfo: function(){
                var me = this,
                    financeInfoProvider = me.$.financeInfoPanel.getDataProvider()
                var insertList = financeInfoProvider.getNewItems(),
                    updateList = financeInfoProvider.getUpdateItems();

                if(UT.isEmpty(insertList) && UT.isEmpty(updateList)){
                    return UT.alert("STD.N1700");
                }
                if(!me.$.financeInfoPanel.validate()){
                	UT.alert("STD.E0000");
                	return;
                }
                UT.confirm("STD.N1200", function() {
                    me.$.saveListFinanceInfo.body = {
                        insertList: insertList,
                        updateList: updateList
                    };
                    UT.request(me.$.saveListFinanceInfo);
                });
            },
            
            /* 재무정보 저장 후 callback */
            completeSaveListFinanceInfo: function(e, res){
                var me = this;
                // 저장 후 조회
                me.onShowFinanceInfoList();
            },
			
            /* 재무정보 삭제 */
            onDeleteFinanceInfo: function(){
                var me = this,
                    message = "STD.N1300", // 삭제 하시겠습니까?
                    provider = me.$.financeInfoPanel.getDataProvider();

                var checked = provider.selectionCheckedIndexes();
                if (checked && checked.length > 0) {
                    UT.confirm(message, function() {
                        var deleted = provider.removeItems(true);
                        if(UT.isNotEmpty(deleted)){
                            me.$.deleteListFinanceInfo.set("body", {
                                deletedFinanceInfo: deleted
                            });
                            UT.request(me.$.deleteListFinanceInfo);
                        }else{
                            me.$.financeInfoPanel.validate();
                        }
                    });
                }
                else{
                    UT.alert("STD.N1600"); // 선택된 항목이 없습니다
                }
            },
			
            /* 재무정보 삭제 완료 후 callback */
            completeDeleteListFinanceInfo: function(e, res){
                var me = this;
                me.onShowFinanceInfoList();
            },
            
            /* 직원 저장 */
            onSaveLaborInfo: function(){
                var me = this,
                    laborInfoProvider = me.$.laborInfoPanel.getDataProvider();
                var insertList = laborInfoProvider.getNewItems(),
                updateList = laborInfoProvider.getUpdateItems();

	            if(UT.isEmpty(insertList) && UT.isEmpty(updateList)){
	                return UT.alert("STD.N1700");
	            }
                if(!me.$.laborInfoPanel.validate()){
                    UT.alert("STD.E0000");
                    return;
                }

                if(me._isDuplicated(laborInfoProvider.getItems(), "subj_yr")){
                    UT.alert(me.translate("STD.E1000",null,me.translate('대상 연도')),null, true); // 중복 데이터가 있습니다
                    return;
                }

                UT.confirm("STD.N1200", function() {
                    me.$.saveListLaborInfo.body = {
                        insertList: insertList,
                        updateList: updateList
                    };
                    UT.request(me.$.saveListLaborInfo);
                });
            },

            _isDuplicated: function(arr, condition){
                var uniqueArray = arr.filter(function(item, pos, self) {
                    return self.indexOf(SCUtil.Array.find(self,function(child){return child[condition] == item[condition];})) == pos;
                });

                if (arr.length !== uniqueArray.length) {
                    return true;
                }
            },
            
            /* 직원 저장 후 callback */
            completeSaveListLaborInfo: function(e, res){
                var me = this;
                me.onShowLaborInfoList();
            },
			
            /* 직원 삭제 */
            onDeleteLaborInfo: function(){
                var me = this,
                    message = "STD.N1300", // 삭제 하시겠습니까?
                    provider = this.$.laborInfoPanel.getDataProvider();

                var checked = provider.selectionCheckedIndexes();
                if (checked && checked.length > 0) {
                    UT.confirm(message, function() {
                    	var deleted = provider.removeItems(true);
                        if(UT.isNotEmpty(deleted)){
                            me.$.deleteListLaborInfo.set("body", {
                                deletedLaborInfo: deleted
                            });
                            UT.request(me.$.deleteListLaborInfo);
                        }
                    });
                }
                else{
                    UT.alert("STD.N1600"); // 선택된 항목이 없습니다
                }
            },
			
            /* 직원 삭제 완료 후 callback */
            completeDeleteListLaborInfo: function(e, res){
                var me = this;
                me.onShowLaborInfoList();
            },
            
            /* 인증정보 저장 */
            onSaveCertInfo: function(){
                var me = this,
                    certInfoProvider = me.$.certInfoPanel.getDataProvider();
                var insertList = certInfoProvider.getNewItems(),
                updateList = certInfoProvider.getUpdateItems();

                if(UT.isEmpty(insertList) && UT.isEmpty(updateList)){
                    return UT.alert("STD.N1700");
                }
                
                if(!me.$.certInfoPanel.validate()){
                    UT.alert("STD.E0000");
                    return;
                }

                UT.confirm("STD.N1200", function() {
                    me.$.saveListCertInfo.body = {
                        insertList: insertList,
                        updateList: updateList
                    };
                    UT.request(me.$.saveListCertInfo);
                });
            },
            
            /* 인증정보 저장 후 callback */
            completeSaveListCertInfo: function(e, res){
                var me = this;
                    me.onShowCertInfoList();
            },
			
            /* 인증정보 삭제 */
            onDeleteCertInfo: function(){
                var me = this,
                    message = "STD.N1300", // 삭제 하시겠습니까?
                    provider = this.$.certInfoPanel.getDataProvider();

                var checked = provider.selectionCheckedIndexes();
                if (checked && checked.length > 0) {
                    UT.confirm(message, function() {
                    	var deleted = provider.removeItems(true);
                        if(UT.isNotEmpty(deleted)){
                            me.$.deleteListCertInfo.set("body", {
                                deletedCertInfo: deleted
                            });
                            UT.request(me.$.deleteListCertInfo);
                        }
                    });
                }
                else{
                    UT.alert("STD.N1600"); // 선택된 항목이 없습니다
                }
            },
			
            /* 인증정보 삭제 완료 후 callback */
            completeDeleteListCertInfo: function(e, res){
                var me = this;
                me.onShowCertInfoList();
            },
			
			/* 재무정보 그리드 row 수정여부 function */
			onFinanceGridRowEdit : function(data, rowIndex){
				return (data.regr_typ_ccd == "VD");
			},
			
			/* 재무정보 그리드 대상 연도 수정 가능 여부 */
			onFinanceSubjYearEdit: function(data, item) {
				var me = this,
					provider = me.$.financeInfoPanel.getDataProvider();
				
				return (provider.getItemState(item.rowIndex) == 'created');
			},
			
			/* 직원 그리드 대상 연도 수정가능여부 */
			onYrEdit: function(data, item){
				var me = this,
					provider = me.$.laborInfoPanel.getDataProvider();
				return (provider.getItemState(item.rowIndex) == 'created');
			},
			
			/* 재무정보 그리드 validator-function */
			gridValidator: function(headerText,dataField,data){
				var me = this;
				
				if(dataField === "subj_yr"){
					// 코드 중복 체크
					var provider = me.$.financeInfoPanel.getDataProvider(),
						rows = provider.getItems();
					var cnt = 0;
					for (var i=0, len = rows.length; i<len; i++) {
						if(data[dataField] == rows[i][dataField] && data.regr_typ_ccd == rows[i].regr_typ_ccd){
							cnt++;
						}
						
						if(cnt > 1) {
							var regrTypCcd = UT.arrayFilterChange(me.codes.regrTypCcd, {key : "data", value : data["regr_typ_ccd"]});
							var regrTypNm = UT.isObject(regrTypCcd[0]) ? regrTypCcd[0].label : "";
							return me.translate("STD.VS1080",null, data[dataField], regrTypNm);
						}
					}
				}
				return true;
			},
			
			// invalid message 반환
			getInvalidCertDateMsg: function(data, headerText, dataField, compareField, defaultMsg) {
				var me = this;
				var compareColumn = me.$.certInfoPanel.getColumnElByName(compareField);
				var msg = null;
				
				// STD.E1013 : '{0}'은(는) '{1}'이후 날짜를 입력해야 합니다. -> dataField 값이 compareField 값보다 작으면 Invalid
				// STD.E1014 : '{0}'은(는) '{1}'이전 날짜를 입력해야 합니다. -> dataField 값이 compareField 값보다 크면 Invalid
				if ((defaultMsg == "STD.E1013" && data[dataField] < data[compareField]) ||
						(defaultMsg == "STD.E1014" && data[dataField] > data[compareField])) {
					msg = me.translate(defaultMsg, null, headerText, compareColumn && compareColumn.headerText ? compareColumn.headerText : "");
				}
				
				return msg;
			},
			
			/* 인증정보 그리드 validation */
			gridValidatorFnCert: function(headerText, dataField, data){
				var me = this;
				var msg = null;
				
				switch (dataField) {
					case "cert_publ_dt" :
						var date = new Date();
						if (data[dataField] && data[dataField] > UT.formatDate(date, "yyyyMMdd")) {
							msg = me.translate("STD.E1014", null, headerText, me.translate("현재"));
						}
						break;
					case "cert_efct_st_dt" :
						msg = me.getInvalidCertDateMsg(data, headerText, dataField, "cert_publ_dt", "STD.E1013");
						msg = msg ? msg : me.getInvalidCertDateMsg(data, headerText, dataField, "cert_efct_exp_dt", "STD.E1014");
						break;
					case "cert_efct_exp_dt" :
						msg = me.getInvalidCertDateMsg(data, headerText, dataField, "cert_publ_dt", "STD.E1013");
						msg = msg ? msg : me.getInvalidCertDateMsg(data, headerText, dataField, "cert_efct_st_dt", "STD.E1013");
						break;
					default :
						msg = null;
						break;
				}
				
				return msg ? msg : true;
			},
			
			/* 재무정보 그리드 edit end event */
			onItemEditEnd: function(event){
				var me = this,
					data = event.detail.data,
					item = event.detail.item,
					provider = event.detail.provider,
					oldValue = event.detail.oldValue,
					newValue = event.detail.newValue,
					grid = event.detail.grid;
				
				//([[translate('부채 금액')]] / [[translate('자본 금액')]]) X 100 (%)
				if("capt_amt" === item.dataField){  // 자본 금액
					var intr_tot_amt = UT.isNumber(data.currliablt_amt) ? data.currliablt_amt : 0; // 유동 부채 금액
					var capt_amt  = UT.isNumber(newValue) ? newValue : 0;
					var assetTotAmt = new BigNumber(intr_tot_amt);
					var captAmt  = new BigNumber(capt_amt);
					var result = null;
					if(assetTotAmt.comparedTo(0) !== 0 && captAmt.comparedTo(0) !== 0){
						result = assetTotAmt.div(captAmt).mul(100).toFixed(2);
						provider.setCellValue(item.rowIndex, "liablt_ro", result); // 부채 비율
					}
				}else if("currliablt_amt" === item.dataField){ // 유동 부채 금액
					var intr_tot_amt = UT.isNumber(newValue) ? newValue : 0;
					var capt_amt  = UT.isNumber(data.capt_amt) ? data.capt_amt : 0; // 자본 금액
					var assetTotAmt = new BigNumber(intr_tot_amt);
					var captAmt  = new BigNumber(capt_amt);
					var result = null;
					if(assetTotAmt.comparedTo(0) !== 0 && captAmt.comparedTo(0) !== 0){
						result = assetTotAmt.div(captAmt).mul(100).toFixed(2);
						provider.setCellValue(item.rowIndex, "liablt_ro", result);  // 부채 비율
					}
					//([[translate('영업이익 금액')]] / [[translate('매출 금액')]]) X 100 (%)
				}else if("oprtprf_amt" === item.dataField){  // 영업이익 금액
					var oprtprf_amt = UT.isNumber(newValue) ? newValue : 0;
					var sls_amt  = UT.isNumber(data.sls_amt) ? data.sls_amt : 0;  // 매출 금액
					var oprtprfAmt = new BigNumber(oprtprf_amt);
					var slsAmt   = new BigNumber(sls_amt);
					var result = null;
					if(oprtprfAmt.comparedTo(0) !== 0 && slsAmt.comparedTo(0) !== 0){
						result = oprtprfAmt.div(slsAmt).mul(100).toFixed(2);
						provider.setCellValue(item.rowIndex, "oprtprf_ro", result);  // 영업이익 비율
					}
				}else if("sls_amt" === item.dataField){  // 매출 금액
					var oprtprf_amt = UT.isNumber(data.oprtprf_amt) ? data.oprtprf_amt : 0;  // 영업이익 금액
					var sls_amt  = UT.isNumber(newValue) ? newValue : 0;
					var oprtprfAmt = new BigNumber(oprtprf_amt);
					var slsAmt   = new BigNumber(sls_amt);
					var result = null;
					if(oprtprfAmt.comparedTo(0) !== 0 && slsAmt.comparedTo(0) !== 0){
						result = oprtprfAmt.div(slsAmt).mul(100).toFixed(2);
						provider.setCellValue(item.rowIndex, "oprtprf_ro", result);  // 영업이익 비율
					}
				}
			},
			
			onRowRegex: function(data, item) {
				var me = this;
				if(["capt_amt", "sls_amt", "asst_amt", "currasst_amt", "currliablt_amt"].indexOf(item.dataField) > -1){
					return CCPrecManager.regex("amt");
				}
				if(item.dataField === "subj_yr"){
					return CCPrecManager.regex("number");
				}
				if(["oprtprf_ro","liablt_ro"].indexOf(item.dataField) > -1){
					return CCPrecManager.regex("percent");
				}
				return null;
			},
			
			/* 직원 그리드 edit end event */
			onLaborGridItemEditEnd: function(event){
				var me = this,
					data = event.detail.data,
					item = event.detail.item,
					provider = event.detail.provider,
					rows = me.codes.empTypCcd;
				
				if(item.dataField.indexOf("emp_typ_ccd") > -1){
					var sum = 0;
					for(var j=0; j<rows.length; j++) {
						sum += UT.toNumber(provider.getCellValue(item.rowIndex, "emp_typ_ccd_"+rows[j].data));
					}
					provider.setItemAt(item.rowIndex,{total : sum});
				}
			},
			
			/* 블록체인 Key생성 팝업 생성 */
			onOpenGenKeyPopup : function(){
				var me = this;
				var genKeyPopup = UT.popup("ep-sp-gen-key", me, "380", "250", {
					"complete" : function(popup, e){
						// 재조회
						popup.close();
						me.load();
					}
				}, {titleText : "Key 생성"});
				genKeyPopup.show();
				genKeyPopup.getWindowContent().load(me.get("basicInfo"));
			},

            // 인증서 등록 버튼 클릭 이벤트
            onCertInfoReg : function() {
                var me = this;
                var url = "sp/esourcing/vendorInfoMgt/openVdCertSelectionPage.do";
                var param = [
                    {
                        callbackUrl : "sp/esourcing/vendorInfoMgt/openVdCertSelectionPage.do",
                        order : "before"
                    }
                ];

                UT.popupJspByPost(url, param, me, "630", "630", {
                    "close": function (popup, e) {
                        var result = e.detail;

                        if (result === "S") {
                            UT.alert("STD.N1104");  // 등록하였습니다.
                            UT.request(me.$.findCertManagerInfo);
                        //}else if(result === "D"){
                        //    UT.alert("STD.VS1090");  // 이미 등록된 인증서 입니다.
                        }/*else{
                            UT.alert("STD.VS1091");  // 등록에 실패하였습니다.
                        }*/
                    }
                }, {titleText : "전자서명", resizable: false, draggable: false});
            }
        });
    </script>

</dom-module>