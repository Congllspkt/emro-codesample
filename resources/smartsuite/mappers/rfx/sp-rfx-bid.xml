<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sp-rfx-bid">
	<select id="findListRfxVd" resultType="map">
		/* sp-rfx-bid.findListRfxVd : 업체가 조회하는 RFX 정보 */
		SELECT RFX.RFX_UUID
		     , RFX.RFX_NO
		     , RFX.RFX_RND
		     , RFX.OORG_CD
		     , RFX.RFX_TIT
		     , RFX.RAUC_TYP_CCD
		     , RFX.RFX_TYP_CCD
		     , RFX.RFX_PURP_CCD
		     , RFX.RFX_CRN_DT
		     , RFX.RFX_ST_DTTM
		     , RFX.RFX_CLSG_DTTM
		     , RFX.RFX_CHG_CLSG_DTTM
		     , RFX.DOMOVRS_DIV_CCD AS RFX_DOMOVRS_DIV_CCD
		     , CASE WHEN RFX_BID.DOMOVRS_DIV_CCD IS NULL OR RFX_BID.DOMOVRS_DIV_CCD ='' THEN RFX.DOMOVRS_DIV_CCD
                    ELSE RFX_BID.DOMOVRS_DIV_CCD
                END AS DOMOVRS_DIV_CCD
		     , RFX.DFRM_RO
		     , RFX.PYMTMETH_CCD
		     , RFX.PYMTMETH_EXPLN
		     , RFX.DLVYMETH_CCD
		     , RFX.DLVYMETH_EXPLN
             , RFX.PYMTMETH_DOM_CCD
		     , RFX.PYMTMETH_DOM_EXPLN
		     , RFX.DLVYMETH_DOM_CCD
		     , RFX.DLVYMETH_DOM_EXPLN
             , RFX.PYMTMETH_OVS_CCD
		     , RFX.PYMTMETH_OVS_EXPLN
		     , RFX.DLVYMETH_OVS_CCD
		     , RFX.DLVYMETH_OVS_EXPLN
             , RFX.PYMTMETH_DLVYMETH_CHG_POSS_YN
		     , RFX.CUR_CCD
		     , RFX.COMP_TYP_CCD
		     , RFX.ITEM_SLCTN_TYP_CCD
		     , RFX.SLCTN_TYP_CCD
		     , RFX.AUTO_EXT_USE_YN
		     , RFX.AUTO_EXT_TM
		     , RFX.CNTR_ST_DT
		     , RFX.CNTR_EXP_DT
		     , RFX.ARRPORT_CCD
		     , RFX.SHPGMETH_CCD
		     , RFX.PURC_TYP_CCD
		     , RFX.BFG_YN
		     , RFX.PRESN_YN
		     , RFX.PRTL_BID_PERM_YN
		     , RFX.TRGPRC_USE_YN
		     , RFX.COSTSTR_USE_YN
		     , RFX.NPE_RO_VD_PUB_YN
		     , RFX.NPE_RO
		     , RFX.CBE_RO
		     , RFX.NPE_STS_CCD
		     , RFX.BFG_DTTM
		     , RFX.BFG_PLC
		     , RFX.BFG_PIC_ID
		     , RFX.PRESN_ST_DT
		     , RFX.PRESN_CLSG_DT
		     , RFX.PRESN_PIC_ID
		     , RFX.RFX_BUYER_RMK
		     , RFX.RFX_VD_RMK
		     , RFX.BUYER_ATHG_UUID
		     , RFX.VD_ATHG_UUID
		     , RFX.RFX_STS_CCD
		     , RFX.RFX_RES_STS_CCD
		     , RFX.RFX_APVL_USE_YN
		     , RFX.RFX_APVL_STS_CCD
		     , RFX.RFX_SLCTN_APVL_USE_YN
		     , RFX.RFX_SLCTN_APVL_STS_CCD
		     , RFX.STS
		     , RFX.REGR_ID
		     , RFX.REG_DTTM
		     , RFX.MODR_ID
		     , RFX.MOD_DTTM
		     , RFX.AUTO_EXT_USE_YN
		     , RFX.OPEN_DTTM
		     , RFX.IMMED_ST_USE_YN
		     , RFX.IMMED_OPEN_USE_YN
		     , RFX.CSTM_USE_YN  /* 컨소시엄 여부 */
		     , RFX.CSTM_TYP_CCD /* 컨소시엄 유형 */
		     , (
		        SELECT COUNT(RFX_ITEM_UUID)
		          FROM RFX_ITEM RFX_ITEM
		         WHERE RFX_ITEM.TEN_ID   = RFX.TEN_ID
		           AND RFX_ITEM.RFX_UUID = RFX.RFX_UUID
		           AND RFX_ITEM.STS     != 'D'
		       ) AS RFX_ITEM_CNT
		     , CASE WHEN RFX_BID.RFX_BID_STS_CCD IS NULL OR RFX_BID.RFX_BID_STS_CCD = '' THEN 'RCPT_WTG'
		            ELSE RFX_BID.RFX_BID_STS_CCD
		        END AS RFX_BID_STS_CCD /* 업체견적진행상태 P024 */
		     , CASE WHEN RFX.RFX_STS_CCD != 'ED' THEN 'N'
		            WHEN RFX_BID.SLCTN_YN IS NULL OR RFX_BID.SLCTN_YN = '' THEN 'N'
		            ELSE RFX_BID.SLCTN_YN
		        END AS SLCTN_YN /* 선정 여부 */
		     , CASE WHEN RFX.RFX_RES_STS_CCD IN ('FAILDBID', 'REQTA', 'CNCL') THEN 'Y' -- C: 유찰, R: 재견적, D: 취소
		            ELSE 'N'
		        END AS RFX_RES_STS_CCD_C_YN /* 유찰여부 */
		     , RFX_BID.RFX_BID_UUID
		     , RFX_BID.RFX_BID_NO
		     , RFX_BID.MOD_DTTM
		     , RFX_BID.RFX_BID_DTTM /* 제출일자 */
		     , (
		        SELECT USR_NM
		          FROM USR USR
		         WHERE USR.TEN_ID = RFX.TEN_ID
		           AND USR.USR_ID = RFX.BFG_PIC_ID
		           AND USR.STS   != 'D'
		       ) AS BFG_PIC_NM /* 현장설명회 담당자 */
		     , (
		        SELECT USR_NM
		          FROM USR USR
		         WHERE USR.TEN_ID = RFX.TEN_ID
		           AND USR.USR_ID = RFX.PRESN_PIC_ID
		           AND USR.STS   != 'D'
		       ) AS PRESN_PIC_NM /* 제안발표 담당자 */
		     , RFX_BID.SLCTN_CNCL_RSN /* 선정 취소 사유 */
		     , RFX_BID.GUP_RSN        /* 포기 사유 */
		     , RFX.RFX_PRESN_USE_YN
		  FROM RFX RFX
		  LEFT JOIN RFX_VD RFX_VD
		    ON RFX_VD.TEN_ID   = #{g.tenant}
		   AND RFX_VD.RFX_UUID = RFX.RFX_UUID
		   AND RFX_VD.VD_CD    = #{g.vd_cd}
		   AND RFX_VD.MULTRND_SUBJ_XCEPT_YN = 'N'
		  LEFT OUTER JOIN RFX_BID RFX_BID
		    ON RFX_BID.TEN_ID   = #{g.tenant}
		   AND RFX_BID.RFX_NO   = RFX.RFX_NO
		   AND RFX_BID.RFX_RND  = RFX.RFX_RND
		   AND RFX_BID.VD_CD    = #{g.vd_cd}
		   AND RFX_BID.RFX_BID_EFCT_YN = 'Y'
		 WHERE RFX.TEN_ID       = #{g.tenant}
		   AND RFX.STS         != 'D'
		   AND RFX.RFX_TYP_CCD != 'RAUC'
		   AND (
		           (
		               RFX.COMP_TYP_CCD != 'OBID' /*공개가 아닌경우(지명,수의)*/
		           AND RFX_VD.VD_CD      = #{g.vd_cd}
		           )
		        OR (
		               RFX.COMP_TYP_CCD = 'OBID' /*공개*/
		           )
		       )
		   <if test="p.oorg_cds != null and p.oorg_cds.size() != 0">
		       AND RFX.OORG_CD IN 
		       <foreach close=")" collection="p.oorg_cds" item="oorg_cd" open="(" separator=",">
		           #{oorg_cd}
		       </foreach>
		   </if>
		   <if test="p.rfx_purp_ccd != null">
		       AND RFX.RFX_PURP_CCD = #{p.rfx_purp_ccd}
		   </if>
		   <if test="p.rfx_typ_ccd != null">
		       AND RFX.RFX_TYP_CCD = #{p.rfx_typ_ccd}
		   </if>
		   <if test="p.purc_typ_ccd != null">
		       AND RFX.PURC_TYP_CCD = #{p.purc_typ_ccd}
		   </if>
		   <if test="p.comp_typ_ccds != null and p.comp_typ_ccds.size() &gt; 0">
		       AND RFX.COMP_TYP_CCD IN
		       <foreach close=")" collection="p.comp_typ_ccds" item="comp_typ_ccd" open="(" separator=",">
		           #{comp_typ_ccd}
		       </foreach>
		   </if>
		   <if test="p.item_slctn_typ_ccd != null">
		       AND RFX.ITEM_SLCTN_TYP_CCD = #{p.item_slctn_typ_ccd}
		   </if>
		   <choose>
		       <when test="p.rfx_sts_ccds != null and p.rfx_sts_ccds.size() &gt; 0">
		           AND RFX.RFX_STS_CCD IN
		           <foreach close=")" collection="p.rfx_sts_ccds" item="rfx_sts_ccd" open="(" separator=",">
		               #{rfx_sts_ccd}
		           </foreach>
		       </when>
		       <otherwise>
		           /* 견적현황 조회시 저장,진행품의,반려 외에는 다보임 */
		           AND RFX.RFX_STS_CCD NOT IN ('CRNG','APVL_PRGSG','NEGO_PRGSG')
		       </otherwise>
		   </choose>
		   <if test="p.rfx_res_sts_ccd != null">
		       AND RFX.RFX_RES_STS_CCD = #{p.rfx_res_sts_ccd}
		   </if>
		   <if test="p.rfx_bid_sts_ccd != null and p.rfx_bid_sts_ccd != ''">
		       AND COALESCE(RFX_BID.RFX_BID_STS_CCD,'RCPT_WTG') = #{p.rfx_bid_sts_ccd}
		   </if>
		   <if test="p.rfx_bid_sts_ccds != null and p.rfx_bid_sts_ccds.size() &gt; 0">
		       <choose>
		           <when test="g.contains(p.rfx_bid_sts_ccds, &quot;RCPT_WTG&quot;)">
		               AND (
		                    RFX_BID.RFX_BID_STS_CCD IS NULL OR /* P : 미접수 */
		                    RFX_BID.RFX_BID_STS_CCD = ''
		                    <if test="p.rfx_bid_sts_ccds.size() &gt; 1">
		                        OR RFX_BID.RFX_BID_STS_CCD IN
		                           <foreach close=")" collection="p.rfx_bid_sts_ccds" item="rfx_bid_sts_ccd" open="(" separator=",">
		                               #{rfx_bid_sts_ccd}
		                           </foreach>
		                    </if>
		                   )
		           </when>
		           <otherwise>
		               AND RFX_BID.RFX_BID_STS_CCD IN
		               <foreach close=")" collection="p.rfx_bid_sts_ccds" item="rfx_bid_sts_ccd" open="(" separator=",">
		                   #{rfx_bid_sts_ccd}
		               </foreach>
		           </otherwise>
		       </choose>
		   </if>
		   <if test="p.from_rfx_crn_dt != null">
		       AND RFX.RFX_CRN_DT &gt;= #{p.from_rfx_crn_dt}
		   </if>
		   <if test="p.to_rfx_crn_dt != null">
		       <bind name="toDatePattern" value="g.getPlusDays(p.to_rfx_crn_dt,1)"/>
		       AND RFX.RFX_CRN_DT <![CDATA[<]]> #{toDatePattern}
		   </if>
		   <if test="p.from_rfx_clsg_dttm != null">
		       AND RFX.RFX_CLSG_DTTM &gt;= #{p.from_rfx_clsg_dttm}
		   </if>
		   <if test="p.to_rfx_clsg_dttm != null">
		       <bind name="toCloseDatePattern" value="g.getPlusDays(p.to_rfx_clsg_dttm,1)"/>
		       AND RFX.RFX_CLSG_DTTM <![CDATA[<]]> #{toCloseDatePattern}
		   </if>
		   <choose>
		       <when test="p.rfx_nos != null and p.rfx_nos.size() != 0">
		           AND UPPER(RFX.RFX_NO) IN 
		           <foreach close=")" collection="p.rfx_nos" item="rfx_no" open="(" separator=",">
		               #{rfx_no}
		           </foreach>
		       </when>
		       <otherwise>
		           <if test="p.rfx_no != null and p.rfx_no != ''">
		               <bind name="noPattern" value="'%' + p.rfx_no + '%'"/>
		               AND UPPER(RFX.RFX_NO) LIKE UPPER(#{noPattern})
		           </if>
		       </otherwise>
		   </choose>
		   <choose>
		       <when test="p.rfx_bid_nos != null and p.rfx_bid_nos.size() != 0">
		           AND UPPER(RFX_BID.RFX_BID_NO) IN 
		           <foreach close=")" collection="p.rfx_bid_nos" item="rfx_bid_no" open="(" separator=",">
		                #{rfx_bid_no}
		           </foreach>
		       </when>
		       <otherwise>
		           <if test="p.rfx_bid_no != null and p.rfx_bid_no != ''">
		               <bind name="rfxBidNoPattern" value="'%' + p.rfx_bid_no + '%'"/>
		               AND UPPER(RFX_BID.RFX_BID_NO) LIKE UPPER(#{rfxBidNoPattern})
		           </if>
		       </otherwise>
		   </choose>
		   <if test="p.rfx_tit != null and p.rfx_tit != ''">
		       <bind name="rfxTitPattern" value="'%' + p.rfx_tit + '%'"/>
		       AND UPPER(RFX.RFX_TIT) LIKE UPPER(#{rfxTitPattern})
		   </if>
		 ORDER BY RFX.RFX_NO DESC, RFX.RFX_RND DESC
	</select>
	<resultMap id="resultMap-findRfxBid" type="map">
		<result column="ENCPT_RFX_BID_AMT" javaType="string" property="encpt_rfx_bid_amt" typeHandler="stringClob"/>
	</resultMap>
	<select id="findRfxBid" resultMap="resultMap-findRfxBid">
		/* sp-rfx-bid.findRfxBid */
		SELECT RFX.RFX_UUID
		     , RFX.RFX_NO
		     , RFX.RFX_TIT
		     , RFX.RFX_RND
		     , RFX.PRE_RFX_UUID
		     , RFX.OORG_CD
		     , RFX.RFX_PURP_CCD
		     , RFX.RAUC_TYP_CCD
		     , RFX.RFX_TYP_CCD
		     , RFX.RFX_CRN_DT
		     , RFX.RFX_ST_DTTM
		     , RFX.RFX_CLSG_DTTM
		     , RFX.RFX_CHG_CLSG_DTTM
		     , RFX.DFRM_RO
             , RFX.PYMTMETH_DOM_CCD
		     , RFX.PYMTMETH_DOM_EXPLN
		     , RFX.DLVYMETH_DOM_CCD
		     , RFX.DLVYMETH_DOM_EXPLN
             , RFX.PYMTMETH_OVS_CCD
		     , RFX.PYMTMETH_OVS_EXPLN
		     , RFX.DLVYMETH_OVS_CCD
		     , RFX.DLVYMETH_OVS_EXPLN
             , RFX.PYMTMETH_DLVYMETH_CHG_POSS_YN
		     , RFX.COMP_TYP_CCD
		     , RFX.ITEM_SLCTN_TYP_CCD
		     , RFX.SLCTN_TYP_CCD
		     , RFX.AUTO_EXT_USE_YN
		     , RFX.AUTO_EXT_TM
		     , RFX.CNTR_ST_DT
		     , RFX.CNTR_EXP_DT
		     , RFX.PURC_TYP_CCD
		     , RFX.BFG_YN
		     , RFX.PRESN_YN
		     , RFX.PRTL_BID_PERM_YN
		     , RFX.COSTSTR_USE_YN
		     , RFX.NPE_RO_VD_PUB_YN
		     , RFX.CBE_TYP_CCD
		     , RFX.NPE_RO
		     , RFX.CBE_RO
		     , RFX.BFG_DTTM
		     , RFX.BFG_PLC
		     , RFX.BFG_PIC_ID
		     , RFX.PRESN_ST_DT
		     , RFX.PRESN_CLSG_DT
		     , RFX.PRESN_PIC_ID
		     , RFX.RFX_BUYER_RMK
		     , RFX.RFX_VD_RMK
		     , RFX.BUYER_ATHG_UUID
		     , RFX.VD_ATHG_UUID
		     , RFX.RFX_STS_CCD
		     , RFX.RFX_RES_STS_CCD
		     , RFX.RFX_APVL_USE_YN
		     , RFX.RFX_APVL_STS_CCD
		     , RFX.RFX_SLCTN_APVL_USE_YN
		     , RFX.RFX_SLCTN_APVL_STS_CCD
		     , RFX.AUTO_EXT_POSS_WD
		     , RFX.OPEN_DTTM
		     , RFX.IMMED_ST_USE_YN
		     , RFX.IMMED_OPEN_USE_YN
		     , RFX.LONG_TERM_PROD_EFF_USE_YN
		     , RFX.CSTM_USE_YN                              /* 컨소시엄 여부 */
		     , RFX.CSTM_TYP_CCD                             /* 컨소시엄 유형 */
		     , (
		        SELECT COUNT(RFX_ITEM_UUID)
		          FROM RFX_ITEM RFX_ITEM
		         WHERE RFX_ITEM.RFX_UUID = RFX.RFX_UUID
		       ) AS RFX_ITEM_CNT
		     , RFX_BID.RFX_BID_UUID
		     , RFX_BID.RFX_BID_NO
		     , RFX_BID.RFX_BID_REVNO
		     , RFX_BID.RFX_BID_EFCT_YN
		     , RFX_BID.VD_CD
		     , RFX_BID.RFX_BID_EFCT_DT
		     , RFX.DOMOVRS_DIV_CCD AS RFX_DOMOVRS_DIV_CCD
		     , CASE WHEN RFX_BID.DOMOVRS_DIV_CCD IS NOT NULL  THEN RFX_BID.DOMOVRS_DIV_CCD
		            WHEN RFX.DOMOVRS_DIV_CCD != 'DOMOVS' THEN RFX.DOMOVRS_DIV_CCD
		        END AS DOMOVRS_DIV_CCD
		     , CASE WHEN RFX_BID.PYMTMETH_CCD IS NOT NULL  THEN RFX_BID.PYMTMETH_CCD
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOM' AND RFX.PYMTMETH_DOM_CCD IS NOT NULL  THEN RFX.PYMTMETH_DOM_CCD
		            WHEN RFX.DOMOVRS_DIV_CCD = 'OVS' AND  RFX.PYMTMETH_OVS_CCD IS NOT NULL  THEN RFX.PYMTMETH_OVS_CCD
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOMOVRS' THEN RFX_BID.PYMTMETH_CCD
		            ELSE RFX.PYMTMETH_CCD
		        END AS PYMTMETH_CCD
		     , CASE WHEN RFX_BID.PYMTMETH_EXPLN IS NOT NULL  THEN RFX_BID.PYMTMETH_EXPLN
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOM' THEN RFX.PYMTMETH_DOM_EXPLN
		            WHEN RFX.DOMOVRS_DIV_CCD = 'OVS' THEN RFX.PYMTMETH_OVS_EXPLN
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOMOVRS' THEN RFX_BID.PYMTMETH_EXPLN
		            ELSE RFX.PYMTMETH_EXPLN
		        END AS PYMTMETH_EXPLN
		     , CASE WHEN RFX_BID.DLVYMETH_CCD IS NOT NULL  THEN RFX_BID.DLVYMETH_CCD
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOM' THEN RFX.DLVYMETH_DOM_CCD
		            WHEN RFX.DOMOVRS_DIV_CCD = 'OVS' THEN RFX.DLVYMETH_OVS_CCD
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOMOVRS' THEN RFX_BID.DLVYMETH_CCD
		            ELSE RFX.DLVYMETH_CCD
		        END AS DLVYMETH_CCD
		     , CASE WHEN RFX_BID.DLVYMETH_EXPLN IS NOT NULL  THEN RFX_BID.DLVYMETH_EXPLN
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOM' THEN RFX.DLVYMETH_DOM_EXPLN
		            WHEN RFX.DOMOVRS_DIV_CCD = 'OVS' THEN RFX.DLVYMETH_OVS_EXPLN
		            WHEN RFX.DOMOVRS_DIV_CCD = 'DOMOVRS' THEN RFX_BID.DLVYMETH_EXPLN
		            ELSE RFX.DLVYMETH_EXPLN
		        END AS DLVYMETH_EXPLN
		     , CASE WHEN RFX_BID.CUR_CCD IS NULL OR RFX_BID.CUR_CCD = '' THEN RFX.CUR_CCD
		            ELSE RFX_BID.CUR_CCD
		        END AS CUR_CCD
		     , RFX_BID.RFX_BID_AMT
		     , RFX_BID.ATHG_UUID
		     , CASE WHEN RFX_BID.RFX_BID_STS_CCD IS NULL OR RFX_BID.RFX_BID_STS_CCD = '' THEN 'RCPT_WTG'
		            ELSE RFX_BID.RFX_BID_STS_CCD
		        END AS RFX_BID_STS_CCD            /*    업체견적진행상태    P024*/
		     , CASE WHEN RFX.RFX_STS_CCD != 'ED' THEN 'N'
		            WHEN RFX_BID.SLCTN_YN IS NULL OR RFX_BID.SLCTN_YN = '' THEN 'N'
		            ELSE RFX_BID.SLCTN_YN
		        END AS SLCTN_YN               /* 선정 여부 */
		     , RFX_BID.PFDBIDER_YN
		     , RFX_BID.RMK
		     , RFX_BID.RFX_BID_DTTM
		     , (
		        SELECT USR_NM
		          FROM USR USR
		         WHERE USR.TEN_ID = RFX.TEN_ID
		           AND USR.USR_ID = RFX.BFG_PIC_ID
		           AND USR.STS   != 'D'
		       ) AS BFG_PIC_NM        /* 현장설명회 담당자 */
		     , (
		        SELECT USR_NM
		          FROM USR USR
		         WHERE USR.TEN_ID = RFX.TEN_ID
		           AND USR.USR_ID = RFX.PRESN_PIC_ID
		           AND USR.STS   != 'D'
		       ) AS PRESN_PIC_NM        /* 제안발표 담당자 */
		     , CASE WHEN RFX_VD.VD_CD IS NULL OR RFX_VD.VD_CD = '' THEN 'N'
		            ELSE 'Y'
		        END AS EXIST_RFX_VD
		     , RFX_BID.GUP_RSN
		     , CASE WHEN (
		                  SELECT COUNT(1)
		                    FROM RFX_ITEM RFX_ITEM
		                   WHERE RFX_ITEM.TEN_ID   = RFX.TEN_ID
		                     AND RFX_ITEM.RFX_UUID = RFX.RFX_UUID
		                     AND RFX_ITEM.ITEM_CD_CRN_TYP_CCD = 'CDLS'
		                     AND RFX_ITEM.STS     != 'D'
		                 ) &gt; 0 THEN 'Y'
		            ELSE 'N'
		        END AS HAS_NO_CD_ITEM
		      , RFX_BID.ENCPT_RFX_BID_AMT    /* 암호화 견적 금액 */
		   FROM RFX RFX
		   LEFT JOIN RFX_VD RFX_VD
		     ON RFX_VD.TEN_ID   = #{g.tenant}
		    AND RFX_VD.RFX_UUID = RFX.RFX_UUID
		    AND RFX_VD.MULTRND_SUBJ_XCEPT_YN = 'N'
		    AND RFX_VD.VD_CD    = #{g.vd_cd}
		    AND RFX_VD.STS     != 'D'
		   LEFT OUTER JOIN RFX_BID RFX_BID
		     ON RFX_BID.TEN_ID   = #{g.tenant}
		    AND RFX_BID.RFX_NO   = RFX.RFX_NO
		    AND RFX_BID.RFX_RND  = RFX.RFX_RND
		    AND RFX_BID.RFX_BID_EFCT_YN = 'Y'
		    AND RFX_BID.STS     != 'D'
		    AND RFX_BID.VD_CD    = #{g.vd_cd}
		  WHERE RFX.TEN_ID   = #{g.tenant}
		    AND RFX.RFX_UUID = #{p.rfx_uuid}
		    AND RFX.STS     != 'D'
		    <if test="p.rfx_bid_uuid != null and p.rfx_bid_uuid != ''">
		        AND RFX_BID.RFX_BID_UUID = #{p.rfx_bid_uuid}
		    </if>
	</select>
	<select id="findRfxBidPrevRev" resultType="map">
		/* sp-rfx-bid.findRfxBidPrevRev */
		SELECT RFX.RFX_UUID
		     , RFX.RFX_NO
		     , RFX.RFX_TIT
		     , RFX.RFX_RND
		     , RFX.PRE_RFX_UUID
		     , RFX.OORG_CD
		     , RFX.RFX_PURP_CCD
		     , RFX.RAUC_TYP_CCD
		     , RFX.RFX_TYP_CCD
		     , RFX.RFX_CRN_DT
		     , RFX.RFX_ST_DTTM
		     , RFX.RFX_CLSG_DTTM
		     , RFX.RFX_CHG_CLSG_DTTM
		     , RFX.DOMOVRS_DIV_CCD AS RFX_DOMOVRS_DIV_CCD
		     , CASE WHEN RFX_BID.DOMOVRS_DIV_CCD IS NULL OR RFX_BID.DOMOVRS_DIV_CCD = '' THEN RFX.DOMOVRS_DIV_CCD
		            ELSE RFX_BID.DOMOVRS_DIV_CCD
		        END AS DOMOVRS_DIV_CCD
		     , RFX.DFRM_RO
             , CASE WHEN RFX_BID.PYMTMETH_CCD IS NULL OR RFX_BID.PYMTMETH_CCD = '' THEN RFX.PYMTMETH_CCD
                    ELSE RFX_BID.PYMTMETH_CCD
                END AS PYMTMETH_CCD
		     , CASE WHEN RFX_BID.PYMTMETH_EXPLN IS NULL OR RFX_BID.PYMTMETH_EXPLN = '' THEN RFX.PYMTMETH_EXPLN
                    ELSE RFX_BID.PYMTMETH_EXPLN
                END AS PYMTMETH_EXPLN
		     , CASE WHEN RFX_BID.DLVYMETH_CCD IS NULL OR RFX_BID.DLVYMETH_CCD = '' THEN RFX.DLVYMETH_CCD
                    ELSE RFX_BID.DLVYMETH_CCD
                END AS DLVYMETH_CCD
		     , CASE WHEN RFX_BID.DLVYMETH_EXPLN IS NULL OR RFX_BID.DLVYMETH_EXPLN = '' THEN RFX.DLVYMETH_EXPLN
                    ELSE RFX_BID.DLVYMETH_EXPLN
                END AS DLVYMETH_EXPLN
             , RFX.PYMTMETH_DOM_CCD
		     , RFX.PYMTMETH_DOM_EXPLN
		     , RFX.DLVYMETH_DOM_CCD
		     , RFX.DLVYMETH_DOM_EXPLN
             , RFX.PYMTMETH_OVS_CCD
		     , RFX.PYMTMETH_OVS_EXPLN
		     , RFX.DLVYMETH_OVS_CCD
		     , RFX.DLVYMETH_OVS_EXPLN
             , RFX.PYMTMETH_DLVYMETH_CHG_POSS_YN
		     , RFX.COMP_TYP_CCD
		     , RFX.ITEM_SLCTN_TYP_CCD
		     , RFX.SLCTN_TYP_CCD
		     , RFX.AUTO_EXT_USE_YN
		     , RFX.AUTO_EXT_TM
		     , RFX.CNTR_ST_DT
		     , RFX.CNTR_EXP_DT
		     , RFX.PURC_TYP_CCD
		     , RFX.BFG_YN
		     , RFX.PRESN_YN
		     , RFX.PRTL_BID_PERM_YN
		     , RFX.COSTSTR_USE_YN
		     , RFX.NPE_RO_VD_PUB_YN
		     , RFX.CBE_TYP_CCD
		     , RFX.NPE_RO
		     , RFX.CBE_RO
		     , RFX.BFG_DTTM
		     , RFX.BFG_PLC
		     , RFX.BFG_PIC_ID
		     , RFX.PRESN_ST_DT
		     , RFX.PRESN_CLSG_DT
		     , RFX.PRESN_PIC_ID
		     , RFX.RFX_BUYER_RMK
		     , RFX.RFX_VD_RMK
		     , RFX.BUYER_ATHG_UUID
		     , RFX.VD_ATHG_UUID
		     , RFX.RFX_STS_CCD
		     , RFX.RFX_RES_STS_CCD
		     , RFX.RFX_APVL_USE_YN
		     , RFX.RFX_APVL_STS_CCD
		     , RFX.RFX_SLCTN_APVL_USE_YN
		     , RFX.RFX_SLCTN_APVL_STS_CCD
		     , RFX.AUTO_EXT_POSS_WD
		     , RFX.OPEN_DTTM
		     , RFX.IMMED_ST_USE_YN
		     , RFX.IMMED_OPEN_USE_YN
		     , RFX.CSTM_USE_YN  /* 컨소시엄 여부 */
		     , RFX.CSTM_TYP_CCD /* 컨소시엄 유형 */
		     , #{g.vd_cd} AS VD_CD
		     , (
		        SELECT CASE WHEN 'en_US' = #{g.locale} THEN VD.VD_NM_EN
		                    ELSE VD.VD_NM
		                END
		          FROM VD VD
		         WHERE VD.TEN_ID = #{g.tenant}
		           AND VD.VD_CD  = #{g.vd_cd}
		       ) AS VD_NM
		     , (
		        SELECT COUNT(RFX_ITEM_UUID)
		          FROM RFX_ITEM RFX_ITEM
		         WHERE RFX_ITEM.TEN_ID   = RFX.TEN_ID
		           AND RFX_ITEM.RFX_UUID = RFX.RFX_UUID
		           AND RFX_ITEM.STS     != 'D'
		       ) AS RFX_ITEM_CNT
		     , (
		        SELECT USR_NM
		          FROM USR USR
		         WHERE USR.TEN_ID = RFX.TEN_ID
		           AND USR.USR_ID = RFX.BFG_PIC_ID
		           AND USR.STS   != 'D'
		       ) AS BFG_PIC_NM /* 현장설명회 담당자 */
		     , (
		        SELECT USR_NM
		          FROM USR USR
		         WHERE USR.TEN_ID = RFX.TEN_ID
		           AND USR.USR_ID = RFX.PRESN_PIC_ID
		           AND USR.STS   != 'D'
		       ) AS PRESN_PIC_NM /* 제안발표 담당자 */
		     , NULL AS RFX_BID_UUID
		     , NULL AS RFX_BID_NO
		     , 1    AS RFX_BID_REVNO
		     , NULL AS RFX_BID_EFCT_DT
		     , RFX_BID.RFX_BID_UUID AS PREV_RFX_BID_UUID
		     , CASE WHEN RFX_BID.CUR_CCD IS NULL OR RFX_BID.CUR_CCD = '' THEN RFX.CUR_CCD
		            ELSE RFX_BID.CUR_CCD
		        END AS CUR_CCD
		     , RFX_BID.RFX_BID_AMT
		     , RFX_BID.ATHG_UUID
		     , RFX_BID.RMK
		     , NULL AS RFX_BID_DTTM
		     , 'RCPT_WTG' AS RFX_BID_STS_CCD
		     , 'N'  AS SLCTN_YN
		     , CASE WHEN (
		                  SELECT COUNT(1)
		                    FROM RFX_ITEM RFX_ITEM
		                   WHERE RFX_ITEM.TEN_ID   = RFX.TEN_ID
		                     AND RFX_ITEM.RFX_UUID = RFX.RFX_UUID
		                     AND RFX_ITEM.ITEM_CD_CRN_TYP_CCD = 'CDLS'
		                     AND RFX_ITEM.STS     != 'D'
		                 ) &gt; 0 THEN 'Y'
		            ELSE 'N'
		        END AS HAS_NO_CD_ITEM
		  FROM RFX RFX
		  LEFT JOIN RFX_VD RFX_VD
		    ON RFX_VD.TEN_ID   = #{g.tenant}
		   AND RFX_VD.RFX_UUID = RFX.RFX_UUID
		   AND RFX_VD.MULTRND_SUBJ_XCEPT_YN = 'N'
		   AND RFX_VD.VD_CD    = #{g.vd_cd}
		   AND RFX_VD.STS     != 'D'
		  LEFT OUTER JOIN RFX_BID RFX_BID
		    ON RFX_BID.TEN_ID   = #{g.tenant}
		   AND RFX_BID.RFX_NO   = RFX.RFX_NO
		   AND RFX_BID.RFX_RND  = CAST(#{p.rfx_rnd} AS INT)
		   AND RFX_BID.RFX_BID_EFCT_YN = 'Y'
		   AND RFX_BID.VD_CD    = #{g.vd_cd}
		   AND RFX_BID.STS     != 'D'
		 WHERE RFX.TEN_ID   = #{g.tenant}
		   AND RFX.RFX_UUID = #{p.rfx_uuid}
		   AND RFX.STS     != 'D'
	</select>
	<insert id="insertRfxBid">
		/* sp-rfx-bid.insertRfxBid */
		INSERT INTO RFX_BID (
			TEN_ID
			, RFX_BID_UUID
			, RFX_BID_NO
			, RFX_BID_REVNO
			, RFX_BID_EFCT_YN
			, VD_CD
			, RFX_UUID
			, RFX_NO
			, RFX_RND
			, RFX_BID_EFCT_DT
            , DOMOVRS_DIV_CCD
			, PYMTMETH_CCD
			, PYMTMETH_EXPLN
			, DLVYMETH_CCD
			, DLVYMETH_EXPLN
			, ARRPORT_CCD
			, SHPGPORT_CCD
			, CUR_CCD
			, RFX_BID_AMT
			, ENCPT_RFX_BID_AMT
			, ATHG_UUID
			, RFX_BID_STS_CCD
			<choose>
				<when test="p.rfx_bid_sts_ccd == &quot;SUBM&quot;">
					, RFX_BID_DTTM
					, VD_SUBMR_ID
				</when>
				<when test="p.rfx_bid_sts_ccd == &quot;CRNG&quot;">
					, VD_SUBMR_ID
				</when>
			</choose>
			, GUP_RSN
			, RFX_BID_ATHG_UUID
			, SLCTN_YN
			, PFDBIDER_YN
			, ARRPORT_EXPLN
			, RMK
			, STS
			, REGR_ID
			, REG_DTTM
			, MODR_ID
			, MOD_DTTM
		) VALUES (
			#{g.tenant}
			, #{p.rfx_bid_uuid}
			, #{p.rfx_bid_no}
			, CAST(#{p.rfx_bid_revno} AS INT)
			, #{p.rfx_bid_efct_yn}
			, #{g.vd_cd}
			, #{p.rfx_uuid}
			, #{p.rfx_no}
			, CAST(#{p.rfx_rnd} AS INT)
			, #{p.rfx_bid_efct_dt}
            , #{p.domovrs_div_ccd}
			, #{p.pymtmeth_ccd}
			, #{p.pymtmeth_expln}
			, #{p.dlvymeth_ccd}
			, #{p.dlvymeth_expln}
			, #{p.arrport_ccd}
			, #{p.shpgport_ccd}
			, #{p.cur_ccd}
			, CAST(#{p.rfx_bid_amt} AS FLOAT  )
			, #{p.encpt_rfx_bid_amt}
			, #{p.athg_uuid}
			, #{p.rfx_bid_sts_ccd}
			<choose>
				<when test="p.rfx_bid_sts_ccd == &quot;SUBM&quot;">
					 , #{g.now}
					 , #{g.username}
				</when>
				<when test="p.rfx_bid_sts_ccd == &quot;CRNG&quot;">
					,#{g.username}
				</when>
			</choose>
			<choose>
			    <when test="p.rfx_bid_sts_ccd == &quot;GUP&quot;">
			        , #{p.gup_rsn}
			    </when>
			    <otherwise>
			        , NULL
			    </otherwise>
			</choose>
			, #{p.rfx_bid_athg_uuid}
			, #{p.slctn_yn}
			, #{p.pfdbider_yn}
			, #{p.arrport_expln}
			, #{p.rmk}
			, 'C'
			, #{g.username}
			, #{g.now}
			, #{g.username}
			, #{g.now}
		)
	</insert>
	<update id="updateRfxBid">
		/* sp-rfx-bid.updateRfxBid */
		UPDATE RFX_BID
		   SET RFX_BID_REVNO     = CAST(#{p.rfx_bid_revno} AS INT)
		     , RFX_BID_EFCT_YN   = #{p.rfx_bid_efct_yn}
		     , RFX_BID_EFCT_DT   = #{p.rfx_bid_efct_dt}
             , DOMOVRS_DIV_CCD   = #{p.domovrs_div_ccd}
		     , PYMTMETH_CCD      = #{p.pymtmeth_ccd}
		     , PYMTMETH_EXPLN    = #{p.pymtmeth_expln}
		     , DLVYMETH_CCD      = #{p.dlvymeth_ccd}
		     , DLVYMETH_EXPLN    = #{p.dlvymeth_expln}
		     , ARRPORT_CCD       = #{p.arrport_ccd}
		     , SHPGPORT_CCD      = #{p.shpgport_ccd}
		     , CUR_CCD           = #{p.cur_ccd}
		     , RFX_BID_AMT       = CAST(#{p.rfx_bid_amt} AS FLOAT  )
		     , ENCPT_RFX_BID_AMT = #{p.encpt_rfx_bid_amt}
		     , ATHG_UUID         = #{p.athg_uuid}
		     , RFX_BID_STS_CCD   = #{p.rfx_bid_sts_ccd}
		     <choose>
				 <when test="p.rfx_bid_sts_ccd == &quot;SUBM&quot;">
					 , VD_SUBMR_ID  = #{g.username}
					 , RFX_BID_DTTM = #{g.now}
				 </when>
				 <when test="p.rfx_bid_sts_ccd == &quot;CRNG&quot;">
					 , VD_SUBMR_ID  = #{g.username}
				 </when>
			 </choose>
		     , RFX_BID_ATHG_UUID = #{p.rfx_bid_athg_uuid}
		     , SLCTN_YN          = #{p.slctn_yn}
		     , PFDBIDER_YN       = #{p.pfdbider_yn}
		     , ARRPORT_EXPLN     = #{p.arrport_expln}
		     , RMK               = #{p.rmk}
		     , STS               = 'U'
		     , MODR_ID           = #{g.username}
		     , MOD_DTTM          = #{g.now}
		 WHERE TEN_ID       = #{g.tenant}
		   AND RFX_BID_UUID = #{p.rfx_bid_uuid}
	</update>
	<update id="updateRfxBidValidYn">
		/* sp-rfx-bid.updateRfxBidValidYn */
		UPDATE RFX_BID
		   SET RFX_BID_EFCT_YN = #{p.rfx_bid_efct_yn}
		     , STS             = 'U'
		     , MODR_ID         = #{g.username}
		     , MOD_DTTM        = #{g.now}
		 WHERE TEN_ID       = #{g.tenant}
		   AND RFX_BID_UUID = #{p.rfx_bid_uuid}
	</update>
	<update id="updateRfxBidByAbandon">
		/* sp-rfx-bid.updateRfxBidByAbandon */
		UPDATE RFX_BID
		   SET RFX_BID_STS_CCD = #{p.rfx_bid_sts_ccd}
		     , GUP_RSN         = #{p.gup_rsn}
		     , STS             = 'U'
		     , MODR_ID         = #{g.username}
		     , MOD_DTTM        = #{g.now}
		 WHERE TEN_ID       = #{g.tenant}
		   AND RFX_BID_UUID = #{p.rfx_bid_uuid}
	</update>
	<select id="findInfoCancelCause" resultType="map">
		/* sp-rfx-bid.findInfoCancelCause */
		SELECT TEN_ID
		     , RFX_BID_UUID
		     , RFX_BID_NO
		     , RFX_BID_REVNO
		     , RFX_NO
		     , RFX_RND
		     , SLCTN_CNCL_RSN
		  FROM RFX_BID
		 WHERE TEN_ID       = #{g.tenant}
		   AND RFX_BID_UUID = #{p.rfx_bid_uuid}
	</select>
	<select id="findListRfxCs" resultType="map">
		/* sp-rfx-bid.findListRfxCs */
		SELECT T.RFX_UUID
		     , T.RFX_NO
		     , T.RFX_RND
		     , T.OORG_CD
		     , T.RFX_TIT
		     , T.RFX_TYP_CCD
		     , T.RFX_PURP_CCD
		     , T.RFX_CRN_DT
		     , T.RFX_ST_DTTM
		     , T.RFX_CLSG_DTTM
		     , T.COMP_TYP_CCD
		     , T.ITEM_SLCTN_TYP_CCD
		     , T.PURC_TYP_CCD
		     , T.RFX_STS_CCD
		     , T.RFX_RES_STS_CCD
		     , T.CSTM_USE_YN  /* 컨소시엄 여부 */
		     , T.CSTM_TYP_CCD /* 컨소시엄 유형 */
		     , CASE WHEN RFX_CSTM_VD.VD_CD IS NULL OR RFX_CSTM_VD.VD_CD = '' THEN 'Y'
		            WHEN T.COMP_TYP_CCD = 'OBID' AND RFX_CSTM_VD.REP_VD_YN = 'N' AND RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN = 'N' THEN 'Y' /* 공개입찰, 구성원인데 아직 전송받지 않은 경우 */
		            ELSE 'N'
		        END AS NEW_YN
		     , CASE WHEN RFX_CSTM_VD.REP_VD_CD IS NULL OR RFX_CSTM_VD.REP_VD_CD = '' THEN #{g.vd_cd}
		            ELSE RFX_CSTM_VD.REP_VD_CD
		        END AS REP_VD_CD
		     , CASE WHEN RFX_CSTM_VD.REP_VD_YN IS NULL OR RFX_CSTM_VD.REP_VD_YN = '' THEN 'Y'
		            WHEN T.COMP_TYP_CCD = 'OBID' AND RFX_CSTM_VD.REP_VD_YN = 'N' AND RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN = 'N' THEN 'Y'  /* 공개입찰, 구성원인데 아직 전송받지 않은 경우 */
		            WHEN RFX_CSTM_VD.REP_VD_CD = #{g.vd_cd} THEN 'Y'
		            ELSE 'N'
		        END AS REP_VD_YN
		     , RFX_CSTM_VD.CSTM_PTCP_CONFM_YN
		     , CASE WHEN RFX_CSTM_VD.CSTM_PTCP_CONFM_YN IS NULL OR RFX_CSTM_VD.CSTM_PTCP_CONFM_YN = '' THEN 'N'
		            ELSE RFX_CSTM_VD.CSTM_PTCP_CONFM_YN
		        END AS CSTM_PTCP_CONFM_STS
		     , RFX_CSTM_VD.CSTM_PTCP_CONFM_DTTM
		     , CASE WHEN RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN IS NULL OR RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN = '' THEN 'N'
		            ELSE RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN
		        END AS CSTM_PTCP_REQ_SND_YN
		  FROM (
		        SELECT RFX.TEN_ID
		             , RFX.RFX_UUID
		             , RFX.RFX_NO
		             , RFX.RFX_RND
		             , RFX.OORG_CD
		             , RFX.RFX_TIT
		             , RFX.RFX_TYP_CCD
		             , RFX.RFX_PURP_CCD
		             , RFX.RFX_CRN_DT
		             , RFX.RFX_ST_DTTM
		             , RFX.RFX_CLSG_DTTM
		             , RFX.COMP_TYP_CCD
		             , RFX.ITEM_SLCTN_TYP_CCD
		             , RFX.PURC_TYP_CCD
		             , RFX.RFX_STS_CCD
		             , RFX.RFX_RES_STS_CCD
		             , RFX.CSTM_USE_YN                              /* 컨소시엄 여부 */
		             , RFX.CSTM_TYP_CCD                             /* 컨소시엄 유형 */
		             , RFX_VD.VD_CD
		          FROM RFX RFX
		          LEFT OUTER JOIN RFX_VD RFX_VD
		            ON RFX_VD.TEN_ID   = RFX.TEN_ID
		           AND RFX_VD.RFX_UUID = RFX.RFX_UUID
		           AND RFX_VD.VD_CD    = #{g.vd_cd}
		           AND RFX_VD.MULTRND_SUBJ_XCEPT_YN = 'N'
		         WHERE RFX.TEN_ID       = #{g.tenant}
		           AND RFX.CSTM_USE_YN  = 'Y'  /* 컨소시엄 여부 */
		           AND RFX.STS         != 'D'
		           AND RFX.RFX_TYP_CCD != 'RAUC'
		           <if test="p.oorg_cds != null and p.oorg_cds.size() != 0">
		               AND RFX.OORG_CD IN
		                   <foreach close=")" collection="p.oorg_cds" item="oorg_cd" open="(" separator=",">
		                       #{oorg_cd}
		                   </foreach>
		           </if>
		           <if test="p.rfx_purp_ccd != null">
		               AND RFX.RFX_PURP_CCD = #{p.rfx_purp_ccd}
		           </if>
		           <if test="p.rfx_typ_ccd != null">
		               AND RFX.RFX_TYP_CCD = #{p.rfx_typ_ccd}
		           </if>
		           <if test="p.purc_typ_ccd != null">
		               AND RFX.PURC_TYP_CCD = #{p.purc_typ_ccd}
		           </if>
		           <if test="p.comp_typ_ccds != null and p.comp_typ_ccds.size() &gt; 0">
		               AND RFX.COMP_TYP_CCD IN
		               <foreach close=")" collection="p.comp_typ_ccds" item="comp_typ_ccd" open="(" separator=",">
		                   #{comp_typ_ccd}
		               </foreach>
		           </if>
		           <if test="p.item_slctn_typ_ccd != null">
		               AND RFX.ITEM_SLCTN_TYP_CCD = #{p.item_slctn_typ_ccd}
		           </if>
		           <choose>
		               <when test="p.rfx_sts_ccds != null and p.rfx_sts_ccds.size() &gt; 0">
		                   AND RFX.RFX_STS_CCD IN
		                   <foreach close=")" collection="p.rfx_sts_ccds" item="rfx_sts_ccd" open="(" separator=",">
		                       #{rfx_sts_ccd}
		                   </foreach>
		               </when>
		               <otherwise>
		                   /* 견적현황 조회시 저장,진행품의,반려 외에는 다보임 */
		                   AND RFX.RFX_STS_CCD NOT IN ('CRNG','APVL_PRGSG','NEGO_PRGSG')
		               </otherwise>
		           </choose>
		           <if test="p.from_rfx_crn_dt != null">
		               AND RFX.RFX_CRN_DT &gt;= #{p.from_rfx_crn_dt}
		           </if>
		           <if test="p.to_rfx_crn_dt != null">
		               <bind name="toDatePattern" value="g.getPlusDays(p.to_rfx_crn_dt,1)"/>
		               AND RFX.RFX_CRN_DT <![CDATA[<]]> #{toDatePattern}
		           </if>
		           <if test="p.from_rfx_clsg_dttm != null">
		               AND RFX.RFX_CLSG_DTTM &gt;= #{p.from_rfx_clsg_dttm}
		           </if>
		           <if test="p.to_rfx_clsg_dttm != null">
		               <bind name="toCloseDatePattern" value="g.getPlusDays(p.to_rfx_clsg_dttm,1)"/>
		               AND RFX.RFX_CLSG_DTTM <![CDATA[<]]> #{toCloseDatePattern}
		           </if>
		           <choose>
		               <when test="p.rfx_nos != null and p.rfx_nos.size() != 0">
		                   AND UPPER(RFX.RFX_NO) IN
		                   <foreach close=")" collection="p.rfx_nos" item="rfx_no" open="(" separator=",">
		                       #{rfx_no}
		                   </foreach>
		               </when>
		               <otherwise>
		                 <if test="p.rfx_no != null and p.rfx_no != ''">
		                     <bind name="noPattern" value="'%' + p.rfx_no + '%'"/>
		                     AND UPPER(RFX.RFX_NO) LIKE UPPER(#{noPattern})
		                 </if>
		               </otherwise>
		           </choose>
		           <if test="p.rfx_tit != null and p.rfx_tit != ''">
		               <bind name="rfxTitPattern" value="'%' + p.rfx_tit + '%'"/>
		               AND UPPER(RFX.RFX_TIT) LIKE UPPER(#{rfxTitPattern})
		           </if>
		       ) T
		  LEFT OUTER JOIN RFX_CSTM_VD RFX_CSTM_VD  /* 전제조건: 대표든 구성원이든 무조건 VD_CD는 RFx당 1건을 초과할 수 없다 */
		    ON RFX_CSTM_VD.TEN_ID   = T.TEN_ID
		   AND RFX_CSTM_VD.RFX_UUID = T.RFX_UUID
		   AND RFX_CSTM_VD.VD_CD    = #{g.vd_cd}
		 WHERE (
		           (
		               T.COMP_TYP_CCD != 'OBID' /*공개가 아닌경우(지명,수의)*/
		           AND (
		                   T.VD_CD = #{g.vd_cd}  /*RQVD 존재업체*/
		                OR (
		                       RFX_CSTM_VD.VD_CD = #{g.vd_cd} AND RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN = 'Y'  /*구성원이고, 협정서가 발송되어야 조회가능*/
		                   )
		               )
		           )
		        OR (
		               T.COMP_TYP_CCD = 'OBID' /*공개*/
		           )
		       )
		 ORDER BY T.RFX_NO DESC, T.RFX_RND DESC
	</select>
	<select id="findRfxCs" resultType="map">
		/* sp-rfx-bid.findRfxCs */
		SELECT RFX.RFX_UUID
		     , RFX.RFX_NO
		     , RFX.RFX_RND
		     , CASE WHEN RFX_CSTM_VD.VD_CD IS NULL OR RFX_CSTM_VD.VD_CD = '' THEN 'Y'
		            ELSE 'N'
		        END AS NEW_YN
		     <choose>
		         <when test="p.rep_vd_cd != null and p.rep_vd_cd != ''">
		             , #{p.rep_vd_cd} AS REP_VD_CD
		             , CASE WHEN #{p.rep_vd_cd} = #{g.vd_cd} THEN 'Y'
		                    ELSE 'N'
		                END AS REP_VD_YN
		         </when>
		         <otherwise>
		             , #{g.vd_cd} AS REP_VD_CD
		             , 'Y' AS REP_VD_YN
		         </otherwise>
		     </choose>
		     , #{g.vd_cd} AS VD_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN VD.VD_NM_EN
		            ELSE VD.VD_NM
		        END AS VD_NM
		     , VD.BIZREGNO
		     , CASE WHEN RFX_CSTM_VD.CSTM_TYP_CCD IS NULL OR RFX_CSTM_VD.CSTM_TYP_CCD = '' THEN RFX.CSTM_TYP_CCD
		            ELSE RFX_CSTM_VD.CSTM_TYP_CCD
		        END AS CSTM_TYP_CCD
		     , CASE WHEN RFX_CSTM_VD.CSTM_PTCP_CONFM_YN IS NULL OR RFX_CSTM_VD.CSTM_PTCP_CONFM_YN = '' THEN 'N'
		            ELSE RFX_CSTM_VD.CSTM_PTCP_CONFM_YN
		        END AS CSTM_PTCP_CONFM_YN
		     , RFX_CSTM_VD.CSTM_PTCP_CONFM_DTTM
		     , CASE WHEN RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN IS NULL OR RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN = '' THEN 'N'
		            ELSE RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN
		        END AS CSTM_PTCP_REQ_SND_YN
		     , CASE WHEN RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN = 'Y' AND (
		                                                             SELECT COUNT(RFX_CSTM_VD.VD_CD) AS CNT_SBMT_N
		                                                               FROM RFX_CSTM_VD RFX_CSTM_VD
		                                                              WHERE RFX_CSTM_VD.TEN_ID   = #{g.tenant}
		                                                                AND RFX_CSTM_VD.RFX_UUID = #{p.rfx_uuid}
		                                                                <choose>
		                                                                    <when test="p.rep_vd_cd != null and p.rep_vd_cd != ''">
		                                                                        AND RFX_CSTM_VD.REP_VD_CD = #{p.rep_vd_cd}
		                                                                    </when>
		                                                                    <otherwise>
		                                                                        AND RFX_CSTM_VD.REP_VD_CD = #{g.vd_cd}
		                                                                    </otherwise>
		                                                                </choose>
		                                                                AND RFX_CSTM_VD.CSTM_PTCP_CONFM_YN   = 'N'
		                                                            ) = 0 THEN 'Y'
		            ELSE 'N'
		        END AS ALL_SBMT_YN
		  FROM RFX RFX
		  LEFT OUTER JOIN RFX_CSTM_VD RFX_CSTM_VD
		    ON RFX_CSTM_VD.TEN_ID   = RFX.TEN_ID
		   AND RFX_CSTM_VD.RFX_UUID = RFX.RFX_UUID
		   AND RFX_CSTM_VD.VD_CD    = #{g.vd_cd}
		   <choose>
		       <when test="p.rep_vd_cd != null and p.rep_vd_cd != ''">
		           AND RFX_CSTM_VD.REP_VD_CD = #{p.rep_vd_cd}
		       </when>
		       <otherwise>
		           AND RFX_CSTM_VD.REP_VD_CD = #{g.vd_cd}
		       </otherwise>
		   </choose>
		 INNER JOIN VD VD
		    ON VD.TEN_ID   = RFX.TEN_ID
		   AND VD.VD_CD    = #{g.vd_cd}
		 WHERE RFX.TEN_ID   = #{g.tenant}
		   AND RFX.RFX_UUID = #{p.rfx_uuid}
	</select>
	<select id="findListRfxCsVd" resultType="map">
		/* sp-rfx-bid.findListRfxCsVd */
		SELECT T.RFX_UUID
		     , T.RFX_NO
		     , T.RFX_RND
		     , T.VD_CD
		     , T.VD_NM
		     , T.BIZREGNO
		     , T.REP_VD_CD
		     , T.INVT_RO
		     , T.INVT_ALOT_CONT
		     , T.REP_VD_YN
		     , T.CSTM_PTCP_CONFM_YN
		     , T.CSTM_PTCP_CONFM_DTTM
		     , T.CSTM_PTCP_REQ_SND_YN
		     , T.SORT_ORD
		  FROM ( SELECT RFX_CSTM_VD.RFX_UUID
		              , RFX_CSTM_VD.RFX_NO
		              , RFX_CSTM_VD.RFX_RND
		              , RFX_CSTM_VD.VD_CD
		              , CASE WHEN 'en_US' = #{g.locale} THEN VD.VD_NM_EN
		                     ELSE VD.VD_NM
		                 END AS VD_NM
		              , VD.BIZREGNO
		              , RFX_CSTM_VD.REP_VD_CD
		              , RFX_CSTM_VD.INVT_RO
		              , RFX_CSTM_VD.INVT_ALOT_CONT
		              , RFX_CSTM_VD.REP_VD_YN
		              , RFX_CSTM_VD.CSTM_PTCP_CONFM_YN
		              , RFX_CSTM_VD.CSTM_PTCP_CONFM_DTTM
		              , RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN
		              , CASE WHEN RFX_CSTM_VD.REP_VD_YN = 'Y' THEN 1
		                     ELSE 2
		                 END AS SORT_ORD
		           FROM RFX_CSTM_VD RFX_CSTM_VD
		          INNER JOIN VD VD
		             ON VD.TEN_ID = RFX_CSTM_VD.TEN_ID
		            AND VD.VD_CD  = RFX_CSTM_VD.VD_CD
		          WHERE RFX_CSTM_VD.TEN_ID   = #{g.tenant}
		            AND RFX_CSTM_VD.RFX_UUID = #{p.rfx_uuid}
		            <choose>
		                <when test="p.rep_vd_cd != null and p.rep_vd_cd != ''">
		                    AND RFX_CSTM_VD.REP_VD_CD = #{p.rep_vd_cd}
		                </when>
		                <otherwise>
		                    AND RFX_CSTM_VD.REP_VD_CD = #{g.vd_cd}
		                </otherwise>
		            </choose>
		       ) T
		 ORDER BY T.SORT_ORD, T.VD_CD
	</select>
	<select id="findListRfxCsVdTarget" resultType="map">
		/* sp-rfx-bid.findListRfxCsVdTarget */
		SELECT VD.VD_CD
		     , VD.ERP_VD_CD
		     , CASE WHEN VD.ERP_VD_CD IS NULL OR VD.ERP_VD_CD = '' THEN VD.VD_CD
		            ELSE VD.ERP_VD_CD
		        END AS DISP_VD_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN VD.VD_NM_EN
		            ELSE VD.VD_NM
		        END AS VD_NM
		     , VD.BIZREGNO
		  FROM VD VD
		 WHERE VD.TEN_ID = #{g.tenant}
		   AND EXISTS (
		               SELECT 1
		                 FROM VD_OORG VD_OORG
		                INNER JOIN OORG_MAPG OORG_MAPG
		                   ON OORG_MAPG.TEN_ID           = VD_OORG.TEN_ID
		                  AND OORG_MAPG.CONNSRC_OORG_CD  = #{p.oorg_cd}  /* 운영조직 */
		                  AND OORG_MAPG.CONNSUBJ_OORG_CD = VD_OORG.OORG_CD /* 협력사운영조직 */
		                  AND OORG_MAPG.CONN_TYP_CCD     = 'POEO'
		                  AND OORG_MAPG.CONN_YN          = 'Y'
		                WHERE VD_OORG.TEN_ID = VD.TEN_ID
		                  AND VD_OORG.VD_CD  = VD.VD_CD
		                  AND VD_OORG.STS   != 'D'
		              )
		   AND NOT EXISTS (
		                   SELECT 1
		                     FROM RFX_VD RFX_VD
		                    WHERE RFX_VD.TEN_ID   = #{g.tenant}
		                      AND RFX_VD.RFX_UUID = #{p.rfx_uuid}
		                      AND RFX_VD.VD_CD    = VD.VD_CD
		                      AND RFX_VD.STS     != 'D'
		                  )
		   <if test="p.vd_nm != null and p.vd_nm != &quot;&quot;">
		       <bind name="vdNmPattern" value="&quot;%&quot; + p.vd_nm + &quot;%&quot;"/>
		       AND (
		            UPPER(VD.VD_NM) LIKE UPPER(#{vdNmPattern}) OR 
		            UPPER(VD.VD_NM_EN) LIKE UPPER(#{vdNmPattern})
		           )      /* 협력사 명 검색조건*/
		   </if>
		   <if test="p.bizregno != null and p.bizregno != ''">
		       <bind name="bizRegNoPattern" value="&quot;%&quot; + p.bizregno + &quot;%&quot;"/>
		       AND VD.BIZREGNO LIKE UPPER(#{bizRegNoPattern})
		   </if>
		 ORDER BY VD.VD_CD, VD.BIZREGNO
	</select>
	<select id="checkRfxBids" resultType="map">
		/* sp-rfx-bid.checkRfxBids */
		SELECT RFX_BID.RFX_BID_UUID
		     , RFX_BID.RFX_BID_NO
		     , RFX_BID.VD_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN VD.VD_NM_EN
		            ELSE VD.VD_NM
		        END AS VD_NM
		     , CASE WHEN VD.ERP_VD_CD IS NULL OR VD.ERP_VD_CD = '' THEN VD.VD_CD
		            ELSE VD.ERP_VD_CD
		        END AS DISP_VD_CD
		     , RFX_BID.RFX_BID_STS_CCD
		  FROM RFX RFX
		 INNER JOIN RFX_BID RFX_BID
		    ON RFX_BID.TEN_ID   = RFX.TEN_ID
		   AND RFX_BID.RFX_NO   = RFX.RFX_NO
		   AND RFX_BID.RFX_RND  = RFX.RFX_RND
		   AND RFX_BID.RFX_BID_EFCT_YN = 'Y'
		 INNER JOIN VD VD
		    ON VD.TEN_ID   = RFX_BID.TEN_ID
		   AND VD.VD_CD    = RFX_BID.VD_CD
		 WHERE RFX.TEN_ID   = #{g.tenant}
		   AND RFX.RFX_UUID = #{p.rfx_uuid}
		   <choose>
		       <when test="p.vd_cd != null and p.vd_cd != ''">
		           AND RFX_BID.VD_CD = #{p.vd_cd}
		       </when>
		       <otherwise>
		           AND RFX_BID.VD_CD = #{g.vd_cd}
		       </otherwise>
		   </choose>
	</select>
	<select id="checkRfxCsVds" resultType="map">
		/* sp-rfx-bid.checkRfxCsVds */
		SELECT RFX_CSTM_VD.REP_VD_CD
		     , RFX_CSTM_VD.VD_CD
		     , RFX_CSTM_VD.REP_VD_YN
		     , CASE WHEN 'en_US' = #{g.locale} THEN VD.VD_NM_EN
		            ELSE VD.VD_NM
		        END AS VD_NM
		     , CASE WHEN VD.ERP_VD_CD IS NULL OR VD.ERP_VD_CD = '' THEN VD.VD_CD
		            ELSE VD.ERP_VD_CD
		        END AS DISP_VD_CD
		     , RFX_CSTM_VD.CSTM_PTCP_CONFM_YN
		     , RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN
		     <if test="p.rep_vd_yn == null">
		         , CASE WHEN RFX_CSTM_VD.REP_VD_YN = 'Y' AND RFX_CSTM_VD.CSTM_PTCP_REQ_SND_YN = 'Y' AND (
		                                                                                                 SELECT COUNT(RFX_CSTM_VD.VD_CD) AS CNT_SBMT_N
		                                                                                                   FROM RFX_CSTM_VD RFX_CSTM_VD
		                                                                                                  WHERE RFX_CSTM_VD.TEN_ID    = #{g.tenant}
		                                                                                                    AND RFX_CSTM_VD.RFX_UUID  = #{p.rfx_uuid}
		                                                                                                    AND RFX_CSTM_VD.REP_VD_CD = #{g.vd_cd}
		                                                                                                    AND RFX_CSTM_VD.CSTM_PTCP_CONFM_YN   = 'N'
		                                                                                                ) = 0 THEN 'Y'
		                ELSE 'N'
		            END AS ALL_SBMT_YN
		     </if>
		  FROM RFX_CSTM_VD RFX_CSTM_VD    /* 전제조건: 대표든 구성원이든 무조건 VD_CD는 RFx당 1건을 초과할 수 없다 */
		 INNER JOIN VD VD
		    ON VD.TEN_ID   = RFX_CSTM_VD.TEN_ID
		   AND VD.VD_CD    = RFX_CSTM_VD.VD_CD
		 WHERE RFX_CSTM_VD.TEN_ID   = #{g.tenant}
		   AND RFX_CSTM_VD.RFX_UUID = #{p.rfx_uuid}
		   <choose>
		       <when test="p.vd_cd != null and p.vd_cd != ''">
		           AND RFX_CSTM_VD.VD_CD = #{p.vd_cd}
		       </when>
		       <otherwise>
		           AND RFX_CSTM_VD.VD_CD = #{g.vd_cd}
		       </otherwise>
		   </choose>
		   <if test="p.rep_vd_yn != null and p.rep_vd_yn.equals(&quot;N&quot;)">
		       AND RFX_CSTM_VD.REP_VD_CD != #{g.vd_cd}
		   </if>
	</select>
	<insert id="insertRfxCs">
		/* sp-rfx-bid.insertRfxCs */
		INSERT INTO RFX_CSTM_VD (
			TEN_ID
			, RFX_UUID
			, VD_CD
			, REP_VD_CD
			, RFX_NO
			, RFX_RND
			, CSTM_TYP_CCD
			, INVT_RO
			, INVT_ALOT_CONT
			, REP_VD_YN
			, CSTM_PTCP_CONFM_YN
			, CSTM_PTCP_REQ_SND_YN
			, STS
			, REGR_ID
			, REG_DTTM
			, MODR_ID
			, MOD_DTTM
		) VALUES (
			#{g.tenant}
			, #{p.rfx_uuid}
			, #{p.vd_cd}
			, #{p.rep_vd_cd}
			, #{p.rfx_no}
			, #{p.rfx_rnd}
			, #{p.cstm_typ_ccd}
			<choose>
			    <when test="p.cstm_typ_ccd == 'RBC'">
			        , #{p.invt_ro}
			        , NULL
			    </when>
			    <when test="p.cstm_typ_ccd == 'TBC'">
			        , NULL
			        , #{p.invt_alot_cont}
			    </when>
			    <otherwise>
			        , #{p.invt_ro}
			        , #{p.invt_alot_cont}
			    </otherwise>
			</choose>
			, #{p.rep_vd_yn}
			, 'N'
			, 'N'
			, 'C'
			, #{g.username}
			, #{g.now}
			, #{g.username}
			, #{g.now}
		)
	</insert>
	<update id="updateRfxCs">
		/* sp-rfx-bid.updateRfxCs */
		UPDATE RFX_CSTM_VD
		   SET CSTM_TYP_CCD = #{p.cstm_typ_ccd}
		     <choose>
		         <when test="p.cstm_typ_ccd == 'RBC'">
		             , INVT_RO        = #{p.invt_ro}
		             , INVT_ALOT_CONT = NULL
		         </when>
		         <when test="p.cstm_typ_ccd == 'TBC'">
		             , INVT_RO        = NULL
		             , INVT_ALOT_CONT = #{p.invt_alot_cont}
		         </when>
		         <otherwise>
		             , INVT_RO        = #{p.invt_ro}
		             , INVT_ALOT_CONT = #{p.invt_alot_cont}
		         </otherwise>
		     </choose>
		     , STS       = 'U'
		     , MODR_ID   = #{g.username}
		     , MOD_DTTM  = #{g.now}
		 WHERE TEN_ID    = #{g.tenant}
		   AND RFX_UUID  = #{p.rfx_uuid}
		   AND VD_CD     = #{p.vd_cd}
		   AND REP_VD_CD = #{g.vd_cd}
	</update>
	<delete id="deleteRfxCs">
		/* sp-rfx-bid.deleteRfxCs */
		DELETE
		  FROM RFX_CSTM_VD
		 WHERE TEN_ID    = #{g.tenant}
		   AND RFX_UUID  = #{p.rfx_uuid}
		   AND VD_CD     = #{p.vd_cd}
		   AND REP_VD_CD = #{g.vd_cd}
	</delete>
	<update id="updateRfxCsSbmtY">
		/* sp-rfx-bid.updateRfxCsSbmtY */
		UPDATE RFX_CSTM_VD
		   SET CSTM_PTCP_CONFM_YN   = 'Y'
		     , CSTM_PTCP_CONFM_DTTM = #{g.now}
		 WHERE TEN_ID    = #{g.tenant}
		   AND RFX_UUID  = #{p.rfx_uuid}
		   AND VD_CD     = #{g.vd_cd}
		   AND REP_VD_CD = #{p.rep_vd_cd}
	</update>
	<update id="updateRfxCsSendY">
		/* sp-rfx-bid.updateRfxCsSendY */
		UPDATE RFX_CSTM_VD
		   SET CSTM_PTCP_REQ_SND_YN = 'Y'
		 WHERE TEN_ID    = #{g.tenant}
		   AND RFX_UUID  = #{p.rfx_uuid}
		   AND REP_VD_CD = #{g.vd_cd}
	</update>
	<delete id="deleteRfxCsByCancel">
		/* sp-rfx-bid.deleteRfxCsByCancel */
		DELETE
		  FROM RFX_CSTM_VD
		 WHERE TEN_ID    = #{g.tenant}
		   AND RFX_UUID  = #{p.rfx_uuid}
		   AND REP_VD_CD = #{g.vd_cd}
	</delete>
	<select id="findRfxByRfxVdUuid" resultType="map">
		SELECT RFX_UUID
		  FROM RFX_VD
		 WHERE RFX_VD.TEN_ID = #{g.tenant}
		   AND RFX_VD.RFX_VD_UUID = #{p.rfx_vd_uuid}
	</select>
</mapper>
