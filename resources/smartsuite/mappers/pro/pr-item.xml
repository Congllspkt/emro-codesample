<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pr-item">
	<delete id="deletePrItem">
		/* pr-item.deletePrItem */
		DELETE
		  FROM PR_ITEM
		 WHERE TEN_ID     = #{g.tenant}
		   AND PR_ITEM_UUID = #{p.pr_item_uuid}
	</delete>
	<insert id="insertPrItem">
		/* pr-item.insertPrItem */
		INSERT INTO PR_ITEM (
			TEN_ID
			, PR_ITEM_UUID
			, PR_UUID
			, PR_NO
			, PR_REVNO
			, PR_LNO
			, OORG_CD
			, PURC_TYP_CCD
			, PLT_CD
			, ITEM_OORG_CD
			, ITEM_CD_CRN_TYP_CCD
			, ITEM_CD
			, ITEM_NM
			, ITEM_NM_EN
			, ITEM_SPEC
			, ITEM_SPEC_DTL
			, UOM_CCD
			, PR_QTY
			, CUR_CCD
			, PR_UPRC
			, PR_AMT
			, WH_CCD
			, DLVY_PLC
			, PURC_GRP_CD
			, GR_PIC_ID
			, PR_REALUSR_ID
			, PR_REALUSR_REQ_CONT
			, UPRCCNTR_NO
			, PRE_UPRCCNTR_ITEM_UUID
			, UPRCCNTR_ITEM_UUID
			, UPRCCNTR_REVNO
			, UPRCCNTR_LNO
			, CNTR_UUID
			, CNTR_NO
			, CNTR_REVNO
			, PURC_CNTR_UUID
			, PURC_CNTR_INFO_UUID
			, PURC_CNTR_ITEM_UUID
			, PURC_CNTR_ITEM_LNO
			, SG_CD
            <choose>
                <when test="'CONSTSVC'.equals(p.purc_typ_ccd)">
			, CONST_ST_DT
			, CONST_EXP_DT
                </when>
                <otherwise>
			, REQ_DLVY_DT
                </otherwise>
            </choose>
			, ATHG_UUID
			, PR_RET_RSN
			, URGPURC_YN
			, PR_STS_CCD
			, PR_CHG_YN
			, STS
			, REGR_ID
			, REG_DTTM
			, MODR_ID
			, MOD_DTTM
			, PR_PURP_CCD
			, RCMD_VD_CD
			, RCMD_VD_NM
			, RCMD_VD_RSN
		) VALUES (
			#{g.tenant}
			, #{p.pr_item_uuid}
			, #{p.pr_uuid}
			, #{p.pr_no}
			, CAST(#{p.pr_revno} AS INT)
			, TO_CHAR(#{p.pr_lno})  , #{p.oorg_cd}
			, #{p.purc_typ_ccd}
			, #{p.plt_cd}
			, #{p.item_oorg_cd}
			, #{p.item_cd_crn_typ_ccd}
			, #{p.item_cd}
			, #{p.item_nm}
			, #{p.item_nm_en}
			, #{p.item_spec}
			, #{p.item_spec_dtl}
			, #{p.uom_ccd}
			, CAST(#{p.pr_qty} AS FLOAT  )
			, #{p.cur_ccd}
			, CAST(#{p.pr_uprc} AS FLOAT  )
			, CAST(#{p.pr_amt} AS FLOAT  )
			, #{p.wh_ccd}
			, #{p.dlvy_plc}
			, #{p.purc_grp_cd}
			, #{p.gr_pic_id}
			, #{p.pr_realusr_id}
			, #{p.pr_realusr_req_cont}
			, #{p.uprccntr_no}
			, #{p.pre_uprccntr_item_uuid}
			, #{p.uprccntr_item_uuid}
			, CAST(#{p.uprccntr_revno} AS INT)
			, TO_CHAR(#{p.uprccntr_lno})  , #{p.cntr_uuid}
			, #{p.cntr_no}
			, CAST(#{p.cntr_revno} AS INT)
			, #{p.purc_cntr_uuid}
			, #{p.purc_cntr_info_uuid}
			, #{p.purc_cntr_item_uuid}
			, TO_CHAR(#{p.purc_cntr_item_lno})  , #{p.sg_cd}
            <choose>
                <when test="'CONSTSVC'.equals(p.purc_typ_ccd)">
			, #{p.const_st_dt}
			, #{p.const_exp_dt}
                </when>
                <otherwise>
			, #{p.req_dlvy_dt}
                </otherwise>
            </choose>
			, #{p.athg_uuid}
			, #{p.pr_ret_rsn}
			, #{p.urgpurc_yn}
			, #{p.pr_sts_ccd}
			, #{p.pr_chg_yn}
			, 'C'
			, #{g.username}
			, #{g.now}
			, #{g.username}
			, #{g.now}
			, #{p.pr_purp_ccd}
			, #{p.rcmd_vd_cd}
			, #{p.rcmd_vd_nm}
			, #{p.rcmd_vd_rsn}
		)
	</insert>
	<update id="updatePrItem">
		/* pr-item.updatePrItem */
		UPDATE PR_ITEM
		   SET PLT_CD          = #{p.plt_cd}
		     , ITEM_OORG_CD  = #{p.item_oorg_cd}
		     , ITEM_SPEC            = #{p.item_spec}
		     , ITEM_SPEC_DTL        = #{p.item_spec_dtl}
		     , UOM_CCD         = #{p.uom_ccd}
		     , PR_QTY        = CAST(#{p.pr_qty} AS FLOAT  )
		     , CUR_CCD             = #{p.cur_ccd}
		     <choose>
		         <when test="p.pr_uprc != null">
		             , PR_UPRC = CAST(#{p.pr_uprc} AS FLOAT  )
		         </when>
		         <otherwise>
		             , PR_UPRC = NULL
		         </otherwise>
		     </choose>
		     <choose>
		         <when test="p.pr_amt != null">
		             , PR_AMT = CAST(#{p.pr_amt} AS FLOAT  )
		         </when>
		         <otherwise>
		             , PR_AMT = NULL
		         </otherwise>
		     </choose>
		     , WH_CCD           = #{p.wh_ccd}
		     , PURC_GRP_CD     = #{p.purc_grp_cd}
		     , PR_REALUSR_ID       = #{p.pr_realusr_id}
		     , PR_REALUSR_REQ_CONT     = #{p.pr_realusr_req_cont}
		     , DLVY_PLC        = #{p.dlvy_plc}
		     , REQ_DLVY_DT         = #{p.req_dlvy_dt}
		     , GR_PIC_ID       = #{p.gr_pic_id}
		     <choose>
		         <when test="p.uprccntr_item_uuid != null and p.uprccntr_item_uuid != ''">
		             , UPRCCNTR_ITEM_UUID    = #{p.uprccntr_item_uuid}
		             , UPRCCNTR_NO         = #{p.uprccntr_no}
		             , UPRCCNTR_REVNO        = CAST(#{p.uprccntr_revno} AS INT)
		             , UPRCCNTR_LNO   = TO_CHAR(#{p.uprccntr_lno}) </when>
		         <otherwise>
		             , UPRCCNTR_ITEM_UUID    = NULL
		             , UPRCCNTR_NO         = NULL
		             , UPRCCNTR_REVNO        = NULL
		             , UPRCCNTR_LNO   = NULL
		         </otherwise>
		     </choose>
		     , SG_CD           = #{p.sg_cd}
		     , CONST_ST_DT          = #{p.const_st_dt}
		     , CONST_EXP_DT          = #{p.const_exp_dt}
		     , ATHG_UUID          = #{p.athg_uuid}
		     , PR_RET_RSN    = #{p.pr_ret_rsn}
		     , URGPURC_YN          = #{p.urgpurc_yn}
		     , PR_CHG_YN = #{p.pr_chg_yn}
		  	 , PR_STS_CCD     = #{p.pr_sts_ccd}
		     , PR_PURP_CCD    = #{p.pr_purp_ccd}
			 , RCMD_VD_CD = #{p.rcmd_vd_cd}
			 , RCMD_VD_NM = #{p.rcmd_vd_nm}
			 , RCMD_VD_RSN = #{p.rcmd_vd_rsn}
		     , STS             = 'U'
		     , MODR_ID          = #{g.username}
		     , MOD_DTTM          = #{g.now}
		 WHERE TEN_ID     = #{g.tenant}
		   AND PR_ITEM_UUID = #{p.pr_item_uuid}
	</update>
	<resultMap id="resultMap-findPrItemByPr" type="map">
		<result column="RCMD_VD_RSN" javaType="string" property="rcmd_vd_rsn" typeHandler="stringClob"/>
	</resultMap>
	<select id="findPrItemByPr" resultMap="resultMap-findPrItemByPr">
		/* pr-item.findPrItemByPr */
		SELECT PR_ITEM.TEN_ID
		     , PR_ITEM.PR_ITEM_UUID
		     , PR_ITEM.PR_UUID
		     , PR_ITEM.PR_NO
		     , PR_ITEM.PR_REVNO
		     , PR_ITEM.PR_LNO
		     , PR_ITEM.OORG_CD
		     , PR_ITEM.PURC_TYP_CCD
		     , PR_ITEM.PR_PURP_CCD
		     , PR_ITEM.PLT_CD
		     , PR_ITEM.ITEM_OORG_CD
		     , PR_ITEM.ITEM_CD_CRN_TYP_CCD
		     , CASE WHEN PR_ITEM.ITEM_CD_CRN_TYP_CCD = 'CDLS'  -- 구매품목유형: 미등록(무코드품목)
		                 THEN NULL
		            ELSE PR_ITEM.ITEM_CD
		       END  AS DISP_ITEM_CD
		     , PR_ITEM.ITEM_CD
		     , CASE WHEN 'en_US' = #{g.locale}
                       THEN PR_ITEM.ITEM_NM_EN
                	   ELSE PR_ITEM.ITEM_NM
                	    END AS DISP_ITEM_NM
		     , PR_ITEM.ITEM_NM
		     , PR_ITEM.ITEM_NM_EN
		     , PR_ITEM.ITEM_SPEC
		     , PR_ITEM.ITEM_SPEC_DTL
		     , PR_ITEM.UOM_CCD
		     , PR_ITEM.PR_QTY
		     , PR_ITEM.PLT_CD
		     , PR_ITEM.ITEM_OORG_CD
		     , (SELECT
		            CASE WHEN 'en_US' = #{g.locale}
		                THEN LOGIC_ORG.LOGIC_ORG_NM_EN
		                ELSE LOGIC_ORG.LOGIC_ORG_NM
		                END AS LOGIC_ORG_NM
		        FROM LOGIC_ORG LOGIC_ORG
		        INNER JOIN OORG OORG
		        ON LOGIC_ORG.TEN_ID = OORG.TEN_ID
		        AND LOGIC_ORG.LOGIC_ORG_CD = OORG.LOGIC_ORG_CD
		        WHERE LOGIC_ORG.TEN_ID = PR_ITEM.TEN_ID
		          AND LOGIC_ORG.ORG_CD = PR_ITEM.PLT_CD
				 AND OORG.OORG_CD = PR_ITEM.ITEM_OORG_CD) AS PLT_NM
		     , PR_ITEM.CUR_CCD
		     , PR_ITEM.PR_UPRC
		     , PR_ITEM.PR_AMT
		     , PR_ITEM.WH_CCD
		     , PR_ITEM.DLVY_PLC
		     , PR_ITEM.PURC_GRP_CD
		     , PR_ITEM.GR_PIC_ID
		     , PR_ITEM.PR_REALUSR_ID
		     , PR_ITEM.PR_REALUSR_REQ_CONT
		     , PR_ITEM.UPRCCNTR_NO
		     , PR_ITEM.UPRCCNTR_ITEM_UUID
		     , PR_ITEM.UPRCCNTR_REVNO
		     , PR_ITEM.UPRCCNTR_LNO
		     , PR_ITEM.CNTR_UUID
		     , PR_ITEM.CNTR_NO
		     , PR_ITEM.CNTR_REVNO
		     , PR_ITEM.PURC_CNTR_UUID
		     , PR_ITEM.PURC_CNTR_INFO_UUID
		     , PR_ITEM.PURC_CNTR_ITEM_UUID
		     , PR_ITEM.PURC_CNTR_ITEM_LNO
		     , PR_ITEM.SG_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN SG.SG_NM_EN
		            ELSE SG.SG_NM
		        END AS SG_NM
		     , PR_ITEM.CONST_ST_DT
		     , PR_ITEM.CONST_EXP_DT
		     , PR_ITEM.REQ_DLVY_DT
		     , PR_ITEM.ATHG_UUID
		     , PR_ITEM.PR_RET_RSN
		     , PR_ITEM.URGPURC_YN
		     , PR_ITEM.PR_STS_CCD
		     , PR_ITEM.PR_CHG_YN
		     , PR_ITEM.STS
		     , PR_ITEM.REGR_ID
		     , PR_ITEM.REG_DTTM
		     , PR_ITEM.MODR_ID
		     , PR_ITEM.MOD_DTTM
		     , PR_ITEM.RCMD_VD_CD
		     , PR_ITEM.RCMD_VD_NM
		     , PR_ITEM.RCMD_VD_RSN
		     , CASE WHEN 'en_US' = #{g.locale}
                       THEN JOB.PURC_GRP_NM_EN
                	   ELSE JOB.PURC_GRP_NM
                	    END AS PURC_GRP_NM
		     , CASE WHEN 'en_US' = #{g.locale}
                       THEN PR_SUG_USR.USR_NM_EN
                	   ELSE PR_SUG_USR.USR_NM
                	    END AS PR_REALUSR_NM
		     , CASE WHEN 'en_US' = #{g.locale}
                       THEN GR_CHR_USR.USR_NM_EN
                	   ELSE GR_CHR_USR.USR_NM
                	    END AS GR_PIC_NM
		     <choose>
		         <when test="p.modify_yn != null and p.modify_yn eq 'Y'.toString()">
		             , 'Y'  AS HAS_PREV_YN
		         </when>
		         <otherwise>
		             , CASE WHEN PREV_PR_ITEM.PR_ITEM_UUID IS NOT NULL  THEN 'Y'
		                    ELSE 'N'
		                END AS HAS_PREV_YN
		         </otherwise>
		     </choose>
		     , CASE WHEN ITEM_OORG.TL_YN IS NOT NULL  THEN ITEM_OORG.TL_YN
		            ELSE 'N'
		        END AS TL_YN
		  FROM PR_ITEM PR_ITEM
		LEFT OUTER JOIN ITEM_OORG
			  ON ITEM_OORG.TEN_ID = PR_ITEM.TEN_ID
			  AND ITEM_OORG.ITEM_CD = PR_ITEM.ITEM_CD
			  AND ITEM_OORG.OORG_CD = PR_ITEM.ITEM_OORG_CD
			  AND ITEM_OORG.STS != 'D'
		  LEFT OUTER JOIN USR PR_SUG_USR        /* PR_SUG_USR : 구매요청 의뢰자 */
		    ON PR_ITEM.TEN_ID    = PR_SUG_USR.TEN_ID
		   AND PR_ITEM.PR_REALUSR_ID = PR_SUG_USR.USR_ID
		  LEFT OUTER JOIN USR GR_CHR_USR        /* GR_CHR_USR : 검수 담당자 */
		    ON PR_ITEM.TEN_ID    = GR_CHR_USR.TEN_ID
		   AND PR_ITEM.GR_PIC_ID = GR_CHR_USR.USR_ID
		  LEFT OUTER JOIN PURC_GRP JOB               /* JOB : 직무(그룹) */
		    ON JOB.TEN_ID       = PR_ITEM.TEN_ID
		   AND JOB.PURC_GRP_TYP_CCD = 'PURC'
		   AND JOB.PURC_GRP_CD  = PR_ITEM.PURC_GRP_CD
		   AND JOB.CO_CD      = #{g.co_cd}
		   AND JOB.USE_YN       = 'Y'
		  <if test="p.modify_yn == null or p.modify_yn eq 'N'.toString()">
		  LEFT OUTER JOIN PR_ITEM PREV_PR_ITEM
		    ON PREV_PR_ITEM.TEN_ID     = PR_ITEM.TEN_ID
		   AND PREV_PR_ITEM.PR_NO      = PR_ITEM.PR_NO
		   AND PREV_PR_ITEM.PR_REVNO     = PR_ITEM.PR_REVNO -1
		   AND PREV_PR_ITEM.PR_LNO     = PR_ITEM.PR_LNO
		   AND PREV_PR_ITEM.ITEM_CD    = PR_ITEM.ITEM_CD
		  </if>
		  LEFT OUTER JOIN SG SG
		    ON SG.TEN_ID = PR_ITEM.TEN_ID
		   AND SG.SG_CD = PR_ITEM.SG_CD
		 WHERE PR_ITEM.TEN_ID = #{g.tenant}
		   AND PR_ITEM.PR_UUID  = #{p.pr_uuid}
		   AND PR_ITEM.STS   != 'D'
	</select>
	<select id="findPrItemByUuid" resultType="map">
		SELECT PR_ITEM.PR_ITEM_UUID
		     , PR_ITEM.PR_UUID
		     , PR_ITEM.PR_NO
		     , PR_ITEM.PR_LNO
		     , PR_ITEM.PR_QTY
		     , PR_ITEM.PR_REALUSR_ID
		     , CASE WHEN #{g.locale} = 'en_US' THEN REAL_USR.USR_NM_EN
		            ELSE REAL_USR.USR_NM
		        END AS PR_REALUSR_NM
		     , PR_ITEM.PR_REALUSR_REQ_CONT
		     , PR_ITEM.GR_PIC_ID
		     , CASE WHEN #{g.locale} = 'en_US' THEN GR_USR.USR_NM_EN
		            ELSE GR_USR.USR_NM
		        END AS GR_PIC_NM
		  FROM PR_ITEM
		  LEFT OUTER JOIN USR GR_USR
		    ON GR_USR.TEN_ID = PR_ITEM.TEN_ID
		   AND GR_USR.USR_ID = PR_ITEM.GR_PIC_ID
		  LEFT OUTER JOIN USR REAL_USR
		    ON REAL_USR.TEN_ID = PR_ITEM.TEN_ID
		   AND REAL_USR.USR_ID = PR_ITEM.PR_REALUSR_ID
		 WHERE PR_ITEM.TEN_ID = #{g.tenant}
		   AND PR_ITEM.PR_ITEM_UUID = #{p.pr_item_uuid}
	</select>
	<sql id="subSqlRevTable">
		SELECT PHD.TEN_ID
		     , PHD.PR_UUID
		     , PHD.PR_NO
		     , PHD.PR_REVNO
		     , PHD.OORG_CD
		     , PHD.PR_TIT
		     , PHD.PURC_TYP_CCD
		     , PHD.PR_PURP_CCD
		     , PHD.PR_STS_CCD
		     , PHD.PR_CRTR_ID
		     , PHD.PR_REQ_DT
		     , PHD.PR_CRTR_DEPT_CD
		     , (
		        SELECT MAX(CAST(A.PR_REVNO AS INT))
		          FROM PR A
		         WHERE A.TEN_ID = PHD.TEN_ID
		           AND A.PR_NO  = PHD.PR_NO
		           AND A.STS   != 'D'
		       ) AS LAST_REV
		  FROM PR PHD
		 WHERE PHD.TEN_ID = #{g.tenant}
		   AND PHD.STS   != 'D'
	</sql>
	<sql id="subSqlRevUPCRTable">
		SELECT HD.TEN_ID
		     , HD.UPCR_UUID
		     , HD.UPCR_NO
		     , HD.UPCR_REVNO
		     , HD.OORG_CD
		     , HD.UPCR_TIT
		     , HD.PURC_TYP_CCD
		     , HD.UPCR_PURP_CCD
		     , HD.UPCR_STS_CCD
		     , HD.UPCR_CRTR_ID
		     , HD.UPCR_REQ_DT
		     , HD.UPCR_CRTR_DEPT_CD
		     , (
		        SELECT MAX(CAST(A.UPCR_REVNO AS INT))
		          FROM UPCR A
		         WHERE A.TEN_ID = HD.TEN_ID
		           AND A.UPCR_NO  = HD.UPCR_NO
		           AND A.STS   != 'D'
		       ) AS LAST_REV
		  FROM UPCR HD
		 WHERE HD.TEN_ID = #{g.tenant}
		   AND HD.STS   != 'D'
	</sql>
	<select id="findListPrItemProg" resultType="map">
		/* pr-item.findListPrItemProg : 구매요청 진행현황 조회 */
		SELECT PRHD.TEN_ID
		     , PRHD.PR_UUID
		     , PRHD.PR_REVNO
		     , PRDT.PR_ITEM_UUID
		     , PRDT.OORG_CD
		     , PRDT.PR_STS_CCD
		     , PRDT.PR_ITEM_STS_CCD
		     , PRHD.PURC_TYP_CCD
		     , CASE WHEN PRHD.PR_PURP_CCD = 'SPTPURC'
		                 AND PRDT.UPRCCNTR_NO IS NOT NULL  THEN 'UPRCCNTR_PURC'
		            ELSE PRHD.PR_PURP_CCD
		        END AS PR_PURP_CCD      /* 구매요청 목적 공통코드 */
		     , PRDT.PR_NO
		     , PRDT.PR_LNO
		     , PRHD.PR_TIT
		     , PRDT.ITEM_CD_CRN_TYP_CCD
		     , CASE WHEN PRDT.ITEM_CD_CRN_TYP_CCD = 'CDLS' THEN NULL -- 구매품목유형: 미등록(무코드품목)
		            ELSE PRDT.ITEM_CD
		        END AS DISP_ITEM_CD
		     , PRDT.ITEM_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN PRDT.ITEM_NM_EN
		            ELSE PRDT.ITEM_NM
		        END AS ITEM_NM
		     , PRDT.ITEM_NM_EN
		     , PRDT.ITEM_SPEC
		     , PRDT.ITEM_SPEC_DTL
		     , PRDT.UOM_CCD
		     , PRDT.CUR_CCD
		     , PRDT.PR_QTY
		     , PRDT.PR_UPRC
		     , PRDT.PR_AMT
		     , PRDT.REQ_DLVY_DT
		     , PRDT.CONST_ST_DT
		     , PRDT.CONST_EXP_DT
		     , PRDT.PLT_CD
		     , PRDT.ITEM_OORG_CD
		     , PRDT.PURC_GRP_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN JOB.PURC_GRP_NM_EN
		            ELSE JOB.PURC_GRP_NM
		        END AS PURC_GRP_NM         /* 요청자 명 */
		     , PRDT.DLVY_PLC
		     , PRHD.PR_CRTR_ID
		     , CASE WHEN 'en_US' = #{g.locale} THEN PR_REQ_USER.USR_NM_EN
		            ELSE PR_REQ_USER.USR_NM
		        END AS PR_CRTR_NM         /* 요청자 명 */
		     , PRHD.PR_CRTR_DEPT_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN PR_CRTR_DEPT_CD.DEPT_NM_EN
		            ELSE PR_CRTR_DEPT_CD.DEPT_NM
		        END AS PR_REQ_DEPT_NM
		     , CASE WHEN 'en_US' = #{g.locale} THEN PR_SUG_USER.USR_NM_EN
		            ELSE PR_SUG_USER.USR_NM
		        END AS PR_REALUSR_NM
		     , PRHD.PR_REQ_DT
		     , PRDT.PR_REALUSR_ID         /* 구매의뢰자 명 */
		     , PRDT.PR_REALUSR_REQ_CONT
		     , PRDT.PR_RET_RSN
		     , PODATA.PO_QTY  /* 발주수량 */
		     , PODATA.GR_QTY
		     , PODATA.PO_NO
		     , PODATA.VD_CD
		     , PODATA.ERP_VD_CD
		     , PODATA.VD_NM
		     , PODATA.UPRCCNTR_NO
		     , PODATA.PO_TYP_CCD
		     , RFXDATA.RFX_NO
		  FROM (
		        <include refid="subSqlRevTable"/>
		       ) PRHD
		 INNER JOIN PR_ITEM PRDT
		    ON PRDT.TEN_ID = PRHD.TEN_ID
		   AND PRDT.PR_UUID  = PRHD.PR_UUID
		   AND PRHD.PR_REVNO = PRHD.LAST_REV
		  LEFT OUTER JOIN (
		                   SELECT RFXHD.TEN_ID
		                        , RFXDT.PR_ITEM_UUID
		                        , RFXDT.RFX_NO
		                     FROM RFX RFXHD
		                    INNER JOIN RFX_ITEM RFXDT
		                       ON RFXDT.TEN_ID = RFXHD.TEN_ID
		                      AND RFXDT.RFX_UUID = RFXHD.RFX_UUID
		                      AND RFXDT.STS   != 'D'
		                    WHERE RFXHD.TEN_ID       = #{g.tenant}
		                      AND RFXHD.RFX_RES_STS_CCD NOT IN ('REQTA', 'CNCL') /* R: 재견적 */
		                      AND RFXHD.STS         != 'D'
		                  ) RFXDATA
		    ON PRDT.TEN_ID = RFXDATA.TEN_ID
		   AND PRDT.PR_ITEM_UUID = RFXDATA.PR_ITEM_UUID
		  LEFT OUTER JOIN (
		                   SELECT POHD.TEN_ID
		                        , PODT.PR_ITEM_UUID
		                        , PODT.PO_QTY
		                        , PODT.GR_QTY
		                        , PODT.PO_NO
		                        , POHD.VD_CD
		                        , CASE WHEN 'en_US' = #{g.locale} THEN VDGL.VD_NM_EN ELSE VDGL.VD_NM END AS VD_NM
		                        , VDGL.ERP_VD_CD
		                        , POHD.UPRCCNTR_NO
		                        , POHD.PO_TYP_CCD
		                     FROM PO POHD
		                    INNER JOIN PO_ITEM PODT
		                       ON PODT.TEN_ID = POHD.TEN_ID
		                      AND PODT.PO_UUID  = POHD.PO_UUID
		                      AND PODT.STS   != 'D'
		                   INNER JOIN VD VDGL
		                      ON VDGL.TEN_ID = POHD.TEN_ID
		                     AND VDGL.VD_CD  = POHD.VD_CD
		                     AND VDGL.STS   != 'D'
		                   WHERE POHD.TEN_ID      = #{g.tenant}
		                     AND POHD.PO_STS_CCD IN ('APVD', 'TRMN') /* C:발주승인완료, D:발주해지 */
		                     AND POHD.EFCT_PO_YN  = 'Y'
		                     AND POHD.STS        != 'D'
		                  ) PODATA
		    ON PODATA.TEN_ID     = PRDT.TEN_ID
		   AND PODATA.PR_ITEM_UUID = PRDT.PR_ITEM_UUID
		  LEFT OUTER JOIN USR PR_SUG_USER
		    ON PR_SUG_USER.TEN_ID  = PRDT.TEN_ID
		   AND PR_SUG_USER.USR_ID  = PRDT.PR_REALUSR_ID
		   AND PR_SUG_USER.STS    != 'D'
		 INNER JOIN USR PR_REQ_USER
		    ON PR_REQ_USER.TEN_ID  = PRHD.TEN_ID
		   AND PR_REQ_USER.USR_ID  = PRHD.PR_CRTR_ID
		   AND PR_REQ_USER.STS    != 'D'
		  LEFT OUTER JOIN LOGIC_ORG B         /* B : 조직 */
		    ON PR_REQ_USER.TEN_ID   = B.TEN_ID
		   AND PR_REQ_USER.CO_CD  = B.LOGIC_ORG_CD
		   AND B.LOGIC_ORG_TYP_CCD = 'COMPANY'
		   AND B.STS       != 'D'
		  LEFT OUTER JOIN LOGIC_ORG_DEPT_MAPG ODM
						  ON PR_REQ_USER.TEN_ID = ODM.TEN_ID
							  AND PR_REQ_USER.CO_CD = ODM.LOGIC_ORG_CD
							  AND PRHD.PR_CRTR_DEPT_CD = ODM.DEPT_CD
							  AND ODM.STS != 'D'
		  LEFT OUTER JOIN DEPT PR_CRTR_DEPT_CD
		    ON ODM.TEN_ID      = PR_CRTR_DEPT_CD.TEN_ID
		   AND ODM.DEPT_CD = PR_CRTR_DEPT_CD.DEPT_CD
		   AND PR_CRTR_DEPT_CD.STS        != 'D'
		  LEFT OUTER JOIN PURC_GRP JOB
		    ON JOB.TEN_ID       = PRDT.TEN_ID
		   AND JOB.PURC_GRP_TYP_CCD = 'PURC'
		   AND JOB.PURC_GRP_CD  = PRDT.PURC_GRP_CD
		   AND JOB.CO_CD      = #{g.co_cd}
		   AND JOB.USE_YN       = 'Y'
		 WHERE PRHD.TEN_ID  = #{g.tenant}
		   AND PRDT.STS    != 'D'
		   AND PRDT.PR_STS_CCD IS NOT NULL  AND PRDT.PR_STS_CCD NOT IN ('PR_CRNG', 'PR_APVL_RPTG', 'PR_APVL_RET', 'PR_CHG_CRNG')
		   AND PRDT.PR_ITEM_STS_CCD IS NOT NULL <if test="p.oorg_cds != null and p.oorg_cds.size() != 0">
		       AND PRHD.OORG_CD           IN
		       <foreach close=")" collection="p.oorg_cds" item="oorg_cd" open="(" separator=",">
		           #{oorg_cd}
		       </foreach>
		   </if>
		   <if test="p.from_pr_req_date != null">
		       AND PRHD.PR_REQ_DT <![CDATA[>=]]> #{p.from_pr_req_date}
		   </if>
		   <if test="p.to_pr_req_date != null">
		       <bind name="toDatePattern" value="g.getPlusDays(p.to_pr_req_date,1)"/>
		       AND PRHD.PR_REQ_DT <![CDATA[<]]> #{toDatePattern}
		   </if>
		   <if test="p.pr_purp_ccd != null and p.pr_purp_ccd != ''">
		       <choose>
		           <when test="p.pr_purp_ccd == 'SPTPURC'">
		               AND PRHD.PR_PURP_CCD = 'SPTPURC' AND (PRDT.UPRCCNTR_NO IS NULL OR PRDT.UPRCCNTR_NO = '')
		           </when>
		           <when test="p.pr_purp_ccd == 'UPRCCNTR_PURC'">
		               AND PRHD.PR_PURP_CCD = 'SPTPURC'
		               AND PRDT.UPRCCNTR_NO IS NOT NULL </when>
		           <otherwise>
		               AND PRHD.PR_PURP_CCD = #{p.pr_purp_ccd}
		           </otherwise>
		       </choose>
		   </if>
		   <if test="p.purc_typ_ccd != null and p.purc_typ_ccd != ''">
		       AND PRHD.PURC_TYP_CCD = #{p.purc_typ_ccd}
		   </if>
		   <choose>
		       <when test="p.pr_nos != null and p.pr_nos.size() != 0">
		           AND PRHD.PR_NO IN
		           <foreach close=")" collection="p.pr_nos" item="pr_no" open="(" separator=",">
		               #{pr_no}
		           </foreach>
		       </when>
		       <otherwise>
		           <if test="p.pr_no != null and p.pr_no != ''">
		               <bind name="prNoPattern" value="'%' + p.pr_no + '%'"/>
		               AND UPPER(PRHD.PR_NO) LIKE UPPER(#{prNoPattern})
		           </if>
		       </otherwise>
		   </choose>
		   <if test="p.pr_tit != null and p.pr_tit != ''">
		       <bind name="prTitPattern" value="'%' + p.pr_tit + '%'"/>
		       AND UPPER(PRHD.PR_TIT) LIKE UPPER(#{prTitPattern})
		   </if>
		   <choose>
		       <when test="p.pr_crtr_dept_cd != null and p.pr_crtr_dept_cd != ''">
		           AND PRHD.PR_CRTR_DEPT_CD = #{p.pr_crtr_dept_cd}
		       </when>
		       <otherwise>
		           <if test="p.pr_req_dept_nm != null and p.pr_req_dept_nm != ''">
		               <bind name="prReqDeptNmPattern" value="'%' + p.pr_req_dept_nm + '%'"/>
		               AND (UPPER(PR_CRTR_DEPT_CD.DEPT_NM) LIKE UPPER(#{prReqDeptNmPattern}) OR UPPER(PR_CRTR_DEPT_CD.DEPT_NM_EN) LIKE UPPER(#{prReqDeptNmPattern}))
		           </if>
		       </otherwise>
		   </choose>
		   <choose>
		       <when test="p.pr_crtr_id != null and p.pr_crtr_id != ''">
		           AND PRHD.PR_CRTR_ID = #{p.pr_crtr_id}
		       </when>
		       <otherwise>
		           <if test="p.pr_crtr_nm != null and p.pr_crtr_nm != ''">
		               <bind name="prReqUserNmPattern" value="'%' + p.pr_crtr_nm + '%'"/>
		               AND (UPPER(PR_REQ_USER.USR_NM) LIKE UPPER(#{prReqUserNmPattern}) OR UPPER(PR_REQ_USER.USR_NM_EN) LIKE UPPER(#{prReqUserNmPattern}))
		           </if>
		       </otherwise>
		   </choose>
		   <choose>
		       <when test="p.pr_realusr_id != null and p.pr_realusr_id != ''">
		           AND PRDT.PR_REALUSR_ID = #{p.pr_realusr_id}
		       </when>
		       <otherwise>
		           <if test="p.pr_realusr_nm != null and p.pr_realusr_nm != ''">
		               <bind name="prSugUserNmPattern" value="'%' + p.pr_realusr_nm + '%'"/>
		               AND (UPPER(PR_SUG_USER.USR_NM) LIKE UPPER(#{prSugUserNmPattern}) OR UPPER(PR_SUG_USER.USR_NM_EN) LIKE UPPER(#{prSugUserNmPattern}) )
		           </if>
		       </otherwise>
		   </choose>
		   <choose>
		       <when test="p.item_cds != null and p.item_cds.size() != 0">
		           AND PRDT.ITEM_CD IN
		           <foreach close=")" collection="p.item_cds" item="item_cd" open="(" separator=",">
		               #{item_cd}
		           </foreach>
		       </when>
		       <otherwise>
		           <if test="p.item_cd != null and p.item_cd != ''">
		               <bind name="itemCdPattern" value="'%' + p.item_cd + '%'"/>
		               AND UPPER(PRDT.ITEM_CD) LIKE UPPER(#{itemCdPattern})
		           </if>
		       </otherwise>
		   </choose>
		   <choose>
		       <when test="p.rfx_nos != null and p.rfx_nos.size() != 0">
		           AND RFXDATA.RFX_NO IN
		           <foreach close=")" collection="p.rfx_nos" item="rfx_no" open="(" separator=",">
		               #{rfx_no}
		           </foreach>
		       </when>
		       <otherwise>
		           <if test="p.rfx_no != null and p.rfx_no != ''">
		               <bind name="rfxNoPattern" value="'%' + p.rfx_no + '%'"/>
		               AND UPPER(RFXDATA.RFX_NO) LIKE UPPER(#{rfxNoPattern})
		           </if>
		       </otherwise>
		   </choose>
		   <if test="p.pr_item_sts_ccd != null and p.pr_item_sts_ccd != ''">
		       AND PRDT.PR_ITEM_STS_CCD       = #{p.pr_item_sts_ccd}
		   </if>
		 ORDER BY PRHD.PR_NO DESC, PRHD.PR_REVNO DESC, CAST(PRDT.PR_LNO AS INT) ASC
	</select>
	<select id="findListPrItem" resultType="map">
		/* pr-item.findListPrItem 구매  품목 목록 조회 */
		SELECT PRDT.TEN_ID
		     , PRDT.PR_ITEM_UUID
		     , PRDT.PR_UUID
		     , PRDT.PR_NO
		     , PRDT.PR_REVNO
		     , PRDT.PR_LNO
		     , PRDT.OORG_CD
		     , PRDT.PURC_TYP_CCD
		     , PRDT.PR_PURP_CCD
		     , PRDT.PLT_CD
		     , PRDT.ITEM_OORG_CD
		     , PRDT.ITEM_CD_CRN_TYP_CCD
		     , CASE WHEN PRDT.ITEM_CD_CRN_TYP_CCD = 'CDLS' THEN NULL -- 구매품목유형: 미등록(무코드품목)
		            ELSE PRDT.ITEM_CD
		        END AS DISP_ITEM_CD
		     , PRDT.ITEM_CD
		     , PRDT.ITEM_NM
		     , PRDT.ITEM_NM_EN
		     , PRDT.ITEM_SPEC
		     , PRDT.ITEM_SPEC_DTL
		     , PRDT.UOM_CCD
		     , PRDT.PR_QTY
		     , PRDT.CUR_CCD
		     , PRDT.PR_UPRC
		     , PRDT.PR_AMT
		     , PRDT.WH_CCD
		     , PRDT.DLVY_PLC
		     , PRDT.PURC_GRP_CD
		     , PRDT.GR_PIC_ID
		     , PRDT.PR_REALUSR_ID
		     , PRDT.PR_REALUSR_REQ_CONT
		     , PRDT.UPRCCNTR_NO
		     , PRDT.UPRCCNTR_ITEM_UUID
		     , PRDT.UPRCCNTR_REVNO
		     , PRDT.UPRCCNTR_LNO
		     , PRDT.CNTR_UUID
		     , PRDT.CNTR_NO
		     , PRDT.CNTR_REVNO
		     , PRDT.PURC_CNTR_UUID
		     , PRDT.PURC_CNTR_INFO_UUID
		     , PRDT.PURC_CNTR_ITEM_UUID
		     , PRDT.PURC_CNTR_ITEM_LNO
		     , PRDT.SG_CD
		     , PRDT.CONST_ST_DT
		     , PRDT.CONST_EXP_DT
		     , PRDT.REQ_DLVY_DT
		     , PRDT.ATHG_UUID
		     , PRDT.PR_RET_RSN
		     , PRDT.URGPURC_YN
		     , PRDT.PR_STS_CCD
		     , PRDT.PR_CHG_YN
		     , PRDT.STS
		     , PRDT.REGR_ID
		     , PRDT.REG_DTTM
		     , PRDT.MODR_ID
		     , PRDT.MOD_DTTM
		     , CASE WHEN 'en_US' = #{g.locale} THEN JOB.PURC_GRP_NM_EN ELSE JOB.PURC_GRP_NM END AS PURC_GRP_NM
		     , CASE WHEN 'en_US' = #{g.locale} THEN PR_SUG_USR.USR_NM_EN ELSE PR_SUG_USR.USR_NM END AS PR_REALUSR_NM
		     , CASE WHEN 'en_US' = #{g.locale} THEN GR_CHR_USR.USR_NM_EN ELSE GR_CHR_USR.USR_NM END AS GR_PIC_NM
		     <choose>
		         <when test="p.modify_yn != null and p.modify_yn eq 'Y'.toString()">
		             , 'Y'  AS HAS_PREV_YN
		         </when>
		         <otherwise>
		             , CASE WHEN PREV_PRDT.PR_ITEM_UUID IS NOT NULL  THEN 'Y'
		                    ELSE 'N'
		                END AS HAS_PREV_YN
		         </otherwise>
		     </choose>
		      , CASE WHEN ITEM_OORG.TL_YN IS NOT NULL  THEN ITEM_OORG.TL_YN
		             ELSE 'N'
		         END AS TL_YN
		  FROM PR_ITEM PRDT
		  LEFT OUTER JOIN ITEM_OORG
		      ON ITEM_OORG.TEN_ID = PRDT.TEN_ID
		      AND ITEM_OORG.ITEM_CD = PRDT.ITEM_CD
		      AND ITEM_OORG.OORG_CD = PRDT.ITEM_OORG_CD
		      AND ITEM_OORG.STS  != 'D'
		  LEFT OUTER JOIN USR PR_SUG_USR        /* PR_SUG_USR : 구매요청 의뢰자 */
		    ON PRDT.TEN_ID    = PR_SUG_USR.TEN_ID
		   AND PRDT.PR_REALUSR_ID = PR_SUG_USR.USR_ID
		  LEFT OUTER JOIN USR GR_CHR_USR        /* GR_CHR_USR : 검수 담당자 */
		    ON PRDT.TEN_ID    = GR_CHR_USR.TEN_ID
		   AND PRDT.GR_PIC_ID = GR_CHR_USR.USR_ID
		  LEFT OUTER JOIN PURC_GRP JOB               /* JOB : 직무(그룹) */
		    ON JOB.TEN_ID       = PRDT.TEN_ID
		   AND JOB.PURC_GRP_TYP_CCD = 'PURC'
		   AND JOB.PURC_GRP_CD  = PRDT.PURC_GRP_CD
		   AND JOB.CO_CD      = #{g.co_cd}
		   AND JOB.USE_YN       = 'Y'
		  <if test="p.modify_yn == null or p.modify_yn eq 'N'.toString()">
		      LEFT OUTER JOIN PR_ITEM PREV_PRDT
		        ON PREV_PRDT.TEN_ID     = PRDT.TEN_ID
		       AND PREV_PRDT.PR_NO      = PRDT.PR_NO
		       AND PREV_PRDT.PR_REVNO     = PRDT.PR_REVNO -1
		       AND PREV_PRDT.PR_LNO     = PRDT.PR_LNO
		       AND PREV_PRDT.ITEM_CD    = PRDT.ITEM_CD
		  </if>
		 WHERE PRDT.TEN_ID = #{g.tenant}
		   AND PRDT.PR_UUID  = #{p.pr_uuid}
		   AND PRDT.STS   != 'D'
		 ORDER BY CAST(PRDT.PR_LNO AS INT) ASC
	</select>
	<!--  계약별로 조회-->
	<resultMap id="cntrMap" type="java.util.HashMap">
		<id column="VD_CD" property="vd_cd"/>
		<id column="UPRCCNTR_NO" property="uprccntr_no"/>
		<id column="UPRCCNTR_REVNO" property="uprccntr_revno"/>
		<result column="OORG_CD" property="oorg_cd"/>
		<result column="PYMTMETH_CCD" property="pymtmeth_ccd"/>
		<result column="PYMTMETH_EXPLN" property="pymtmeth_expln"/>
		<result column="DLVYMETH_CCD" property="dlvymeth_ccd"/>
		<result column="DLVYMETH_EXPLN" property="dlvymeth_expln"/>
		<result column="DLVYMETH_USE_YN" property="dlvymeth_use_yn"/>
		<result column="PYMTMETH_CND" property="pymtmeth_cnd"/>
		<result column="QTA_YN" property="qta_yn"/>
		<result column="TOT_QTARATE" property="tot_qtarate"/>
		<result column="PURC_TYP_CCD" property="purc_typ_ccd"/>
		<result column="PR_TIT" property="pr_tit"/>
		<collection javaType="java.util.ArrayList" property="prItems" resultMap="prItemMap"/>
	</resultMap>
	<!-- 진행상태 상세 코드 조회 Result Map  -->
	<resultMap id="prItemMap" type="java.util.HashMap">
		<id column="PR_ITEM_UUID" property="pr_item_uuid"/>
		<result column="PR_UUID" property="pr_uuid"/>
		<result column="PR_NO" property="pr_no"/>
		<result column="PR_REVNO" property="pr_revno"/>
		<result column="PR_LNO" property="pr_lno"/>
		<result column="OORG_CD" property="oorg_cd"/>
		<result column="PURC_TYP_CCD" property="purc_typ_ccd"/>
		<result column="PLT_CD" property="plt_cd"/>
		<result column="ITEM_OORG_CD" property="item_oorg_cd"/>
		<result column="ITEM_CD_CRN_TYP_CCD" property="item_cd_crn_typ_ccd"/>
		<result column="DISP_ITEM_CD" property="disp_item_cd"/>
		<result column="ITEM_CD" property="item_cd"/>
		<result column="ITEM_NM" property="item_nm"/>
		<result column="ITEM_NM_EN" property="item_nm_en"/>
		<result column="ITEM_SPEC" property="item_spec"/>
		<result column="ITEM_SPEC_DTL" property="item_spec_dtl"/>
		<result column="UOM_CCD" property="uom_ccd"/>
		<result column="PR_QTY" property="pr_qty"/>
		<result column="CUR_CCD" property="cur_ccd"/>
		<result column="PR_UPRC" property="pr_uprc"/>
		<result column="PR_AMT" property="pr_amt"/>
		<result column="WH_CCD" property="wh_ccd"/>
		<result column="DLVY_PLC" property="dlvy_plc"/>
		<result column="PURC_GRP_CD" property="purc_grp_cd"/>
		<result column="GR_PIC_ID" property="gr_pic_id"/>
		<result column="PR_REALUSR_ID" property="pr_realusr_id"/>
		<result column="PR_REALUSR_REQ_CONT" property="pr_realusr_req_cont"/>
		<result column="UPRCCNTR_NO" property="uprccntr_no"/>
		<result column="UPRCCNTR_LNO" property="uprccntr_lno"/>
		<result column="UPRCCNTR_REVNO" property="uprccntr_revno"/>
		<result column="SG_CD" property="sg_cd"/>
		<result column="CONST_ST_DT" property="const_st_dt"/>
		<result column="CONST_EXP_DT" property="const_exp_dt"/>
		<result column="REQ_DLVY_DT" property="req_dlvy_dt"/>
		<result column="ATHG_UUID" property="athg_uuid"/>
		<result column="PR_RET_RSN" property="pr_ret_rsn"/>
		<result column="URGPURC_YN" property="urgpurc_yn"/>
		<result column="PR_STS_CCD" property="pr_sts_ccd"/>
		<result column="PR_CHG_YN" property="pr_chg_yn"/>
		<result column="MIGR_YN" property="migr_yn"/>
		<result column="STS" property="sts"/>
		<result column="REGR_ID" property="regr_id"/>
		<result column="REG_DTTM" property="reg_dttm"/>
		<result column="MODR_ID" property="modr_id"/>
		<result column="MOD_DTTM" property="mod_dttm"/>
		<result column="VD_RCPT_YN" property="vd_rcpt_yn"/>
		<result column="UPRC_CHG_POSS_YN" property="uprc_chg_poss_yn"/>
		<result column="UPRCCNTR_YN" property="uprccntr_yn"/>
		<result column="TAX_TYP_CCD" property="tax_typ_ccd"/>
		<result column="UPRCCNTR_AMT" property="uprccntr_amt"/>
		<result column="VAT_AMT" property="vat_amt"/>
		<result column="CPGUR_USE_YN" property="cpgur_use_yn"/>
		<result column="CPGUR_TYP_CCD" property="cpgur_typ_ccd"/>
		<result column="CPGUR_RO" property="cpgur_ro"/>
		<result column="CPGUR_AMT" property="cpgur_amt"/>
		<result column="CPGUR_ST_DT" property="cpgur_st_dt"/>
		<result column="CPGUR_EXP_DT" property="cpgur_exp_dt"/>
		<result column="DEFPGUR_USE_YN" property="defpgur_use_yn"/>
		<result column="DEFPGUR_TYP_CCD" property="defpgur_typ_ccd"/>
		<result column="DEFPGUR_RO" property="defpgur_ro"/>
		<result column="DEFPGUR_AMT" property="defpgur_amt"/>
		<result column="DEFPGUR_PD_TYP_CCD" property="defpgur_pd_typ_ccd"/>
		<result column="DEFPGUR_PD" property="defpgur_pd"/>
		<result column="PLT_CD" property="plt_cd"/>
		<result column="ITEM_OORG_CD" property="item_oorg_cd"/>
		<result column="DOMOVRS_DIV_CCD" property="domovrs_div_ccd"/>
		<result column="RFX_ITEM_UUID" property="rfx_item_uuid"/>
		<result column="RFX_NO" property="rfx_no"/>
		<result column="RFX_RND" property="rfx_no"/>
		<result column="RFX_ITEM_LNO" property="rfx_item_lno"/>
		<result column="RFX_BID_ITEM_UUID" property="rfx_bid_item_uuid"/>
		<result column="RFX_BID_NO" property="rfx_bid_no"/>
		<result column="RFX_BID_REVNO" property="rfx_bid_revno"/>
		<result column="RFX_BID_LNO" property="rfx_bid_lno"/>
		<result column="PR_ITEM_STS_CCD" property="pr_item_sts_ccd"/>
		<result column="VD_CD" property="vd_cd"/>
		<result column="ERP_VD_CD" property="erp_vd_cd"/>
		<result column="UPRCCNTR_UPRC" property="uprccntr_uprc"/>
		<result column="QTA_ITEM_UUID" property="qta_item_uuid"/>
		<result column="ITEM_CD" property="item_cd"/>
		<result column="QTARATE" property="qtarate"/>
		<result column="UPRCCNTR_ITEM_UUID" property="uprccntr_item_uuid"/>
		<result column="BAP_YN" property="bpa_yn"/>
		<result column="MULT_VD_YN" property="mult_vd_yn"/>
		<result column="DLVY_LDTM" property="dlvy_ldtm"/>
		<result column="SELECTED_UPRCCNTR_ITEM_UUID" property="selected_uprccntr_item_uuid"/>
	</resultMap>
	<update id="updatePrProgSts">
		/* updatePrProgSts : 구매 물품 상태 변경 */
		UPDATE PR_ITEM
		   SET PR_ITEM_STS_CCD = #{p.pr_item_sts_ccd}
		     , PR_STS_CCD     = #{p.pr_sts_ccd}
		     , STS             = 'U'
		     , MODR_ID          = #{g.username}
		     , MOD_DTTM          = #{g.now}
		 WHERE TEN_ID = #{g.tenant}
		   AND PR_UUID  = #{p.pr_uuid}
		   <if test="p.pr_item_uuid != null and p.pr_item_uuid != ''">
		       AND PR_ITEM_UUID = #{p.pr_item_uuid}
		   </if>
	</update>
	<update id="updatePrItemPurcGrp">
		/* pr-item.updatePrItemPurcGrp : 구매그룹 변경 */
		UPDATE PR_ITEM
		   SET PURC_GRP_CD = #{p.purc_grp_cd}
		     , STS         = 'U'
		     , MODR_ID      = #{g.username}
		     , MOD_DTTM      = #{g.now}
		 WHERE TEN_ID = #{g.tenant}
		   <choose>
		       <when test="p.pr_item_uuids != null and p.pr_item_uuids.size() &gt; 0">
		           AND PR_ITEM_UUID IN
		           <foreach close=")" collection="p.pr_item_uuids" item="pr_item_uuid" open="(" separator=",">
		               #{pr_item_uuid}
		           </foreach>
		       </when>
		       <otherwise>
		           AND PR_ITEM_UUID = #{p.pr_item_uuid}
		       </otherwise>
		   </choose>
	</update>
	<delete id="deletePrItemByPr">
		/* deletePrItemByPr : 구매 물품 여러건 삭제 */
		DELETE
		  FROM PR_ITEM
		 WHERE TEN_ID = #{g.tenant}
		   AND PR_UUID  = #{p.pr_uuid}
	</delete>
	<select id="findListPrItemHistory" resultType="map">
		/* pr-item.findListPrItemHistory */
		SELECT T.PR_LNO
		     , T.PR_REVNO
		     , T.ITEM_CD_CRN_TYP_CCD
		     , CASE WHEN T.ITEM_CD_CRN_TYP_CCD = 'CDLS' THEN NULL -- 구매품목유형: 미등록(무코드품목)
		            ELSE T.ITEM_CD
		        END AS DISP_ITEM_CD
		     , T.ITEM_CD
		     , T.DISP_ITEM_NM
		     , T.ITEM_NM
		     , T.ITEM_NM_EN
		     , T.ITEM_SPEC
		     , T.ITEM_SPEC_DTL
		     , T.UOM_CCD
		     , T.PR_QTY
		     , T.PR_UPRC
		     , T.PR_AMT
		     , T.REQ_DLVY_DT
		     , T.CONST_ST_DT
		     , T.CONST_EXP_DT
		     , T.DLVY_PLC
		     , T.PURC_GRP_CD
		     , T.PURC_GRP_NM
		     , T.PR_REALUSR_ID
		     , T.PR_REALUSR_NM
		     , T.GR_PIC_ID
		     , T.GR_PIC_NM
		     , T.ITEM_MOD_STATE
		     , T.PLT_CD
		     , T.PLT_NM
		  FROM (
		        SELECT PRDT.PR_LNO
		             , PRDT.PR_REVNO + 0      AS PR_REVNO
		             , PRDT.ITEM_CD_CRN_TYP_CCD
		             , PRDT.ITEM_CD
		             , CASE WHEN 'en_US' = #{g.locale} THEN PRDT.ITEM_NM_EN ELSE PRDT.ITEM_NM END AS DISP_ITEM_NM
		             , PRDT.ITEM_NM
		             , PRDT.ITEM_NM_EN
		             , PRDT.ITEM_SPEC
		             , PRDT.ITEM_SPEC_DTL
		             , PRDT.UOM_CCD
		             , PRDT.PR_QTY
		             , PRDT.PR_UPRC
		             , PRDT.PR_AMT
		             , PRDT.REQ_DLVY_DT
		             , PRDT.CONST_ST_DT
		             , PRDT.CONST_EXP_DT
		             , PRDT.DLVY_PLC
		             , PRDT.PURC_GRP_CD
		             , CASE WHEN 'en_US' = #{g.locale} THEN JOB.PURC_GRP_NM_EN ELSE JOB.PURC_GRP_NM END AS PURC_GRP_NM
		             , PRDT.PR_REALUSR_ID
		             , CASE WHEN 'en_US' = #{g.locale} THEN PR_SUG_USR.USR_NM_EN ELSE PR_SUG_USR.USR_NM END AS PR_REALUSR_NM
		             , PRDT.GR_PIC_ID
		             , CASE WHEN 'en_US' = #{g.locale} THEN GR_CHR_USR.USR_NM_EN ELSE GR_CHR_USR.USR_NM END AS GR_PIC_NM
		             , (
		                CASE WHEN PRDT.PR_REVNO = 1 THEN ''
		                     ELSE (
		                           CASE WHEN PREV_PRDT.PR_REVNO IS NULL OR PREV_PRDT.PR_REVNO = '' THEN 'NEW'
		                                WHEN PRDT.PR_QTY = PREV_PRDT.PR_QTY AND PRDT.PR_UPRC = PREV_PRDT.PR_UPRC AND PRDT.PR_AMT = PREV_PRDT.PR_AMT  /* 수량,단가,금액 */
		                                     AND ((PRDT.REQ_DLVY_DT IS NULL AND PREV_PRDT.REQ_DLVY_DT IS NULL) OR PRDT.REQ_DLVY_DT = PREV_PRDT.REQ_DLVY_DT)                    /* 납기일자 */
		                                     AND ((PRDT.CONST_ST_DT IS NULL AND PREV_PRDT.CONST_ST_DT IS NULL) OR PRDT.CONST_ST_DT = PREV_PRDT.CONST_ST_DT)                        /* 공사 시작 일자 */
		                                     AND ((PRDT.CONST_EXP_DT IS NULL AND PREV_PRDT.CONST_EXP_DT IS NULL) OR PRDT.CONST_EXP_DT = PREV_PRDT.CONST_EXP_DT)                        /* 공사 종료 일자 */
		                                     AND (((PRDT.PURC_GRP_CD IS NULL OR PRDT.PURC_GRP_CD = '') AND (PREV_PRDT.PURC_GRP_CD IS NULL OR PREV_PRDT.PURC_GRP_CD = '')) OR PRDT.PURC_GRP_CD = PREV_PRDT.PURC_GRP_CD)    /* 구매그룹 */
		                                     AND (((PRDT.DLVY_PLC IS NULL OR PRDT.DLVY_PLC = '') AND (PREV_PRDT.DLVY_PLC IS NULL OR PREV_PRDT.DLVY_PLC = '')) OR PRDT.DLVY_PLC = PREV_PRDT.DLVY_PLC)                /* 납품(수행)장소 */
		                                     AND (((PRDT.PR_REALUSR_ID IS NULL OR PRDT.PR_REALUSR_ID = '') AND (PREV_PRDT.PR_REALUSR_ID IS NULL OR PREV_PRDT.PR_REALUSR_ID = '')) OR PRDT.PR_REALUSR_ID = PREV_PRDT.PR_REALUSR_ID)            /* 구매의뢰자 */
		                                     AND (((PRDT.GR_PIC_ID IS NULL OR PRDT.GR_PIC_ID = '') AND (PREV_PRDT.GR_PIC_ID IS NULL OR PREV_PRDT.GR_PIC_ID = '')) OR PRDT.GR_PIC_ID = PREV_PRDT.GR_PIC_ID)            /* 검수담당자 */
		                                       THEN ''
		                                     ELSE 'UPDATE'
		                            END
		                          )
		                 END
		               ) AS ITEM_MOD_STATE
		             , PRDT.PLT_CD
		             , (
		                SELECT CASE WHEN 'en_US' = #{g.locale} THEN LOGIC_ORG.LOGIC_ORG_NM_EN
		                            ELSE LOGIC_ORG.LOGIC_ORG_NM
		                        END AS LOGIC_ORG_NM
		                  FROM LOGIC_ORG LOGIC_ORG
		                 INNER JOIN OORG OORG
		                    ON LOGIC_ORG.TEN_ID = OORG.TEN_ID
		                   AND LOGIC_ORG.LOGIC_ORG_CD = OORG.LOGIC_ORG_CD
		                 WHERE LOGIC_ORG.TEN_ID = PRDT.TEN_ID
		                   AND LOGIC_ORG.ORG_CD = PRDT.PLT_CD
		                   AND OORG.OORG_CD = PRDT.ITEM_OORG_CD
		               ) AS PLT_NM
		          FROM PR_ITEM PRDT
		          LEFT OUTER JOIN PURC_GRP JOB               /* JOB : 직무(그룹) */
		            ON JOB.TEN_ID       = PRDT.TEN_ID
		           AND JOB.PURC_GRP_TYP_CCD = 'PURC'
		           AND JOB.PURC_GRP_CD  = PRDT.PURC_GRP_CD
		           AND JOB.CO_CD      = #{g.co_cd}
		           AND JOB.USE_YN       = 'Y'
		          LEFT OUTER JOIN USR PR_SUG_USR        /* PR_SUG_USR : 구매요청 의뢰자 */
		            ON PRDT.TEN_ID    = PR_SUG_USR.TEN_ID
		           AND PRDT.PR_REALUSR_ID = PR_SUG_USR.USR_ID
		          LEFT OUTER JOIN USR GR_CHR_USR        /* GR_CHR_USR : 검수 담당자 */
		            ON PRDT.TEN_ID    = GR_CHR_USR.TEN_ID
		           AND PRDT.GR_PIC_ID = GR_CHR_USR.USR_ID
		          LEFT OUTER JOIN PR_ITEM PREV_PRDT
		            ON PREV_PRDT.TEN_ID = PRDT.TEN_ID
		           AND PREV_PRDT.PR_NO  = PRDT.PR_NO
		           AND PREV_PRDT.PR_LNO = PRDT.PR_LNO
		           AND PREV_PRDT.PR_REVNO = PRDT.PR_REVNO -1
		           AND PREV_PRDT.STS   != 'D'
		         WHERE PRDT.TEN_ID = #{g.tenant}
		           AND PRDT.PR_NO  = #{p.pr_no}
		           <if test="p.pr_revs != null">
		               AND PRDT.PR_REVNO IN
		               <foreach close=")" collection="p.pr_revs" item="pr_revno" open="(" separator=",">
		                   #{pr_revno}
		               </foreach>
		           </if>
		           AND PRDT.STS   != 'D'
		         UNION ALL
		        SELECT PREV_PRDT.PR_LNO         AS PR_LNO
		             , PREV_PRDT.PR_REVNO + 1     AS PR_REVNO
		             , PREV_PRDT.ITEM_CD_CRN_TYP_CCD  AS ITEM_CD_CRN_TYP_CCD
		             , PREV_PRDT.ITEM_CD        AS ITEM_CD
		             , CASE WHEN 'en_US' = #{g.locale} THEN PREV_PRDT.ITEM_NM_EN ELSE PREV_PRDT.ITEM_NM END AS DISP_ITEM_NM
		             , PREV_PRDT.ITEM_NM        AS ITEM_NM
		             , PREV_PRDT.ITEM_NM_EN   AS ITEM_NM_EN
		             , PREV_PRDT.ITEM_SPEC           AS ITEM_SPEC
		             , PREV_PRDT.ITEM_SPEC_DTL       AS ITEM_SPEC_DTL
		             , PREV_PRDT.UOM_CCD        AS UOM_CCD
		             , NULL                     AS PR_QTY
		             , NULL                     AS PR_UPRC
		             , NULL                     AS PR_AMT
		             , NULL                     AS REQ_DLVY_DT
		             , NULL                     AS CONST_ST_DT
		             , NULL                     AS CONST_EXP_DT
		             , NULL                     AS DLVY_PLC
		             , NULL                     AS PURC_GRP_CD
		             , NULL                     AS PURC_GRP_NM
		             , NULL                     AS PR_REALUSR_ID
		             , NULL                     AS PR_REALUSR_NM
		             , NULL                     AS GR_PIC_ID
		             , NULL                     AS GR_PIC_NM
		             , 'DELETE'                 AS ITEM_MOD_STATE
		             , PREV_PRDT.PLT_CD
		             , (
		                SELECT CASE WHEN 'en_US' = #{g.locale} THEN LOGIC_ORG.LOGIC_ORG_NM_EN
		                            ELSE LOGIC_ORG.LOGIC_ORG_NM
		                        END AS LOGIC_ORG_NM
		                  FROM LOGIC_ORG LOGIC_ORG
		                 INNER JOIN OORG OORG
		                    ON LOGIC_ORG.TEN_ID = OORG.TEN_ID
		                   AND LOGIC_ORG.LOGIC_ORG_CD = OORG.LOGIC_ORG_CD
		                 WHERE LOGIC_ORG.TEN_ID = PREV_PRDT.TEN_ID
		                   AND LOGIC_ORG.ORG_CD = PREV_PRDT.PLT_CD
		                   AND OORG.OORG_CD = PREV_PRDT.ITEM_OORG_CD
		               ) AS PLT_NM
		          FROM PR_ITEM PREV_PRDT
		          LEFT OUTER JOIN PR_ITEM DELETED_PRDT
		            ON DELETED_PRDT.TEN_ID = PREV_PRDT.TEN_ID
		           AND DELETED_PRDT.PR_NO  = PREV_PRDT.PR_NO
		           AND DELETED_PRDT.PR_LNO = PREV_PRDT.PR_LNO
		           AND DELETED_PRDT.PR_REVNO = PREV_PRDT.PR_REVNO +1
		         WHERE PREV_PRDT.TEN_ID        = #{g.tenant}
		           AND PREV_PRDT.PR_NO         = #{p.pr_no}
		           <if test="p.pr_revs != null">
		               AND PREV_PRDT.PR_REVNO IN
		               <foreach close=")" collection="p.pr_revs" item="pr_revno" open="(" separator=",">
		                   #{pr_revno} -1
		               </foreach>
		           </if>
		           AND PREV_PRDT.PR_REVNO != CAST(#{p.last_pr_rev} AS INT)
		           AND PREV_PRDT.STS    != 'D'
		           AND (DELETED_PRDT.PR_ITEM_UUID IS NULL OR DELETED_PRDT.PR_ITEM_UUID = '')
		       ) T
		 ORDER BY CAST(T.PR_LNO AS INT), T.PR_REVNO
	</select>
	<select id="findListComparePrItem" resultType="map">
		/* pr-item.findListComparePrItem */
		SELECT PR_ITEM_LINE.PR_NO
		     , PR_ITEM_LINE.PR_LNO
		     , PR_ITEM_LINE.ITEM_CD_CRN_TYP_CCD
		     , CASE WHEN PR_ITEM_LINE.ITEM_CD_CRN_TYP_CCD = 'CDLS' THEN NULL -- 구매품목유형: 미등록(무코드품목)
		            ELSE PR_ITEM_LINE.ITEM_CD
		        END AS DISP_ITEM_CD
		     , PR_ITEM_LINE.ITEM_CD
		     , CASE WHEN 'en_US' = #{g.locale} THEN PR_ITEM_LINE.DISP_ITEM_NM ELSE PR_ITEM_LINE.ITEM_NM END AS DISP_ITEM_NM
		     , PR_ITEM_LINE.ITEM_NM
		     , PR_ITEM_LINE.ITEM_SPEC
		     , PR_ITEM_LINE.ITEM_SPEC_DTL
		     , PR_ITEM_LINE.UOM_CCD
		     , PREV_PRDT.PR_ITEM_UUID          AS PREV_PR_ITEM_ID
		     , POST_PRDT.PR_ITEM_UUID          AS POST_PR_ITEM_ID
		     , PREV_PRDT.PR_REVNO              AS PREV_PR_REV
		     , POST_PRDT.PR_REVNO              AS POST_PR_REV
		     , PREV_PRDT.PR_QTY            AS PREV_ITEM_QTY
		     , POST_PRDT.PR_QTY            AS POST_ITEM_QTY
		     , PREV_PRDT.PR_UPRC            AS PREV_PR_PRICE
		     , POST_PRDT.PR_UPRC            AS POST_PR_PRICE
		     , PREV_PRDT.PR_AMT              AS PREV_PR_AMT
		     , POST_PRDT.PR_AMT              AS POST_PR_AMT
		     , PREV_PRDT.REQ_DLVY_DT             AS PREV_RD_DATE
		     , POST_PRDT.REQ_DLVY_DT             AS POST_RD_DATE
		     , PREV_PRDT.CONST_ST_DT              AS PREV_PRD_SD
		     , POST_PRDT.CONST_ST_DT              AS POST_PRD_SD
		     , PREV_PRDT.CONST_EXP_DT              AS PREV_PRD_ED
		     , POST_PRDT.CONST_EXP_DT              AS POST_PRD_ED
		     , PREV_PRDT.DLVY_PLC            AS PREV_RD_LOCAT
		     , POST_PRDT.DLVY_PLC            AS POST_RD_LOCAT
		     , PREV_PRDT.PURC_GRP_CD         AS PREV_PURC_GRP_CD
		     , POST_PRDT.PURC_GRP_CD         AS POST_PURC_GRP_CD
		     , PREV_PURC_GRP.PURC_GRP_NM     AS PREV_PURC_GRP_NM
		     , POST_PURC_GRP.PURC_GRP_NM     AS POST_PURC_GRP_NM
		     , PREV_PR_SUG.USR_NM            AS PREV_PR_REALUSR_NM
		     , POST_PR_SUG.USR_NM            AS POST_PR_REALUSR_NM
		     , PREV_GR_CHR.USR_NM            AS PREV_GR_PIC_NM
		     , POST_GR_CHR.USR_NM            AS POST_GR_PIC_NM
		  FROM (
		        SELECT DT.TEN_ID
		             , DT.PR_NO
		             , DT.PR_LNO
		             , DT.ITEM_CD_CRN_TYP_CCD
		             , DT.ITEM_CD
		             , CASE WHEN 'en_US' = #{g.locale} THEN DT.ITEM_NM_EN ELSE DT.ITEM_NM END AS DISP_ITEM_NM
		             , DT.ITEM_NM
		             , DT.ITEM_SPEC
		             , DT.ITEM_SPEC_DTL
		             , DT.UOM_CCD
		          FROM PR_ITEM DT
		         WHERE DT.TEN_ID  = #{g.tenant}
		           AND DT.PR_NO   = #{p.pr_no}
		           AND DT.PR_REVNO IN (CAST(#{p.prev_pr_rev} AS INT), CAST(#{p.post_pr_rev} AS INT))
		           AND DT.STS    != 'D'
		         GROUP BY DT.TEN_ID
		                , DT.PR_NO
		                , DT.PR_LNO
		                , DT.ITEM_CD_CRN_TYP_CCD
		                , DT.ITEM_CD
		                , DT.ITEM_NM
		                , DT.ITEM_SPEC
		                , DT.ITEM_SPEC_DTL
		                , DT.UOM_CCD
		                , DT.ITEM_NM_EN
		       ) PR_ITEM_LINE
		  LEFT OUTER JOIN PR_ITEM PREV_PRDT
		    ON PREV_PRDT.TEN_ID  = PR_ITEM_LINE.TEN_ID
		   AND PREV_PRDT.PR_NO   = PR_ITEM_LINE.PR_NO
		   AND PREV_PRDT.PR_LNO  = PR_ITEM_LINE.PR_LNO
		   AND PREV_PRDT.PR_REVNO  = CAST(#{p.prev_pr_rev} AS INT)
		   AND PREV_PRDT.STS    != 'D'
		  LEFT OUTER JOIN PURC_GRP PREV_PURC_GRP
		    ON PREV_PURC_GRP.TEN_ID       = PREV_PRDT.TEN_ID
		   AND PREV_PURC_GRP.PURC_GRP_TYP_CCD = 'PURC'
		   AND PREV_PURC_GRP.PURC_GRP_CD  = PREV_PRDT.PURC_GRP_CD
		   AND PREV_PURC_GRP.CO_CD      = #{g.co_cd}
		   AND PREV_PURC_GRP.USE_YN  = 'Y'
		  LEFT OUTER JOIN USR PREV_PR_SUG
		    ON PREV_PRDT.TEN_ID    = PREV_PR_SUG.TEN_ID
		   AND PREV_PRDT.PR_REALUSR_ID = PREV_PR_SUG.USR_ID
		  LEFT OUTER JOIN USR PREV_GR_CHR
		    ON PREV_PRDT.TEN_ID    = PREV_GR_CHR.TEN_ID
		   AND PREV_PRDT.GR_PIC_ID = PREV_GR_CHR.USR_ID
		  LEFT OUTER JOIN PR_ITEM POST_PRDT
		    ON POST_PRDT.TEN_ID  = PR_ITEM_LINE.TEN_ID
		   AND POST_PRDT.PR_NO   = PR_ITEM_LINE.PR_NO
		   AND POST_PRDT.PR_LNO  = PR_ITEM_LINE.PR_LNO
		   AND POST_PRDT.PR_REVNO  = CAST(#{p.post_pr_rev} AS INT)
		   AND POST_PRDT.STS    != 'D'
		  LEFT OUTER JOIN PURC_GRP POST_PURC_GRP
		    ON POST_PURC_GRP.TEN_ID       = POST_PRDT.TEN_ID
		   AND POST_PURC_GRP.PURC_GRP_TYP_CCD = 'PURC'
		   AND POST_PURC_GRP.PURC_GRP_CD  = POST_PRDT.PURC_GRP_CD
		   AND POST_PURC_GRP.CO_CD      = #{g.co_cd}
		   AND POST_PURC_GRP.USE_YN        = 'Y'
		  LEFT OUTER JOIN USR POST_PR_SUG
		    ON POST_PRDT.TEN_ID    = POST_PR_SUG.TEN_ID
		   AND POST_PRDT.PR_REALUSR_ID = POST_PR_SUG.USR_ID
		  LEFT OUTER JOIN USR POST_GR_CHR
		    ON POST_PRDT.TEN_ID    = POST_GR_CHR.TEN_ID
		   AND POST_PRDT.GR_PIC_ID = POST_GR_CHR.USR_ID
		 ORDER BY CAST(PR_ITEM_LINE.PR_LNO AS INT)
	</select>
	<select id="findPreviousPrItems" resultType="map">
		/* pr-item.xml : findPreviousPrItems 이전차수 구매요청  품목 목록 조회 : 결재서식생성시 사용 */
		SELECT PRDT.TEN_ID
		     , PRDT.PR_ITEM_UUID
		     , PRDT.PR_UUID
		     , PRDT.PR_NO
		     , PRDT.PR_REVNO
		     , PRDT.PR_LNO
		     , PRDT.OORG_CD
		     , PRDT.PURC_TYP_CCD
		     , PRDT.PR_PURP_CCD
		     , PRDT.PLT_CD
		     , PRDT.ITEM_OORG_CD
		     , PRDT.ITEM_CD_CRN_TYP_CCD
		     , CASE WHEN PRDT.ITEM_CD_CRN_TYP_CCD = 'CDLS' THEN NULL -- 구매품목유형: 미등록(무코드품목)
		            ELSE PRDT.ITEM_CD
		        END AS DISP_ITEM_CD
		     , PRDT.ITEM_CD
		     , PRDT.ITEM_NM
		     , PRDT.ITEM_NM_EN
		     , PRDT.ITEM_SPEC
		     , PRDT.ITEM_SPEC_DTL
		     , PRDT.UOM_CCD
		     , PRDT.PR_QTY
		     , PRDT.CUR_CCD
		     , PRDT.PR_UPRC
		     , PRDT.PR_AMT
		     , PRDT.WH_CCD
		     , PRDT.DLVY_PLC
		     , PRDT.PURC_GRP_CD
		     , PRDT.GR_PIC_ID
		     , PRDT.PR_REALUSR_ID
		     , PRDT.PR_REALUSR_REQ_CONT
		     , PRDT.UPRCCNTR_NO
		     , PRDT.UPRCCNTR_ITEM_UUID
		     , PRDT.UPRCCNTR_REVNO
		     , PRDT.UPRCCNTR_LNO
		     , PRDT.CNTR_UUID
		     , PRDT.CNTR_NO
		     , PRDT.CNTR_REVNO
		     , PRDT.PURC_CNTR_UUID
		     , PRDT.PURC_CNTR_INFO_UUID
		     , PRDT.PURC_CNTR_ITEM_UUID
		     , PRDT.PURC_CNTR_ITEM_LNO
		     , PRDT.SG_CD
		     , PRDT.CONST_ST_DT
		     , PRDT.CONST_EXP_DT
		     , PRDT.REQ_DLVY_DT
		     , PRDT.ATHG_UUID
		     , PRDT.PR_RET_RSN
		     , PRDT.URGPURC_YN
		     , PRDT.PR_STS_CCD
		     , PRDT.PR_CHG_YN
		     , PRDT.STS
		     , PRDT.REGR_ID
		     , PRDT.REG_DTTM
		     , PRDT.MODR_ID
		     , PRDT.MOD_DTTM
		     , JOB.PURC_GRP_NM
		     , CASE WHEN 'en_US' = #{g.locale} THEN PR_SUG_USR.USR_NM_EN
		            ELSE PR_SUG_USR.USR_NM
		        END AS PR_REALUSR_NM
		     , CASE WHEN 'en_US' = #{g.locale} THEN GR_CHR_USR.USR_NM_EN
		            ELSE GR_CHR_USR.USR_NM
		        END AS GR_PIC_NM
		  FROM PR_ITEM PRDT
		  LEFT OUTER JOIN USR PR_SUG_USR        /* PR_SUG_USR : 구매요청 의뢰자 */
		    ON PRDT.TEN_ID    = PR_SUG_USR.TEN_ID
		   AND PRDT.PR_REALUSR_ID = PR_SUG_USR.USR_ID
		  LEFT OUTER JOIN USR GR_CHR_USR        /* GR_CHR_USR : 검수 담당자 */
		    ON PRDT.TEN_ID    = GR_CHR_USR.TEN_ID
		   AND PRDT.GR_PIC_ID = GR_CHR_USR.USR_ID
		  LEFT OUTER JOIN PURC_GRP JOB               /* JOB : 직무(그룹) */
		    ON JOB.TEN_ID       = PRDT.TEN_ID
		   AND JOB.PURC_GRP_TYP_CCD = 'PURC'
		   AND JOB.PURC_GRP_CD  = PRDT.PURC_GRP_CD
		   AND JOB.CO_CD      = #{g.co_cd}
		   AND JOB.USE_YN       = 'Y'
		 WHERE PRDT.TEN_ID  = #{g.tenant}
		   AND PRDT.PR_REVNO  = CAST(#{p.pr_revno} AS INT)
		   AND PRDT.PR_NO   = #{p.pr_no}
		   AND PRDT.STS    != 'D'
		 ORDER BY CAST(PRDT.PR_LNO AS INT) ASC
	</select>
	<update id="updatePrItemPrPurp">
		/* updatePrItemPrPurp : 구매요청 목적 공통코드 변경 */
		UPDATE PR_ITEM
		   SET PR_PURP_CCD  = #{p.pr_purp_ccd}
		     , UPRCCNTR_ITEM_UUID  = #{p.uprccntr_item_uuid}
		     , UPRCCNTR_NO       = #{p.uprccntr_no}
		     , UPRCCNTR_REVNO      = #{p.uprccntr_revno}
		     , UPRCCNTR_LNO = #{p.uprccntr_lno}
		     , PR_UPRC      = #{p.uprccntr_uprc}
		     , PR_AMT        =  GETPRECFORMAT(#{g.tenant}, 'amt', (PR_QTY * #{p.uprccntr_uprc}), CUR_CCD )
		     , STS           = 'U'
		     , MODR_ID        = #{g.username}
		     , MOD_DTTM        = #{g.now}
		 WHERE TEN_ID     = #{g.tenant}
		   AND PR_ITEM_UUID = #{p.pr_item_uuid}
	</update>
	<select id="comparePrDtSts" resultType="map">
		/* pr-item.comparePrDtSts */
		SELECT PRDT.PR_UUID
		     , PRDT.PR_NO
		     , PRDT.PR_REVNO
		     , PRDT.PR_LNO
		     , PRDT.PR_STS_CCD
		     , CDDL.DTLCD_NM AS PR_PROG_STS_NM
		     , CASE WHEN PRDT.PR_STS_CCD = #{p.pr_sts_ccd} THEN 'Y'
		            ELSE 'N'
		        END AS VALID_YN
		  FROM PR_ITEM PRDT
		 INNER JOIN DTLCD CDDT
		    ON CDDT.TEN_ID = PRDT.TEN_ID
		   AND CDDT.CCD = 'P044'
		   AND CDDT.DTLCD = PRDT.PR_STS_CCD
		   AND CDDT.USE_YN = 'Y'
		   AND CDDT.STS   != 'D'
		 INNER JOIN DTLCD_MULTLANG CDDL
		    ON CDDL.TEN_ID  = CDDT.TEN_ID
		   AND CDDL.CCD  = CDDT.CCD
		   AND CDDL.DTLCD  = CDDT.DTLCD
		   AND CDDL.LANG_CCD = #{g.locale}
		   AND CDDL.STS    != 'D'
		 WHERE PRDT.TEN_ID     = #{g.tenant}
		   AND PRDT.PR_ITEM_UUID = #{p.pr_item_uuid}
	</select>
	<resultMap id="prDtValidCheckMap" type="java.util.HashMap">
		<result column="VALID_YN" property="valid_yn"/>
		<collection javaType="java.util.ArrayList" property="itemList" resultMap="prDtMap"/>
	</resultMap>
	<resultMap id="prDtMap" type="java.util.HashMap">
		<id column="PR_ITEM_UUID" property="pr_item_uuid"/>
		<result column="PR_NO" property="pr_no"/>
		<result column="PR_LNO" property="pr_lno"/>
		<result column="PR_STS_CCD" property="pr_sts_ccd"/>
		<result column="PR_PROG_STS_NM" property="pr_prog_sts_nm"/>
	</resultMap>
	<select id="compareListPrDtSts" resultMap="prDtValidCheckMap">
		/* pr-item.compareListPrDtSts */
		SELECT PRDT.PR_ITEM_UUID
		     , PRDT.PR_UUID
		     , PRDT.PR_NO
		     , PRDT.PR_LNO
		     , PRDT.PR_STS_CCD
		     , CDDL.DTLCD_NM     AS PR_PROG_STS_NM
		     <choose>
		         <when test="p.availableStsList != null">
		             , CASE WHEN PRDT.PR_STS_CCD IN
		             <foreach close=")" collection="p.availableStsList" item="sts" open="(" separator=",">
		                 #{sts}
		             </foreach>
		                         THEN 'Y'
		                    ELSE 'N'
		                END AS VALID_YN
		         </when>
		         <otherwise>
		             , CASE WHEN PRDT.PR_STS_CCD = #{p.pr_sts_ccd} THEN 'Y'
		                    ELSE 'N'
		                END AS VALID_YN
		         </otherwise>
		     </choose>
		  FROM PR_ITEM PRDT
		 INNER JOIN TEMP_TBL TEMP
		    ON TEMP.TEN_ID = PRDT.TEN_ID
		   AND TEMP.TASK_ID = PRDT.PR_ITEM_UUID
		   AND TEMP.USR_ID = #{g.username}
		 INNER JOIN DTLCD CDDT
		    ON CDDT.TEN_ID = PRDT.TEN_ID
		   AND CDDT.CCD = 'P044'
		   AND CDDT.DTLCD = PRDT.PR_STS_CCD
		   AND CDDT.USE_YN = 'Y'
		   AND CDDT.STS   != 'D'
		 INNER JOIN DTLCD_MULTLANG CDDL
		    ON CDDL.TEN_ID  = CDDT.TEN_ID
		   AND CDDL.CCD  = CDDT.CCD
		   AND CDDL.DTLCD  = CDDT.DTLCD
		   AND CDDL.LANG_CCD = #{g.locale}
		   AND CDDL.STS    != 'D'
		 WHERE PRDT.TEN_ID  = #{g.tenant}
	</select>
	<select id="findPrByPrItemId" resultType="map">
		/* pr-item.findPrByPrItemId */
		SELECT PRHD.PR_UUID AS APP_ID
		     , PRHD.PURC_TYP_CCD
		  FROM PR_ITEM PRDT
		 INNER JOIN PR PRHD
		    ON PRDT.TEN_ID = PRHD.TEN_ID
		   AND PRDT.PR_UUID  = PRHD.PR_UUID
		 WHERE PRDT.TEN_ID     = #{g.tenant}
		   AND PRDT.PR_ITEM_UUID = #{p.pr_item_uuid}
	</select>
	<select id="findListPrItemIdsByPrId" resultType="map">
		/* pr-item.findListPrItemIdsByPrId */
		SELECT PR_ITEM_UUID
			FROM PR_ITEM
			WHERE TEN_ID = #{g.tenant}
			AND PR_UUID  = #{p.pr_uuid}
			AND STS   != 'D'
	</select>
	<select id="findPrItem" resultType="map">
		/* pr-item.findPrItem */
		SELECT PR_ITEM.ITEM_CD
		, PR_ITEM.PR_ITEM_UUID
		, PR_ITEM.PR_UUID
		, ITEM_OORG.QTA_YN
		FROM PR_ITEM
		INNER JOIN ITEM_OORG
		ON ITEM_OORG.TEN_ID = PR_ITEM.TEN_ID
		AND ITEM_OORG.ITEM_CD = PR_ITEM.ITEM_CD
		AND ITEM_OORG.OORG_CD = PR_ITEM.ITEM_OORG_CD
		AND ITEM_OORG.STS != 'D'
	WHERE PR_ITEM.TEN_ID = #{g.tenant}
		AND PR_ITEM.PR_ITEM_UUID = #{p.pr_item_uuid}
	</select>
	<update id="updatePrItemQtaInfo">
		/* pr-item.updatePrItemQtaInfo */
		UPDATE PR_ITEM
		SET QTA_ITEM_UUID = #{p.qta_item_uuid}
		, QTA_NO = #{p.qta_no}
		, QTA_LNO = #{p.qta_lno}
		WHERE PR_ITEM_UUID  = #{p.pr_item_uuid}
	</update>
	<select id="findListPrePrItemList" resultType="map">
		/* pr-item.findListPrePrItemList : 이전 구매요청 조회 */
		${p.start_of_paging}
		SELECT SEARCHDATA.*
		FROM (
		SELECT PRHD.TEN_ID
		, PRHD.PR_UUID
		, PRHD.PR_REVNO
		, PRDT.PR_ITEM_UUID
		, PRDT.OORG_CD
		, PRDT.PR_STS_CCD
		, PRDT.PR_ITEM_STS_CCD
		, PRHD.PURC_TYP_CCD
		, CASE WHEN PRHD.PR_PURP_CCD = 'SPTPURC'
		AND PRDT.UPRCCNTR_NO IS NOT NULL  THEN 'UPRCCNTR_PURC'
		ELSE PRHD.PR_PURP_CCD
		END AS PR_PURP_CCD      /* 구매요청 목적 공통코드 */
		, PRDT.PR_NO
		, PRDT.PR_LNO
		, PRHD.PR_TIT
		, PRDT.ITEM_CD_CRN_TYP_CCD
		, CASE WHEN PRDT.ITEM_CD_CRN_TYP_CCD = 'CDLS' THEN NULL -- 구매품목유형: 미등록(무코드품목)
		ELSE PRDT.ITEM_CD
		END AS DISP_ITEM_CD
		, PRDT.ITEM_CD
		, CASE WHEN 'en_US' = #{g.locale} THEN PRDT.ITEM_NM_EN
		ELSE PRDT.ITEM_NM
		END AS ITEM_NM
		, PRDT.ITEM_NM_EN
		, PRDT.ITEM_SPEC
		, PRDT.ITEM_SPEC_DTL
		, PRDT.UOM_CCD
		, PRDT.CUR_CCD
		, PRDT.PR_QTY
		, PRDT.PR_UPRC
		, PRDT.PR_AMT
		, PRDT.REQ_DLVY_DT
		, PRDT.CONST_ST_DT
		, PRDT.CONST_EXP_DT
		, PRDT.PLT_CD
		, PRDT.ITEM_OORG_CD
		, PRDT.PURC_GRP_CD
		, CASE WHEN 'en_US' = #{g.locale} THEN JOB.PURC_GRP_NM_EN
		ELSE JOB.PURC_GRP_NM
		END AS PURC_GRP_NM         /* 요청자 명 */
		, PRDT.DLVY_PLC
		, PRHD.PR_CRTR_ID
		, CASE WHEN 'en_US' = #{g.locale} THEN PR_REQ_USER.USR_NM_EN
		ELSE PR_REQ_USER.USR_NM
		END AS PR_CRTR_NM         /* 요청자 명 */
		, PRHD.PR_CRTR_DEPT_CD
		, CASE WHEN 'en_US' = #{g.locale} THEN PR_CRTR_DEPT_CD.DEPT_NM_EN
		ELSE PR_CRTR_DEPT_CD.DEPT_NM
		END AS PR_REQ_DEPT_NM
		, CASE WHEN 'en_US' = #{g.locale} THEN PR_SUG_USER.USR_NM_EN
		ELSE PR_SUG_USER.USR_NM
		END AS PR_REALUSR_NM
		, PRHD.PR_REQ_DT
		, PRDT.PR_REALUSR_ID         /* 구매의뢰자 명 */
		, PRDT.PR_REALUSR_REQ_CONT
		, PRDT.PR_RET_RSN
		FROM (
		<include refid="subSqlRevTable"/>
		) PRHD
		INNER JOIN PR_ITEM PRDT
		ON PRDT.TEN_ID = PRHD.TEN_ID
		AND PRDT.PR_UUID  = PRHD.PR_UUID
		AND PRHD.PR_REVNO = PRHD.LAST_REV
		LEFT OUTER JOIN USR PR_SUG_USER
		ON PR_SUG_USER.TEN_ID  = PRDT.TEN_ID
		AND PR_SUG_USER.USR_ID  = PRDT.PR_REALUSR_ID
		AND PR_SUG_USER.STS    != 'D'
		INNER JOIN USR PR_REQ_USER
		ON PR_REQ_USER.TEN_ID  = PRHD.TEN_ID
		AND PR_REQ_USER.USR_ID  = PRHD.PR_CRTR_ID
		AND PR_REQ_USER.STS    != 'D'
		LEFT OUTER JOIN LOGIC_ORG B         /* B : 조직 */
		ON PR_REQ_USER.TEN_ID   = B.TEN_ID
		AND PR_REQ_USER.CO_CD  = B.LOGIC_ORG_CD
		AND B.LOGIC_ORG_TYP_CCD = 'COMPANY'
		AND B.STS       != 'D'
		LEFT OUTER JOIN LOGIC_ORG_DEPT_MAPG ODM
		ON PR_REQ_USER.TEN_ID = ODM.TEN_ID
		AND PR_REQ_USER.CO_CD = ODM.LOGIC_ORG_CD
		AND PRHD.PR_CRTR_DEPT_CD = ODM.DEPT_CD
		AND ODM.STS != 'D'
		LEFT OUTER JOIN DEPT PR_CRTR_DEPT_CD
		ON ODM.TEN_ID      = PR_CRTR_DEPT_CD.TEN_ID
		AND ODM.DEPT_CD = PR_CRTR_DEPT_CD.DEPT_CD
		AND PR_CRTR_DEPT_CD.STS        != 'D'
		LEFT OUTER JOIN PURC_GRP JOB
		ON JOB.TEN_ID       = PRDT.TEN_ID
		AND JOB.PURC_GRP_TYP_CCD = 'PURC'
		AND JOB.PURC_GRP_CD  = PRDT.PURC_GRP_CD
		AND JOB.CO_CD      = #{g.co_cd}
		AND JOB.USE_YN       = 'Y'
		WHERE PRHD.TEN_ID  = #{g.tenant}
		AND PRDT.STS    != 'D'
		AND PRDT.PR_STS_CCD IS NOT NULL  AND PRDT.PR_STS_CCD NOT IN ('PR_CRNG', 'PR_APVL_RPTG', 'PR_APVL_RET', 'PR_CHG_CRNG')
		AND PRDT.PR_ITEM_STS_CCD IS NOT NULL <if test="p.oorg_cds != null and p.oorg_cds.size() != 0">
			AND PRHD.OORG_CD           IN
			<foreach close=")" collection="p.oorg_cds" item="oorg_cd" open="(" separator=",">
				#{oorg_cd}
			</foreach>
		</if>
		<if test="p.fromDate != null">
			AND PRHD.PR_REQ_DT <![CDATA[>=]]> #{p.fromDate}
		</if>
		<if test="p.toDate != null">
			<bind name="toDatePattern" value="g.getPlusDays(p.toDate,1)"/>
			AND PRHD.PR_REQ_DT <![CDATA[<]]> #{toDatePattern}
		</if>
		<if test="p.pr_purp_ccd != null and p.pr_purp_ccd != ''">
			<choose>
				<when test="p.pr_purp_ccd == 'SPTPURC'">
					AND PRHD.PR_PURP_CCD = 'SPTPURC' AND (PRDT.UPRCCNTR_NO IS NULL OR PRDT.UPRCCNTR_NO = '')
				</when>
				<when test="p.pr_purp_ccd == 'UPRCCNTR_PURC'">
					AND PRHD.PR_PURP_CCD = 'SPTPURC'
					AND PRDT.UPRCCNTR_NO IS NOT NULL </when>
				<otherwise>
					AND PRHD.PR_PURP_CCD = #{p.pr_purp_ccd}
				</otherwise>
			</choose>
		</if>
		<if test="p.purc_typ_ccd != null and p.purc_typ_ccd != ''">
			AND PRHD.PURC_TYP_CCD = #{p.purc_typ_ccd}
		</if>
		<choose>
			<when test="p.pr_nos != null and p.pr_nos.size() != 0">
				AND PRHD.PR_NO IN
				<foreach close=")" collection="p.pr_nos" item="pr_no" open="(" separator=",">
					#{pr_no}
				</foreach>
			</when>
			<otherwise>
				<if test="p.pr_no != null and p.pr_no != ''">
					<bind name="prNoPattern" value="'%' + p.pr_no + '%'"/>
					AND UPPER(PRHD.PR_NO) LIKE UPPER(#{prNoPattern})
				</if>
			</otherwise>
		</choose>
		<if test="p.pr_tit != null and p.pr_tit != ''">
			<bind name="prTitPattern" value="'%' + p.pr_tit + '%'"/>
			AND UPPER(PRHD.PR_TIT) LIKE UPPER(#{prTitPattern})
		</if>
		<choose>
			<when test="p.pr_crtr_dept_cd != null and p.pr_crtr_dept_cd != ''">
				AND PRHD.PR_CRTR_DEPT_CD = #{p.pr_crtr_dept_cd}
			</when>
			<otherwise>
				<if test="p.pr_req_dept_nm != null and p.pr_req_dept_nm != ''">
					<bind name="prReqDeptNmPattern" value="'%' + p.pr_req_dept_nm + '%'"/>
					AND (UPPER(PR_CRTR_DEPT_CD.DEPT_NM) LIKE UPPER(#{prReqDeptNmPattern}) OR UPPER(PR_CRTR_DEPT_CD.DEPT_NM_EN) LIKE UPPER(#{prReqDeptNmPattern}))
				</if>
			</otherwise>
		</choose>
		<choose>
			<when test="p.pr_crtr_id != null and p.pr_crtr_id != ''">
				AND PRHD.PR_CRTR_ID = #{p.pr_crtr_id}
			</when>
			<otherwise>
				<if test="p.pr_crtr_nm != null and p.pr_crtr_nm != ''">
					<bind name="prReqUserNmPattern" value="'%' + p.pr_crtr_nm + '%'"/>
					AND (UPPER(PR_REQ_USER.USR_NM) LIKE UPPER(#{prReqUserNmPattern}) OR UPPER(PR_REQ_USER.USR_NM_EN) LIKE UPPER(#{prReqUserNmPattern}))
				</if>
			</otherwise>
		</choose>
		<choose>
			<when test="p.pr_realusr_id != null and p.pr_realusr_id != ''">
				AND PRDT.PR_REALUSR_ID = #{p.pr_realusr_id}
			</when>
			<otherwise>
				<if test="p.pr_realusr_nm != null and p.pr_realusr_nm != ''">
					<bind name="prSugUserNmPattern" value="'%' + p.pr_realusr_nm + '%'"/>
					AND (UPPER(PR_SUG_USER.USR_NM) LIKE UPPER(#{prSugUserNmPattern}) OR UPPER(PR_SUG_USER.USR_NM_EN) LIKE UPPER(#{prSugUserNmPattern}) )
				</if>
			</otherwise>
		</choose>
		<choose>
			<when test="p.item_cds != null and p.item_cds.size() != 0">
				AND PRDT.ITEM_CD IN
				<foreach close=")" collection="p.item_cds" item="item_cd" open="(" separator=",">
					#{item_cd}
				</foreach>
			</when>
			<otherwise>
				<if test="p.item_cd != null and p.item_cd != ''">
					<bind name="itemCdPattern" value="'%' + p.item_cd + '%'"/>
					AND UPPER(PRDT.ITEM_CD) LIKE UPPER(#{itemCdPattern})
				</if>
			</otherwise>
		</choose>
		<if test="p.pr_item_sts_ccd != null and p.pr_item_sts_ccd != ''">
			AND PRDT.PR_ITEM_STS_CCD       = #{p.pr_item_sts_ccd}
		</if>
		ORDER BY PRHD.PR_NO DESC, PRHD.PR_REVNO DESC, CAST(PRDT.PR_LNO AS INT) ASC
		) SEARCHDATA
		WHERE
		<bind name="searchPattern" value="'%' + p.matchText + '%'"/>
		UPPER(TRIM(SEARCHDATA.PR_TIT)) LIKE UPPER(TRIM(#{searchPattern}))
		OR UPPER(SEARCHDATA.ITEM_CD) LIKE UPPER(#{searchPattern})
		OR UPPER(TRIM(SEARCHDATA.ITEM_NM)) LIKE UPPER(TRIM(#{searchPattern}))
		${p.end_of_paging}
	</select>
	<select id="findListPrItemByPrItemUuids" resultType="map">
		/* pr-item.findListPrItemByPrItemUuids */
		SELECT PR_ITEM.OORG_CD
		, PR_ITEM.PR_ITEM_UUID
		     , PR_ITEM.PR_ITEM_UUID,PR_ITEM.PR_LNO, PR_ITEM.OORG_CD, PR_ITEM.PLT_CD, PR_ITEM.ITEM_CD, PR_ITEM.ITEM_NM
		     , PR_ITEM.ITEM_NM_EN
		     , PR_ITEM.ITEM_SPEC
		     , PR_ITEM.UOM_CCD
		     , PR_ITEM.PR_QTY
		     , PR_ITEM.CUR_CCD
		     , PR_ITEM.PR_UPRC
		     , PR_ITEM.PR_AMT
		     , PR_ITEM.WH_CCD
		     , PR_ITEM.DLVY_PLC
		     , PR_ITEM.PURC_GRP_CD
		     , PR_ITEM.GR_PIC_ID
		     , PR_ITEM.PR_REALUSR_ID, PR_ITEM.PR_REALUSR_REQ_CONT, PR_ITEM.UPRCCNTR_ITEM_UUID, PR_ITEM.UPRCCNTR_NO, PR_ITEM.UPRCCNTR_REVNO, PR_ITEM.UPRCCNTR_LNO, PR_ITEM.SG_CD, PR_ITEM.CONST_ST_DT, PR_ITEM.CONST_EXP_DT, PR_ITEM.REQ_DLVY_DT, PR_ITEM.ATHG_UUID, PR_ITEM.PR_RET_RSN, PR_ITEM.URGPURC_YN, PR_ITEM.AUTO_PO_YN, PR_ITEM.PR_STS_CCD, PR_ITEM.PR_ITEM_STS_CCD, PR_ITEM.PR_CHG_YN, PR_ITEM.ITEM_CD_CRN_TYP_CCD, PR_ITEM.ITEM_SPEC_DTL, PR_ITEM.PRE_UPRCCNTR_ITEM_UUID, PR_ITEM.MIGR_YN
		     , PR_ITEM.RMK, PR_ITEM.STS, PR_ITEM.REGR_ID, PR_ITEM.REG_DTTM, PR_ITEM.MODR_ID, PR_ITEM.MOD_DTTM, PR_ITEM.ITEM_OORG_CD, PR_ITEM.RCMD_VD_CD, PR_ITEM.RCMD_VD_NM, PR_ITEM.RCMD_VD_RSN, PR_ITEM.QTA_ITEM_UUID, PR_ITEM.QTA_NO, PR_ITEM.QTA_LNO
		, PR.PR_UUID, PR.PR_NO, PR.PR_REVNO, PR.PR_TIT, PR.PURC_TYP_CCD, PR.PR_PURP_CCD, PR.PR_REQ_DT, PR.PR_CRTR_ID, PR.PR_CRTR_TEL, PR.PR_CRTR_DEPT_CD, PR.PR_AMT, PR.CUR_CCD, PR.PR_RMK, PR.PR_CHG_RSN, PR.ATHG_UUID, PR.PR_STS_CCD, PR.PR_CHG_PIC_ID, PR.MIGR_YN
		     , PR.PR_CHG_YN
		FROM PR_ITEM
		INNER JOIN PR
		ON (PR.TEN_ID = PR_ITEM.TEN_ID
		    AND PR.PR_UUID = PR_ITEM.PR_UUID)
		WHERE PR_ITEM.TEN_ID = #{g.tenant}
		<choose>
		       <when test="p.pr_item_uuids != null and p.pr_item_uuids.size() &gt; 0">
		           AND PR_ITEM.PR_ITEM_UUID IN
		           <foreach close=")" collection="p.pr_item_uuids" item="pr_item_uuid" open="(" separator=",">
		               #{pr_item_uuid}
		           </foreach>
		       </when>
		       <otherwise>
		           AND PR_ITEM.PR_ITEM_UUID = #{p.pr_item_uuid}
		       </otherwise>
		   </choose>
	</select>
</mapper>
